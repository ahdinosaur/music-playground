!function(){var e,t=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}}(function(e,n){(function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.Buffer=e,n.SlowBuffer=function(t){return+t!=t&&(t=0),e.alloc(+t)},n.INSPECT_MAX_BYTES=50;var r=2147483647;function i(t){if(t>r)throw new RangeError('The value "'+t+'" is invalid for option "size"');var n=new Uint8Array(t);return n.__proto__=e.prototype,n}function e(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}return o(e,t,n)}function o(n,r,o){if("string"==typeof n)return function(t,n){if("string"==typeof n&&""!==n||(n="utf8"),!e.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var r=0|l(t,n),o=i(r),a=o.write(t,n);return a!==r&&(o=o.slice(0,a)),o}(n,r);if(ArrayBuffer.isView(n))return u(n);if(null==n)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===n?"undefined":t(n)));if(R(n,ArrayBuffer)||n&&R(n.buffer,ArrayBuffer))return function(t,n,r){if(n<0||t.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<n+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r)).__proto__=e.prototype,i}(n,r,o);if("number"==typeof n)throw new TypeError('The "value" argument must not be of type number. Received type number');var a=n.valueOf&&n.valueOf();if(null!=a&&a!==n)return e.from(a,r,o);var s=function(t){if(e.isBuffer(t)){var n=0|f(t.length),r=i(n);return 0===r.length?r:(t.copy(r,0,0,n),r)}return void 0!==t.length?"number"!=typeof t.length||I(t.length)?i(0):u(t):"Buffer"===t.type&&Array.isArray(t.data)?u(t.data):void 0}(n);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof n[Symbol.toPrimitive])return e.from(n[Symbol.toPrimitive]("string"),r,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+(void 0===n?"undefined":t(n)))}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return a(e),i(e<0?0:0|f(e))}function u(e){for(var t=e.length<0?0:0|f(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function l(n,r){if(e.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||R(n,ArrayBuffer))return n.byteLength;if("string"!=typeof n)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+(void 0===n?"undefined":t(n)));var i=n.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===i)return 0;for(var a=!1;;)switch(r){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return L(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return N(n).length;default:if(a)return o?-1:L(n).length;r=(""+r).toLowerCase(),a=!0}}function c(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function h(t,n,r,i,o){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),I(r=+r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof n&&(n=e.from(n,i)),e.isBuffer(n))return 0===n.length?-1:p(t,n,r,i,o);if("number"==typeof n)return n&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,n,r):Uint8Array.prototype.lastIndexOf.call(t,n,r):p(t,[n],r,i,o);throw new TypeError("val must be string, number or Buffer")}function p(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}function f(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=n;o<s;o++)if(f(e,o)===f(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var c=!0,h=0;h<u;h++)if(f(e,o+h)!==f(t,h)){c=!1;break}if(c)return o}return-1}function d(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(I(s))return a;e[n+a]=s}return a}function m(e,t,n,r){return D(L(t,e.length-n),e,n,r)}function v(e,t,n,r){return D(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function g(e,t,n,r){return v(e,t,n,r)}function y(e,t,n,r){return D(N(t),e,n,r)}function b(e,t,n,r){return D(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function w(e,t,n){return 0===t&&n===e.length?B.fromByteArray(e):B.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,f=e[i],l=null,c=f>239?4:f>223?3:f>191?2:1;if(i+c<=n)switch(c){case 1:f<128&&(l=f);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&f)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&f)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&f)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,c=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=c}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=_));return n}(r)}n.kMaxLength=r,e.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(t){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(e,t,n){return o(e,t,n)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(e,t,n){return function(e,t,n){return a(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},e.allocUnsafe=function(e){return s(e)},e.allocUnsafeSlow=function(e){return s(e)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,n){if(R(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),R(n,Uint8Array)&&(n=e.from(n,n.offset,n.byteLength)),!e.isBuffer(t)||!e.isBuffer(n))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===n)return 0;for(var r=t.length,i=n.length,o=0,a=Math.min(r,i);o<a;++o)if(t[o]!==n[o]){r=t[o],i=n[o];break}return r<i?-1:i<r?1:0},e.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,n){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<t.length;++r)n+=t[r].length;var i=e.allocUnsafe(n),o=0;for(r=0;r<t.length;++r){var a=t[r];if(R(a,Uint8Array)&&(a=e.from(a)),!e.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,o),o+=a.length}return i},e.byteLength=l,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)c(this,t,t+1);return this},e.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)c(this,t,t+3),c(this,t+1,t+2);return this},e.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)c(this,t,t+7),c(this,t+1,t+6),c(this,t+2,t+5),c(this,t+3,t+4);return this},e.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},e.prototype.compare=function(n,r,i,o,a){if(R(n,Uint8Array)&&(n=e.from(n,n.offset,n.byteLength)),!e.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+(void 0===n?"undefined":t(n)));if(void 0===r&&(r=0),void 0===i&&(i=n?n.length:0),void 0===o&&(o=0),void 0===a&&(a=this.length),r<0||i>n.length||o<0||a>this.length)throw new RangeError("out of range index");if(o>=a&&r>=i)return 0;if(o>=a)return-1;if(r>=i)return 1;if(this===n)return 0;for(var s=(a>>>=0)-(o>>>=0),u=(i>>>=0)-(r>>>=0),f=Math.min(s,u),l=this.slice(o,a),c=n.slice(r,i),h=0;h<f;++h)if(l[h]!==c[h]){s=l[h],u=c[h];break}return s<u?-1:u<s?1:0},e.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},e.prototype.indexOf=function(e,t,n){return h(this,e,t,n,!0)},e.prototype.lastIndexOf=function(e,t,n){return h(this,e,t,n,!1)},e.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return d(this,e,t,n);case"utf8":case"utf-8":return m(this,e,t,n);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return g(this,e,t,n);case"base64":return y(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r,i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var o="",a=t;a<n;++a)o+=(r=e[a])<16?"0"+r.toString(16):r.toString(16);return o}function S(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function E(t,n,r,i,o,a){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>o||n<a)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function T(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,r,i){return t=+t,n>>>=0,i||T(e,0,n,4),$.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,i){return t=+t,n>>>=0,i||T(e,0,n,8),$.write(e,t,n,r,52,8),n+8}e.prototype.slice=function(t,n){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(n=void 0===n?r:~~n)<0?(n+=r)<0&&(n=0):n>r&&(n=r),n<t&&(n=t);var i=this.subarray(t,n);return i.__proto__=e.prototype,i},e.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},e.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},e.prototype.readUInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},e.prototype.readUInt16LE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},e.prototype.readUInt16BE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},e.prototype.readUInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},e.prototype.readUInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},e.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||k(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},e.prototype.readInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},e.prototype.readInt16LE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},e.prototype.readInt16BE=function(e,t){e>>>=0,t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},e.prototype.readInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e.prototype.readInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e.prototype.readFloatLE=function(e,t){return e>>>=0,t||k(e,4,this.length),$.read(this,e,!0,23,4)},e.prototype.readFloatBE=function(e,t){return e>>>=0,t||k(e,4,this.length),$.read(this,e,!1,23,4)},e.prototype.readDoubleLE=function(e,t){return e>>>=0,t||k(e,8,this.length),$.read(this,e,!0,52,8)},e.prototype.readDoubleBE=function(e,t){return e>>>=0,t||k(e,8,this.length),$.read(this,e,!1,52,8)},e.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||E(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},e.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||E(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},e.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,1,255,0),this[t]=255&e,t+1},e.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},e.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);E(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},e.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);E(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},e.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},e.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},e.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||E(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},e.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},e.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},e.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},e.prototype.copy=function(t,n,r,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),n>=t.length&&(n=t.length),n||(n=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-n<i-r&&(i=t.length-n+r);var o=i-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(n,r,i);else if(this===t&&r<n&&n<i)for(var a=o-1;a>=0;--a)t[a+n]=this[a+r];else Uint8Array.prototype.set.call(t,this.subarray(r,i),n);return o},e.prototype.fill=function(t,n,r,i){if("string"==typeof t){if("string"==typeof n?(i=n,n=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t&&(t&=255);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;var a;if(n>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=n;a<r;++a)this[a]=t;else{var s=e.isBuffer(t)?t:e.from(t,i),u=s.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<r-n;++a)this[a+n]=s[a%u]}return this};var C=/[^+\/0-9A-Za-z-_]/g;function L(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function N(e){return B.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(C,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function R(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function I(e){return e!=e}}).call(this,t({}).Buffer)}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function a(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0;var s,u=10;try{var f={};Object.defineProperty&&Object.defineProperty(f,"x",{value:0}),s=0===f.x}catch(Yo){s=!1}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,i,o){var a,s,u;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),u=s[t]):(s=e._events=r(null),e._eventsCount=0),u){if("function"==typeof u?u=s[t]=o?[i,u]:[u,i]:o?u.unshift(i):u.push(i),!u.warned&&(a=l(e))&&a>0&&u.length>a){u.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+u.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=u.length,"object"===("undefined"==typeof console?"undefined":n(console))&&console.warn&&console.warn("%s: %s",f.name,f.message)}}else u=s[t]=i,++e._eventsCount;return e}function h(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=o.call(h,r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):v(i,i.length):[]}function m(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e){if((e="string"==typeof e?String(e).trim().split("."):e).length<2)return e=e[0],function(t){return t[e]};var t=e.length;return function(n){for(var r=0;r<t&&void 0!==n;r++)n=n[e[r]];return n}}s?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');u=e}}):a.defaultMaxListeners=u,a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){var t,n,r,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(n=a[e]))return!1;var f="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=v(e,r),o=0;o<r;++o)i[o].call(n)}(n,f,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=v(e,i),a=0;a<i;++a)o[a].call(n,r)}(n,f,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,a=v(e,o),s=0;s<o;++s)a[s].call(n,r,i)}(n,f,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var a=e.length,s=v(e,a),u=0;u<a;++u)s[u].call(n,r,i,o)}(n,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=v(e,i),a=0;a<i;++a)o[a].apply(n,r)}(n,f,this,i)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,o=a;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=o,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var a,s=i(n);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var y={},b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function w(e){return function e(t,n,r,i){if("object"===(void 0===t?"undefined":b(t))&&null!==t){if("function"==typeof t.toJSON){if(t instanceof x)return void t.count++;if(void 0===t.toJSON.forceDecirc)return}for(var o=0;o<r.length;o++)if(r[o]===t)return void(i[n]=new x(t,n,i));for(var a in r.push(t),t)Object.prototype.hasOwnProperty.call(t,a)&&e(t[a],a,r,t);r.pop()}}(e,"",[],null),JSON.stringify(e)}function x(e,t,n){this.val=e,this.k=t,this.parent=n,this.count=1}y=w,w.default=w,x.prototype.toJSON=function(){return 0==--this.count&&(this.parent[this.k]=this.val),"[Circular]"};var _=function(e){!function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";var n=document.getSelection(),r=!1;n.rangeCount>0&&(r=n.getRangeAt(0)),document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;var i=!1;try{i=document.execCommand("copy")}catch(Yo){}document.body.removeChild(t),r&&(n.removeAllRanges(),n.addRange(r))}(function(e){try{return JSON.stringify(e)}catch(t){}}(e)||y(e))},P=function(e){var t=e&&"string"==typeof e,n=t&&1===arguments.length&&0===e.indexOf("state.");e&&"function"!=typeof e||(e=window.choo.state),n&&[].push.call(arguments,{state:window.choo.state}),_(t?function(e,t){return arguments.length>=2?g(e)(t):g(e)}.apply(this,arguments):e)},M=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)A.call(n,r)&&(e[r]=n[r])}return e},A=Object.prototype.hasOwnProperty,S={};"function"==typeof Symbol&&Symbol.iterator;var k={trace:"\ud83d\udd0d",debug:"\ud83d\udc1b",info:"\u2728",warn:"\u26a0\ufe0f",error:"\ud83d\udea8",fatal:"\ud83d\udc80"},E={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},T={foreground:"#d3c0c8",background:"#2d2d2d",black:"#2d2d2d",red:"#f2777a",green:"#99cc99",yellow:"#ffcc66",blue:"#6699cc",magenta:"#cc99cc",cyan:"#66cccc",white:"#d3d0c8",brightBlack:"#747369"};function O(e,t){if(t=t||{},!(this instanceof O))return new O(e,t);this._name=e||"",this._colors=M(T,t.colors||{});try{this.logLevel=window.localStorage.getItem("logLevel")||"info"}catch(n){this.logLevel="info"}this._logLevel=E[this.logLevel]}function j(e){return"color: "+e+";"}function C(e){return 2!==e.length?0+e:e}function L(e){var t=e.split("\n");return(t=t.length>2?t.slice(2):t)[0]=t[0].replace(/^ {4}at /,""),"\n"+t.join("\n")}S=O,O.prototype.trace=function(){for(var e=["trace"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype.debug=function(){for(var e=["debug"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype.info=function(){for(var e=["info"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype.warn=function(){for(var e=["warn"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype.error=function(){for(var e=["error"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype.fatal=function(){for(var e=["fatal"],t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);this._print.apply(this,e)},O.prototype._print=function(e){if(!(E[e]<this._logLevel)){var t,n=C((t=new Date).getHours().toString())+":"+C(t.getMinutes().toString())+":"+C(t.getSeconds().toString()),r=k[e],i=this._name||"unknown",o="error"===e||e.fatal?this._colors.red:"warn"===e?this._colors.yellow:this._colors.green,a=[],s=[null],u="%c%s "+r+" %c%s";s.push(j(this._colors.brightBlack),n),s.push(j(this._colors.magenta),i);for(var f=1,l=arguments.length;f<l;f++){var c=arguments[f];"string"==typeof c?1===f?(u+=" %c%s",s.push(j(o)),s.push(c)):/ms$/.test(c)?(u+=" %c%s",s.push(j(this._colors.brightBlack)),s.push(c)):(u+=" %c%s",s.push(j(this._colors.white)),s.push(c)):"number"==typeof c?(u+=" %c%d",s.push(j(this._colors.magenta)),s.push(c)):a.push(c)}s[0]=u,a.forEach(function(e){s.push(e)}),Function.prototype.apply.apply(console.log,[console,s])}},"function"==typeof Symbol&&Symbol.iterator;"function"==typeof Symbol&&Symbol.iterator;var N="Debugging enabled. To disable run: `choo.debug = false`",D=function(e,t,n,r){var i,o=S("choo-devtools"),a="debug"===window.localStorage.logLevel;a&&o.info(N),i=function(e,t,n){a&&(n=n.split("\n")[1].replace(/^ +/,""),o.info("state."+e,t,"\n"+n))},e=new Proxy(e,{set:function(e,t,n){var r=L((new Error).stack);return i(t,n,r),e[t]=n,!0},deleteProperty:function(e,t){var n=L((new Error).stack);return i(t,void 0,n),t in e&&(delete e[t],!0)}}),n.state=e,Object.defineProperty(window.choo,"debug",{get:function(){return window.localStorage.logLevel="debug",r.emit("debug",!0),a=!0,N},set:function(e){window.localStorage.logLevel=e?"debug":"info",a=e,r.emit("debug",a),a?o.info(N):o.info("Debugging disabled. We hope it was helpful! \ud83d\ude4c")}})};function R(e,t){console.log("  %cchoo."+e,"color: #cc99cc","\u2014 "+t)}function I(){}for(var F=function(){Object.defineProperty(window.choo,"help",{get:function(){return setTimeout(function(){R("copy","Serialize the current state to the clipboard."),R("debug","Enable Choo debug mode."),R("emit","Emit an event in the Choo emitter."),R("help","Print usage information."),R("log","Print the last 150 events emitted."),R("on","Listen for an event in the Choo emitter."),R("once","Listen for an event once in the Choo emitter."),R("perf","Print out performance metrics"),R("state","Print the Choo state object."),R("storage","Print browser storage information.")},0),"Choo command overview"},set:I})},B={byteLength:function(e){var t=H(e),n=t[0],r=t[1];return 3*(n+r)/4-r},toByteArray:function(e){for(var t,n=H(e),r=n[0],i=n[1],o=new q(function(e,t,n){return 3*(t+n)/4-n}(0,r,i)),a=0,s=i>0?r-4:r,u=0;u<s;u+=4)t=U[e.charCodeAt(u)]<<18|U[e.charCodeAt(u+1)]<<12|U[e.charCodeAt(u+2)]<<6|U[e.charCodeAt(u+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return 2===i&&(t=U[e.charCodeAt(u)]<<2|U[e.charCodeAt(u+1)]>>4,o[a++]=255&t),1===i&&(t=U[e.charCodeAt(u)]<<10|U[e.charCodeAt(u+1)]<<4|U[e.charCodeAt(u+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o},fromByteArray:function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(Y(e,o,o+16383>a?a:o+16383));return 1===r?(t=e[n-1],i.push(z[t>>2]+z[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(z[t>>10]+z[t>>4&63]+z[t<<2&63]+"=")),i.join("")}},z=[],U=[],q="undefined"!=typeof Uint8Array?Uint8Array:Array,V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=0,G=V.length;W<G;++W)z[W]=V[W],U[V.charCodeAt(W)]=W;function H(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function Y(e,t,n){for(var r,i,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(z[(i=r)>>18&63]+z[i>>12&63]+z[i>>6&63]+z[63&i]);return o.join("")}U["-".charCodeAt(0)]=62,U["_".charCodeAt(0)]=63;var $={read:function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,f=u>>1,l=-7,c=n?i-1:0,h=n?-1:1,p=e[t+c];for(c+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+c],c+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+e[t+c],c+=h,l-=8);if(0===o)o=1-f;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=f}return(p?-1:1)*a*Math.pow(2,o-r)},write:function(e,t,n,r,i,o){var a,s,u,f=8*o-i-1,l=(1<<f)-1,c=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+c>=1?h/u:h*Math.pow(2,1-c))*u>=2&&(a++,u/=2),a+c>=l?(s=0,a=l):a+c>=1?(s=(t*u-1)*Math.pow(2,i),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,f+=i;f>0;e[n+p]=255&a,p+=d,a/=256,f-=8);e[n+p-d]|=128*m}},Q={exports:{}};(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){"use strict";function n(e,t){return null!=t&&e instanceof t}var r,i,o;try{r=Map}catch(f){r=function(){}}try{i=Set}catch(f){i=function(){}}try{o=Promise}catch(f){o=function(){}}function a(s,f,l,c,h){"object"===(void 0===f?"undefined":t(f))&&(l=f.depth,c=f.prototype,h=f.includeNonEnumerable,f=f.circular);var p=[],d=[],m=void 0!==e;return void 0===f&&(f=!0),void 0===l&&(l=1/0),function s(l,v){if(null===l)return null;if(0===v)return l;var g,y;if("object"!=(void 0===l?"undefined":t(l)))return l;if(n(l,r))g=new r;else if(n(l,i))g=new i;else if(n(l,o))g=new o(function(e,t){l.then(function(t){e(s(t,v-1))},function(e){t(s(e,v-1))})});else if(a.__isArray(l))g=[];else if(a.__isRegExp(l))g=new RegExp(l.source,u(l)),l.lastIndex&&(g.lastIndex=l.lastIndex);else if(a.__isDate(l))g=new Date(l.getTime());else{if(m&&e.isBuffer(l))return g=e.allocUnsafe?e.allocUnsafe(l.length):new e(l.length),l.copy(g),g;n(l,Error)?g=Object.create(l):void 0===c?(y=Object.getPrototypeOf(l),g=Object.create(y)):(g=Object.create(c),y=c)}if(f){var b=p.indexOf(l);if(-1!=b)return d[b];p.push(l),d.push(g)}for(var w in n(l,r)&&l.forEach(function(e,t){var n=s(t,v-1),r=s(e,v-1);g.set(n,r)}),n(l,i)&&l.forEach(function(e){var t=s(e,v-1);g.add(t)}),l){var x;y&&(x=Object.getOwnPropertyDescriptor(y,w)),x&&null==x.set||(g[w]=s(l[w],v-1))}if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(l);for(w=0;w<_.length;w++){var P=_[w];(!(A=Object.getOwnPropertyDescriptor(l,P))||A.enumerable||h)&&(g[P]=s(l[P],v-1),A.enumerable||Object.defineProperty(g,P,{enumerable:!1}))}}if(h){var M=Object.getOwnPropertyNames(l);for(w=0;w<M.length;w++){var A,S=M[w];(A=Object.getOwnPropertyDescriptor(l,S))&&A.enumerable||(g[S]=s(l[S],v-1),Object.defineProperty(g,S,{enumerable:!1}))}}return g}(s,l)}function s(e){return Object.prototype.toString.call(e)}function u(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return a.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},a.__objToStr=s,a.__isDate=function(e){return"object"===(void 0===e?"undefined":t(e))&&"[object Date]"===s(e)},a.__isArray=function(e){return"object"===(void 0===e?"undefined":t(e))&&"[object Array]"===s(e)},a.__isRegExp=function(e){return"object"===(void 0===e?"undefined":t(e))&&"[object RegExp]"===s(e)},a.__getRegExpFlags=u,a}();"object"===t(Q)&&Q.exports&&(Q.exports=n)}).call(this,t({}).Buffer),Q=Q.exports;var X;"function"==typeof Symbol&&Symbol.iterator;var K="undefined"!=typeof window;function J(e){this.hasWindow=e,this.hasIdle=this.hasWindow&&window.requestIdleCallback,this.method=this.hasIdle?window.requestIdleCallback.bind(window):this.setTimeout,this.scheduled=!1,this.queue=[]}J.prototype.push=function(e){this.queue.push(e),this.schedule()},J.prototype.schedule=function(){if(!this.scheduled){this.scheduled=!0;var e=this;this.method(function(t){for(;e.queue.length&&t.timeRemaining()>0;)e.queue.shift()(t);e.scheduled=!1,e.queue.length&&e.schedule()})}},J.prototype.setTimeout=function(e){setTimeout(e,0,{timeRemaining:function(){return 1}})};var Z=function(e,t,n){var r,i=e.length;if(!(t>=i||0===n)){var o=i-(n=t+n>i?i-t:n);for(r=t;r<o;++r)e[r]=e[r+n];e.length=o}},ee=(X=function(){var e;return K?(window._nanoScheduler||(window._nanoScheduler=new J(!0)),e=window._nanoScheduler):e=new J,e})(),te=S("choo"),ne=150;function re(){}var ie=function(e,t,n,r){var i="debug"===window.localStorage.logLevel,o=[],a=0,s=!0;function u(){return setTimeout(function(){console.table(o)},0),a+" "+(1===a?"event":"events")+" recorded, showing the last "+ne+"."+(!1===i?" Enable state capture by calling `choo.debug`.":" Disable state capture by calling `choo.debug = false`.")}function f(e,t,n){this.name=e,this.data=void 0===t?"<no data>":t,this.state=i?function(e){try{var t=Q(e);return s||(s=!0),t}catch(n){return s&&(te.warn("Could not clone your app state. Make sure to have a serializable state so it can be cloned"),s=!1),"<unserializable>"}}(n):"<disabled>"}r.on("debug",function(e){i=e}),window.choo._history=o,window.choo.history=u,Object.defineProperty(window.choo,"log",{get:u,set:re}),Object.defineProperty(window.choo,"history",{get:u,set:re}),t.on("*",function(t,n){a+=1;var r=new f(t,n,e);o.push(r),ee.push(function(){var e=o.length;e>ne&&Z(o,0,e-ne)})})};"function"==typeof Symbol&&Symbol.iterator;var oe=X(),ae=["frame","measure","navigation","resource","longtask"],se=function(e){var t="undefined"!=typeof window&&window.PerformanceObserver;if(t){if(window._onperformance)return window._onperformance.push(e),r;window._onperformance=[e];var n=new t(i);return setTimeout(function(){i(window.performance),n.observe({entryTypes:ae})},0),r}function r(){window._onperformance.splice(window._onperformance.indexOf(e),1)}function i(e){e.getEntries().forEach(function(e){oe.push(function(){!function(e){var t=e.entryType;"measure"===t?window.performance.clearMeasures(e.name):"resource"===t&&window.performance.clearResourceTimings()}(e),window._onperformance.forEach(function(t){t(e)})})})}},ue={};"function"==typeof Symbol&&Symbol.iterator;var fe=X();function le(e){if(!(this instanceof le))return new le(e);this.hasWindow="undefined"!=typeof window,this.hasIdleCallback=this.hasWindow&&window.requestIdleCallback,this.hasPerformance=this.hasWindow&&window.performance&&window.performance.getEntriesByName,this.emitter=e,this.listeners={},this.buffer={use:[],render:{},events:{}}}ue=le,le.prototype.on=function(e,t){this.listeners[e]=t},le.prototype.start=function(){var e=this;this.hasPerformance&&(window.performance.onresourcetimingbufferfull=function(){var t=e.listeners["resource-timing-buffer-full"];t&&t()}),se(function(t){if(t&&"measure"===t.entryType){var n=t.name;if(/choo\.morph/.test(n))e.buffer.render.morph=t;else if(/choo\.route/.test(n))e.buffer.render.route=t;else if(/choo\.render/.test(n))e.buffer.render.render=t;else if(/choo\.use/.test(n))e.buffer.use.push(t);else if(/choo\.emit/.test(n)&&!/log:/.test(n)){var r=e.listeners.event;if(r){var i=n.match(/choo\.emit\('(.*)'\)/)[1];if("render"===i||"DOMContentLoaded"===i)return;var o=n.match(/\[(\d+)\]/)[1],a=e.buffer.events[o];e.buffer.events[o]=null,r(i,a,t)}}var s=e.buffer.render;if(s.render&&s.route&&s.morph){var u=e.listeners.render;if(!u)return;for(var f={};e.buffer.render.length;){var l=e.buffer.render.pop(),c=l.name;/choo\.render/.test(c)?f.render=l:/choo\.morph/.test(c)?f.morph=l:f.route=l}s.render=s.route=s.morph=void 0,u(f)}}}),this.emitter.on("*",function(t,n,r){var i=/^log:(\w{4,5})/.exec(t);if(e.hasPerformance||"render"!==t)if("DOMContentLoaded"===t)e._emitLoaded();else if(i){i=i[1];var o=e.listeners["log:"+i];o&&o(t,n)}else if(e.emitter.listeners(t).length)"render"!==t&&e.hasPerformance&&(e.buffer.events[r]=n);else{var a=e.listeners.unhandled;a&&a(t,n)}else{var s=e.listeners.render;s&&s()}})},le.prototype._emitLoaded=function(){var e=this;fe.push(function(){var t=e.listeners.DOMContentLoaded,n=e.listeners.use,r=e.hasWindow&&window.performance&&window.performance.timing;if(t&&r&&t({interactive:r.domInteractive-r.navigationStart,loaded:r.domContentLoadedEventEnd-r.navigationStart}),e.hasPerformance){var i=e.buffer.use.reduce(function(e,t){return e+t.duration},0).toFixed();n&&n(e.buffer.use.length,i)}else n()})};var ce=X(),he=function(e,t,n){var r=!0,i=ue(t),o=S("choo");function a(e){return function(){for(var t=[],n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);ce.push(function(){o[e].apply(o,t)})}}i.on("log:debug",a("debug")),i.on("log:info",a("info")),i.on("log:warn",a("warn")),i.on("log:error",a("error")),i.on("log:fatal",a("fatal")),i.on("event",function(e,t,r){if(!n.filter||n.filter(e,t,r))if(r){var i=r.duration.toFixed(),o=i<50?"info":"warn";void 0!==t?a(o)(e,t,i+"ms"):a(o)(e,i+"ms")}else void 0!==t?a("info")(e,t):a("info")(e)}),i.on("use",function(e,t){a("debug")("use",{count:e},t+"ms")}),i.on("unhandled",function(e,t){a("error")("No listeners for "+e)}),i.on("DOMContentLoaded",function(e){if(!e)return a("info")("DOMContentLoaded");a(e.interactive<1e3?"info":"warn")("DOMContentLoaded",e.interactive+"ms to interactive")}),i.on("render",function(e){if(!e||!e.render)return a("info")("render");var t=e.render.duration.toFixed(),n="render";r&&(r=!1,n="initial "+n);var i=Math.min((600/t).toFixed(),60);if(60===i)a("info")(n,i+"fps",t+"ms");else{var o={render:e.render.duration.toFixed()+"ms"};e.morph&&(o.morph=e.morph.duration.toFixed()+"ms"),a("warn")(n,i+"fps",t+"ms",o)}}),i.on("resource-timing-buffer-full",function(){a("error")("The browser's Resource Resource timing buffer is full. Cannot store any more timing information")}),i.start()},pe={},de="\u2588";function me(e,t,n,r){this.stats=e,this.name=t,this.filter=n||function(){return!0},this.rename=r||function(e){return e}}function ve(e,t,n,r){this.Name=e,this["Total Time (ms)"]=t,this[" "]=0,this["Median (ms)"]=n,this["  "]=0,this["Total Count"]=r}function ge(){}pe=function(e,t,n,r){var i={};window.choo.perf={};var o=new me(i,"all");Object.defineProperty(window.choo.perf,"all",{get:o.get.bind(o),set:ge});var a=new me(i,"core",function(e){return/^choo/.test(e)});Object.defineProperty(window.choo.perf,"core",{get:a.get.bind(a),set:ge});var s=new me(i,"components",function(e){return!/^choo/.test(e)&&!/^bankai/.test(e)});Object.defineProperty(window.choo.perf,"components",{get:s.get.bind(s),set:ge});var u=new me(i,"events",function(e){return/^choo\.emit/.test(e)},function(e){return e.replace(/^choo\.emit\('/,"").replace(/'\)$/,"")});Object.defineProperty(window.choo.perf,"events",{get:u.get.bind(u),set:ge}),se(function(e){if("measure"===e.entryType){var t=e.name.replace(/ .*$/,"");i[t]||(i[t]={name:t,count:0,entries:[]});var n=i[t];n.count+=1,n.entries.push(e.duration)}})},me.prototype.get=function(){var e=Object.keys(this.stats).filter(this.filter),t=this,n=0,r=0,i=e.map(function(e){var i=t.stats[e],o=Number(i.entries.reduce(function(e,t){return e+t},0).toFixed(2));o>n&&(n=o);var a=function(e){if(!e.length)return 0;var t=e.slice(0).sort(function(e,t){return e-t}),n=Math.floor(t.length/2),r=t.length%2==0?(t[n]+t[n-1])/2:t[n];return Number(r.toFixed(2))}(i.entries);return a>r&&(r=a),new ve(t.rename(i.name),o,a,i.count)});function o(e){for(var t="",n=0,r=Math.round(e);n<r;n++)t+=de;return t}i.forEach(function(e){var t=e["Total Time (ms)"],i=e["Median (ms)"];e[" "]=o(t/n*100/10),e["  "]=o(i/r*100/10)});var a=i.sort(function(e,t){return t["Total Time (ms)"]-e["Total Time (ms)"]});return console.table(a),"Showing performance events for '"+this.name+"'"};var ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},be=function(e){if("number"!=typeof e||isNaN(e))throw new TypeError("Expected a number, got "+(void 0===e?"undefined":ye(e)));var t=e<0,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(t&&(e=-e),e<1)return(t?"-":"")+e+" B";var r=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),n.length-1);e=Number(e/Math.pow(1e3,r));var i=n[r];return e>=10||e%1==0?(t?"-":"")+e.toFixed(0)+" "+i:(t?"-":"")+e.toFixed(1)+" "+i};function we(e,t){console.log("%c"+e,"color: #cc99cc",t)}function xe(e){return be(e).replace(" ","")}function _e(){}var Pe=function(){Object.defineProperty(window.choo,"storage",{get:function(){if(navigator.storage)return navigator.storage.estimate().then(function(e){var t=(e.usage/e.quota).toFixed();we("Max storage:",xe(e.quota)),we("Storage used:",xe(e.usage)+" ("+t+"%)"),navigator.storage.persisted().then(function(e){we("Persistent storage:",e?"enabled":"disabled")})}),"Calculating storage quota\u2026";var e=window.location.protocol;return/https/.test(e)?"The Storage API is unavailable in this browser. We're sorry!":"The Storage API is unavailable. Serving this site over HTTPS might help enable it!"},set:_e})},Me={};(function(e){var t;t="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},Me=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),"function"==typeof Symbol&&Symbol.iterator;var Ae=function(e){var t=e._trie.trie;return Se(t)},Se=function e(t,n){var r=n||"/",i={},o=t.nodes;return Object.keys(o).forEach(function(n){var a=("/"===r?r:r+"/")+("$$"===n?":"+t.name:n),s=o[n].cb;if(void 0!==s&&(i[a]=s),0!==Object.keys(o[n].nodes).length){var u=e(o[n],a);Object.keys(u).forEach(function(e){i[e]=u[e]})}}),i},ke=e.EventEmitter,Ee={};function Te(e){if(!(this instanceof Te))return new Te(e);"number"==typeof e&&(e={max:e}),e||(e={}),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}Ee=Te,Object.defineProperty(Te.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),Te.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},Te.prototype.remove=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},Te.prototype._unlink=function(e,t,n){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=n,this.cache[this.tail].prev=null):(this.cache[t].next=n,this.cache[n].prev=t)},Te.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},Te.prototype.set=function(e,t){var n;if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){if((n=this.cache[e]).value=t,this.maxAge&&(n.modified=Date.now()),e===this.head)return t;this._unlink(e,n.prev,n.next)}else n={value:t,modified:0,next:null,prev:null},this.maxAge&&(n.modified=Date.now()),this.cache[e]=n,this.length===this.max&&this.evict();return this.length++,n.next=null,n.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},Te.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge&&(this.remove(e),1))},Te.prototype.get=function(e){if("string"!=typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},Te.prototype.evict=function(){this.tail&&this.remove(this.tail)};var Oe={};function je(e,t,n){this.cache="number"==typeof n?new Ee(n):n||new Ee(100),this.state=e,this.emit=t}function Ce(e){return new(e.bind.apply(e,arguments))}"function"==typeof Symbol&&Symbol.iterator,Oe=je,je.prototype.render=function(e,t){var n=this.cache.get(t);if(!n){for(var r=[],i=2,o=arguments.length;i<o;i++)r.push(arguments[i]);r.unshift(e,t,this.state,this.emit),n=Ce.apply(Ce,r),this.cache.set(t,n)}return n};var Le=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)Ne.call(n,r)&&(e[r]=n[r])}return e},Ne=Object.prototype.hasOwnProperty,De=function(e){if("undefined"==typeof document)throw new Error("document-ready only runs in the browser");var t=document.readyState;if("complete"===t||"interactive"===t)return setTimeout(e,0);document.addEventListener("DOMContentLoaded",function(){e()})};"function"==typeof Symbol&&Symbol.iterator;var Re,Ie=X();Fe.disabled=!0;try{Re=window.performance,Fe.disabled="true"===window.localStorage.DISABLE_NANOTIMING||!Re.mark}catch($o){}function Fe(e){if(Fe.disabled)return Be;var t=(1e4*Re.now()).toFixed()%Number.MAX_SAFE_INTEGER,n="start-"+t+"-"+e;function r(r){var i="end-"+t+"-"+e;Re.mark(i),Ie.push(function(){var o=null;try{var a=e+" ["+t+"]";Re.measure(a,n,i),Re.clearMarks(n),Re.clearMarks(i)}catch($o){o=$o}r&&r(o,e)})}return Re.mark(n),r.uuid=t,r}function Be(e){e&&Ie.push(function(){e(new Error("nanotiming: performance API unavailable"))})}var ze=Fe,Ue={};function qe(e){if(!(this instanceof qe))return new qe(e);this._name=e||"nanobus",this._starListeners=[],this._listeners={}}"function"==typeof Symbol&&Symbol.iterator,Ue=qe,qe.prototype.emit=function(e){for(var t=[],n=1,r=arguments.length;n<r;n++)t.push(arguments[n]);var i=ze(this._name+"('"+e.toString()+"')"),o=this._listeners[e];return o&&o.length>0&&this._emit(this._listeners[e],t),this._starListeners.length>0&&this._emit(this._starListeners,e,t,i.uuid),i(),this},qe.prototype.on=qe.prototype.addListener=function(e,t){return"*"===e?this._starListeners.push(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)),this},qe.prototype.prependListener=function(e,t){return"*"===e?this._starListeners.unshift(t):(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].unshift(t)),this},qe.prototype.once=function(e,t){var n=this;return this.on(e,function r(){t.apply(n,arguments),n.removeListener(e,r)}),this},qe.prototype.prependOnceListener=function(e,t){var n=this;return this.prependListener(e,function r(){t.apply(n,arguments),n.removeListener(e,r)}),this},qe.prototype.removeListener=function(e,t){return"*"===e?(this._starListeners=this._starListeners.slice(),n(this._starListeners,t)):(void 0!==this._listeners[e]&&(this._listeners[e]=this._listeners[e].slice()),n(this._listeners[e],t));function n(e,t){if(e){var n=e.indexOf(t);return-1!==n?(Z(e,n,1),!0):void 0}}},qe.prototype.removeAllListeners=function(e){return e?"*"===e?this._starListeners=[]:this._listeners[e]=[]:(this._starListeners=[],this._listeners={}),this},qe.prototype.listeners=function(e){var t="*"!==e?this._listeners[e]:this._starListeners,n=[];if(t)for(var r=t.length,i=0;i<r;i++)n.push(t[i]);return n},qe.prototype._emit=function(e,t,n,r){if(void 0!==e&&0!==e.length){void 0===n&&(n=t,t=null),t&&(n=void 0!==r?[t].concat(n,r):[t].concat(n));for(var i=e.length,o=0;o<i;o++){var a=e[o];a.apply(a,n)}}},"function"==typeof Symbol&&Symbol.iterator;var Ve=/(noopener|noreferrer) (noopener|noreferrer)/,We=/^[\w-_]+:/;function Ge(e,t){if(!e)throw new Error(t||"AssertionError")}Ge.notEqual=function(e,t,n){},Ge.notOk=function(e,t){},Ge.equal=function(e,t,n){},Ge.ok=Ge;var He=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"],Ye=He.length;function $e(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}var Qe=function(e,t){var n=e.nodeType,r=e.nodeName;1===n&&function(e,t){for(var n=t.attributes,r=e.attributes,i=null,o=null,a=null,s=null,u=r.length-1;u>=0;--u)a=(s=r[u]).name,i=s.namespaceURI,o=s.value,i?(a=s.localName||a,t.getAttributeNS(i,a)!==o&&t.setAttributeNS(i,a,o)):t.hasAttribute(a)?t.getAttribute(a)!==o&&("null"===o||"undefined"===o?t.removeAttribute(a):t.setAttribute(a,o)):t.setAttribute(a,o);for(var f=n.length-1;f>=0;--f)!1!==(s=n[f]).specified&&(a=s.name,(i=s.namespaceURI)?(a=s.localName||a,e.hasAttributeNS(i,a)||t.removeAttributeNS(i,a)):e.hasAttributeNS(null,a)||t.removeAttribute(a))}(e,t),3!==n&&8!==n||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue),"INPUT"===r?function(e,t){var n=e.value,r=t.value;$e(e,t,"checked"),$e(e,t,"disabled"),n!==r&&(t.setAttribute("value",n),t.value=n),"null"===n&&(t.value="",t.removeAttribute("value")),e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===r?function(e,t){$e(e,t,"selected")}(e,t):"TEXTAREA"===r&&function(e,t){var n=e.value;if(n!==t.value&&(t.value=n),t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t),function(e,t){for(var n=0;n<Ye;n++){var r=He[n];e[r]?t[r]=e[r]:t[r]&&(t[r]=void 0)}}(e,t)};"function"==typeof Symbol&&Symbol.iterator;var Xe=3;function Ke(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||Je(e)!==Je(t)?e:(Qe(e,t),Ze(e,t),t):null:e}function Je(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function Ze(e,t){for(var n,r,i,o,a=0,s=0;n=t.childNodes[s],r=e.childNodes[s-a],n||r;s++)if(r)if(n)if(et(r,n))(i=Ke(r,n))!==n&&(t.replaceChild(i,n),a++);else{o=null;for(var u=s;u<t.childNodes.length;u++)if(et(t.childNodes[u],r)){o=t.childNodes[u];break}o?((i=Ke(r,o))!==o&&a++,t.insertBefore(i,n)):r.id||n.id?(t.insertBefore(r,n),a++):(i=Ke(r,n))!==n&&(t.replaceChild(i,n),a++)}else t.appendChild(r),a++;else t.removeChild(n),s--}function et(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&e.type===Xe&&e.nodeValue===t.nodeValue}var tt=function(e,t,n){return n&&n.childrenOnly?(Ze(t,e),e):Ke(t,e)};"function"==typeof Symbol&&Symbol.iterator;var nt=/([^?=&]+)(=([^&]*))?/g;"function"==typeof Symbol&&Symbol.iterator;var rt=Object.prototype.hasOwnProperty,it=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)ot.call(n,r)&&(e[r]=n[r])}return e},ot=Object.prototype.hasOwnProperty,at={};function st(){if(!(this instanceof st))return new st;this.trie={nodes:{}}}"function"==typeof Symbol&&Symbol.iterator,at=st,st.prototype.create=function(e){var t=e.replace(/^\//,"").split("/");return function e(n,r){var i=t.hasOwnProperty(n)&&t[n];if(!1===i)return r;var o=null;return/^:|^\*/.test(i)?(r.nodes.hasOwnProperty("$$")?o=r.nodes.$$:(o={nodes:{}},r.nodes.$$=o),"*"===i[0]&&(r.wildcard=!0),r.name=i.replace(/^:|^\*/,"")):r.nodes.hasOwnProperty(i)?o=r.nodes[i]:(o={nodes:{}},r.nodes[i]=o),e(n+1,o)}(0,this.trie)},st.prototype.match=function(e){var t=e.replace(/^\//,"").split("/"),n={},r=function e(r,i){if(void 0!==i){var o=t[r];if(void 0===o)return i;if(i.nodes.hasOwnProperty(o))return e(r+1,i.nodes[o]);if(i.name){try{n[i.name]=decodeURIComponent(o)}catch($o){return e(r,void 0)}return e(r+1,i.nodes.$$)}if(i.wildcard){try{n.wildcard=decodeURIComponent(t.slice(r).join("/"))}catch($o){return e(r,void 0)}return i.nodes.$$}return e(r+1)}}(0,this.trie);if(r)return(r=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)rt.call(n,r)&&(e[r]=n[r])}return e}(r)).params=n,r},st.prototype.mount=function(e,t){var n=e.replace(/^\//,"").split("/"),r=null,i=null;if(1===n.length)i=n[0],r=this.create(i);else{var o=n.join("/");i=n[0],r=this.create(o)}it(r.nodes,t.nodes),t.name&&(r.name=t.name),r.nodes[""]&&(Object.keys(r.nodes[""]).forEach(function(e){"nodes"!==e&&(r[e]=r.nodes[""][e])}),it(r.nodes,r.nodes[""].nodes),delete r.nodes[""].nodes)},"function"==typeof Symbol&&Symbol.iterator;var ut=function e(t){if(!(this instanceof e))return new e(t);var n=(t||"").replace(/^\//,""),r=at();return i._trie=r,i.on=function(e,t){var n=t._wayfarer&&t._trie?t:function(){return t.apply(this,Array.prototype.slice.call(arguments))};(e=e||"/",n.route=e,n._wayfarer&&n._trie)?r.mount(e,n._trie.trie):r.create(e).cb=n;return i},i.emit=i,i.match=o,i._wayfarer=!0,i;function i(e){var t=o(e),n=new Array(arguments.length);n[0]=t.params;for(var r=1;r<n.length;r++)n[r]=arguments[r];return t.cb.apply(t.cb,n)}function o(e){var t=r.match(e);if(t&&t.cb)return new a(t);var i=r.match(n);if(i&&i.cb)return new a(i);throw new Error("route '"+e+"' did not match")}function a(e){this.cb=e.cb,this.route=e.cb.route,this.params=e.params}},ft={},lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct=/file:\/\//.test("object"===("undefined"==typeof window?"undefined":lt(window))&&window.location&&window.location.origin),ht=new RegExp("^(file://|/)(.*.html?/?)?"),pt=new RegExp("^(http(s)?(://))?(www.)?[a-zA-Z0-9-_.]+(:[0-9]{1,5})?(/{1})?"),dt=new RegExp("#"),mt=new RegExp("[?].*$");function vt(e){if(!(this instanceof vt))return new vt(e);e=e||{},this.router=ut(e.default||"/404")}function gt(e,t){return e=t?e.replace(ht,""):e.replace(pt,""),decodeURI(e.replace(mt,"").replace(dt,"/"))}ft=vt,vt.prototype.on=function(e,t){e=e.replace(/^[#\/]/,""),this.router.on(e,t)},vt.prototype.emit=function(e){return e=gt(e,ct),this.router.emit(e)},vt.prototype.match=function(e){return e=gt(e,ct),this.router.match(e)};var yt=function(e,t){if(e)try{var n=document.querySelector(e);n&&n.scrollIntoView(t)}catch($o){}},bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt=_t,xt={};function _t(e){if(!(this instanceof _t))return new _t(e);e=e||{};var t=this;this._events={DOMCONTENTLOADED:"DOMContentLoaded",DOMTITLECHANGE:"DOMTitleChange",REPLACESTATE:"replaceState",PUSHSTATE:"pushState",NAVIGATE:"navigate",POPSTATE:"popState",RENDER:"render"},this._historyEnabled=void 0===e.history||e.history,this._hrefEnabled=void 0===e.href||e.href,this._hashEnabled=void 0===e.hash||e.hash,this._hasWindow="undefined"!=typeof window,this._cache=e.cache,this._loaded=!1,this._stores=[],this._tree=null;var n={events:this._events,components:{}};this._hasWindow?(this.state=window.initialState?Le(window.initialState,n):n,delete window.initialState):this.state=n,this.router=ft({curry:!0}),this.emitter=Ue("choo.emit"),this.emit=this.emitter.emit.bind(this.emitter),this._hasWindow&&(this.state.title=document.title),this.emitter.prependListener(this._events.DOMTITLECHANGE,function(e){t.state.title=e,t._hasWindow&&(document.title=e)})}_t.prototype.route=function(e,t){this.router.on(e,t)},_t.prototype.use=function(e){var t=this;this._stores.push(function(n){var r="choo.use";r=e.storeName?r+"("+e.storeName+")":r;var i=ze(r);e(n,t.emitter,t),i()})},_t.prototype.start=function(){var e,t,n=this;return this._historyEnabled&&(this.emitter.prependListener(this._events.NAVIGATE,function(){n._matchRoute(),n._loaded&&(n.emitter.emit(n._events.RENDER),setTimeout(yt.bind(null,window.location.hash),0))}),this.emitter.prependListener(this._events.POPSTATE,function(){n.emitter.emit(n._events.NAVIGATE)}),this.emitter.prependListener(this._events.PUSHSTATE,function(e){window.history.pushState(xt,null,e),n.emitter.emit(n._events.NAVIGATE)}),this.emitter.prependListener(this._events.REPLACESTATE,function(e){window.history.replaceState(xt,null,e),n.emitter.emit(n._events.NAVIGATE)}),window.onpopstate=function(){n.emitter.emit(n._events.POPSTATE)},n._hrefEnabled&&(e=function(e){var t=e.href,r=e.hash;t!==window.location.href?n.emitter.emit(n._events.PUSHSTATE,t):!n._hashEnabled&&r&&yt(r)},t=t||window.document,window.addEventListener("click",function(n){if(!(n.button&&0!==n.button||n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.defaultPrevented)){var r=function e(n){if(n&&n!==t)return"a"!==n.localName||void 0===n.href?e(n.parentNode):n}(n.target);r&&(window.location.protocol!==r.protocol||window.location.hostname!==r.hostname||window.location.port!==r.port||r.hasAttribute("data-nanohref-ignore")||r.hasAttribute("download")||"_blank"===r.getAttribute("target")&&Ve.test(r.getAttribute("rel"))||We.test(r.getAttribute("href"))||(n.preventDefault(),e(r)))}}))),this._setCache(this.state),this._stores.forEach(function(e){e(n.state)}),this._matchRoute(),this._tree=this._prerender(this.state),this.emitter.prependListener(n._events.RENDER,function(e,t){t||(t=window.requestAnimationFrame);var n=!1,r=null;return function(){null!==r||n||(n=!0,t(function(){n=!1;for(var t=r.length,i=new Array(t),o=0;o<t;o++)i[o]=r[o];e.apply(e,i),r=null})),r=arguments}}(function(){var e=ze("choo.render"),t=n._prerender(n.state),r=ze("choo.morph");tt(n._tree,t),r(),e()})),De(function(){n.emitter.emit(n._events.DOMCONTENTLOADED),n._loaded=!0}),this._tree},_t.prototype.mount=function(e){if("object"!==("undefined"==typeof window?"undefined":bt(window)))return this.selector=e,this;var t=this;De(function(){var n=ze("choo.render"),r=t.start();t._tree="string"==typeof e?document.querySelector(e):e;var i=ze("choo.morph");tt(t._tree,r),i(),n()})},_t.prototype.toString=function(e,t){this.state=Le(this.state,t||{});var n=this;this._setCache(this.state),this._stores.forEach(function(e){e(n.state)}),this._matchRoute(e);var r=this._prerender(this.state);return"string"==typeof r.outerHTML?r.outerHTML:r.toString()},_t.prototype._matchRoute=function(e){var t,n;e?(t=e.replace(/\?.+$/,"").replace(/\/$/,""),this._hashEnabled||(t=t.replace(/#.+$/,"")),n=e):(t=window.location.pathname.replace(/\/$/,""),this._hashEnabled&&(t+=window.location.hash.replace(/^#/,"/")),n=window.location.search);var r,i=this.router.match(t);return this._handler=i.cb,this.state.href=t,this.state.query=(r={},n.replace(/^.*\?/,"").replace(nt,function(e,t,n,i){r[decodeURIComponent(t)]=decodeURIComponent(i)}),r),this.state.route=i.route,this.state.params=i.params,this.state},_t.prototype._prerender=function(e){var t=ze("choo.prerender('"+e.route+"')"),n=this._handler(e,this.emit);return t(),n},_t.prototype._setCache=function(e){var t=new Oe(e,this.emitter.emit.bind(this.emitter),this._cache);function n(e,n){for(var r=[],i=0,o=arguments.length;i<o;i++)r.push(arguments[i]);return t.render.apply(t,r)}e.cache=n,n.toJSON=function(){return null}};var Pt=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","percussion","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],Mt={decode:function(e,t){for(var n,r,i,o=e.replace(/[^A-Za-z0-9\+\/]/g,""),a=o.length,s=t?Math.ceil((3*a+1>>2)/t)*t:3*a+1>>2,u=new Uint8Array(s),f=0,l=0,c=0;c<a;c++)if(r=3&c,f|=((i=o.charCodeAt(c))>64&&i<91?i-65:i>96&&i<123?i-71:i>47&&i<58?i+4:43===i?62:47===i?63:0)<<18-6*r,3===r||a-c==1){for(n=0;n<3&&l<s;n++,l++)u[l]=f>>>(16>>>n&24)&255;f=0}return u}},At={exports:{}},St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function kt(e){return function(t){return"string"==typeof t&&e.test(t)}}function Et(e,t){return"string"==typeof e?e+t:"function"==typeof e?e(t):t}function Tt(e,t,n,r){var i=t instanceof ArrayBuffer?Ot:jt(t)?Ct:t&&"function"==typeof t.then?Lt:Nt(t)?Dt:t&&"object"===(void 0===t?"undefined":St(t))?Rt:It(t)?Ft:Bt(t)?zt:Ut(t)?qt:null;return i?i(e,t,n||{}):r?Promise.resolve(r):Promise.reject("Source not valid ("+t+")")}function Ot(e,t,n){return new Promise(function(n,r){e.decodeAudioData(t,function(e){n(e)},function(){r("Can't decode audio data ("+t.slice(0,30)+"...)")})})}Tt.fetch=function(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;t&&(i.responseType=t),i.open("GET",e),i.onload=function(){200===i.status?n(i.response):r(Error(i.statusText))},i.onerror=function(){r(Error("Network Error"))},i.send()})};var jt=kt(/\.(mp3|wav|ogg)(\?.*)?$/i);function Ct(e,t,n){var r=Et(n.from,t);return Tt(e,Tt.fetch(r,"arraybuffer"),n)}function Lt(e,t,n){return t.then(function(t){return Tt(e,t,n)})}var Nt=Array.isArray;function Dt(e,t,n){return Promise.all(t.map(function(t){return Tt(e,t,n,t)}))}function Rt(e,t,n){var r={},i=Object.keys(t).map(function(i){if(n.only&&-1===n.only.indexOf(i))return null;var o=t[i];return Tt(e,o,n,o).then(function(e){r[i]=e})});return Promise.all(i).then(function(){return r})}var It=kt(/\.json(\?.*)?$/i);function Ft(e,t,n){var r=Et(n.from,t);return Tt(e,Tt.fetch(r,"text").then(JSON.parse),n)}var Bt=kt(/^data:audio/);function zt(e,t,n){var r=t.indexOf(",");return Tt(e,Mt.decode(t.slice(r+1)).buffer,n)}var Ut=kt(/\.js(\?.*)?$/i);function qt(e,t,n){var r=Et(n.from,t);return Tt(e,Tt.fetch(r,"text").then(Vt),n)}function Vt(e){var t=e.indexOf("MIDI.Soundfont.");if(t<0)throw Error("Invalid MIDI.js Soundfont format");t=e.indexOf("=",t)+2;var n=e.lastIndexOf(",");return JSON.parse(e.slice(t,n)+"}")}"object"===St(At)&&At.exports&&(At.exports=Tt),"undefined"!=typeof window&&(window.loadAudio=Tt),At=At.exports;var Wt=function(e){return e.on=function(t,n){if(1===arguments.length&&"function"==typeof t)return e.on("event",t);var r,i,o="on"+t,a=e[o];return e[o]=a?(r=a,i=n,function(e,t,n,o){r(e,t,n,o),i(e,t,n,o)}):n,e},e},Gt={exports:{}};(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){"object"===(void 0===Gt.exports?"undefined":t(Gt.exports))?Gt.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).midimessage=n()}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return new function(e){if(this._event=e,this._data=e.data,this.receivedTime=e.receivedTime,this._data&&this._data.length<2)console.warn("Illegal MIDI message of length",this._data.length);else switch(this._messageCode=240&e.data[0],this.channel=15&e.data[0],this._messageCode){case 128:this.messageType="noteoff",this.key=127&e.data[1],this.velocity=127&e.data[2];break;case 144:this.messageType="noteon",this.key=127&e.data[1],this.velocity=127&e.data[2];break;case 160:this.messageType="keypressure",this.key=127&e.data[1],this.pressure=127&e.data[2];break;case 176:this.messageType="controlchange",this.controllerNumber=127&e.data[1],this.controllerValue=127&e.data[2],120===this.controllerNumber&&0===this.controllerValue?this.channelModeMessage="allsoundoff":121===this.controllerNumber?this.channelModeMessage="resetallcontrollers":122===this.controllerNumber?0===this.controllerValue?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":123===this.controllerNumber&&0===this.controllerValue?this.channelModeMessage="allnotesoff":124===this.controllerNumber&&0===this.controllerValue?this.channelModeMessage="omnimodeoff":125===this.controllerNumber&&0===this.controllerValue?this.channelModeMessage="omnimodeon":126===this.controllerNumber?this.channelModeMessage="monomodeon":127===this.controllerNumber&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=e.data[1];break;case 208:this.messageType="channelpressure",this.pressure=127&e.data[1];break;case 224:this.messageType="pitchbendchange";var t=127&e.data[2],n=127&e.data[1];this.pitchBend=(t<<8)+n}}(e)},t.exports=n.default},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),Gt=Gt.exports;var Ht=function(e){return e.listenToMidi=function(t,n){var r={},i=n||{},o=i.gain||function(e){return e/127};return t.onmidimessage=function(t){var n=t.messageType?t:Gt(t);if("noteon"===n.messageType&&0===n.velocity&&(n.messageType="noteoff"),!i.channel||n.channel===i.channel)switch(n.messageType){case"noteon":r[n.key]=e.play(n.key,0,{gain:o(n.velocity)});break;case"noteoff":r[n.key]&&(r[n.key].stop(),delete r[n.key])}},e},e},Yt={},$t=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,Qt=[0,2,4,5,7,9,11];function Xt(e,t,n){if("string"!=typeof e)return null;var r=$t.exec(e);if(!r||!t&&r[4])return null;var i={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};return i.pc=i.letter+i.acc,i.step=(i.letter.charCodeAt(0)+3)%7,i.alt="b"===i.acc[0]?-i.acc.length:i.acc.length,i.chroma=Qt[i.step]+i.alt,r[3]&&(i.oct=+r[3],i.midi=i.chroma+12*(i.oct+1),i.freq=Kt(i.midi,n)),t&&(i.tonicOf=r[4]),i}function Kt(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var Jt={parse:Xt,regex:function(){return $t},midiToFreq:Kt};["letter","acc","pc","step","alt","chroma","oct","midi","freq"].forEach(function(e){Jt[e]=function(t){var n=Xt(t);return n&&void 0!==n[e]?n[e]:null}}),Yt=Jt;var Zt=function(e){return function(e){return null!==e&&e!==[]&&e>=0&&e<129}(e)?+e:Yt.midi(e)},en=function(e){if(e.buffers){var t=e.opts.map,n="function"==typeof t?t:Zt,r=function(e){return e?n(e)||e:null};e.buffers=function(e,t){return Object.keys(e).reduce(function(n,r){return n[t(r)]=e[r],n},{})}(e.buffers,r);var i=e.start;e.start=function(e,t,n){var o=r(e),a=o%1;return a&&(o=Math.floor(o),n=Object.assign(n||{},{cents:Math.floor(100*a)})),i(o,t,n)}}return e},tn=function(e){var t=e.createGain(),n=t._voltage=function(e){var t=e.createBufferSource(),n=e.createBuffer(1,2,e.sampleRate);return n.getChannelData(0).set(rn),t.buffer=n,t.loop=!0,t}(e),r=on(n),i=on(n),o=on(n);return t._startAmount=on(i),t._endAmount=on(o),t._multiplier=on(r),t._multiplier.connect(t),t._startAmount.connect(t),t._endAmount.connect(t),t.value=r.gain,t.startValue=i.gain,t.endValue=o.gain,t.startValue.value=0,t.endValue.value=0,Object.defineProperties(t,nn),t},nn={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(e){var t=this._multiplier.gain,n=this._startAmount.gain,r=this._endAmount.gain;this._voltage.start(e),this._decayFrom=this._decayFrom=e+this.attack,this._startedAt=e;var i=this.sustain;t.cancelScheduledValues(e),n.cancelScheduledValues(e),r.cancelScheduledValues(e),r.setValueAtTime(0,e),this.attack?(t.setValueAtTime(0,e),t.linearRampToValueAtTime(1,e+this.attack),n.setValueAtTime(1,e),n.linearRampToValueAtTime(0,e+this.attack)):(t.setValueAtTime(1,e),n.setValueAtTime(0,e)),this.decay&&t.setTargetAtTime(i,this._decayFrom,an(this.decay))}},stop:{value:function(e,t){t&&(e-=this.release);var n=e+this.release;if(this.release){var r=this._multiplier.gain,i=this._startAmount.gain,o=this._endAmount.gain;r.cancelScheduledValues(e),i.cancelScheduledValues(e),o.cancelScheduledValues(e);var a=an(this.release);if(this.attack&&e<this._decayFrom){var s=function(e,t,n,r,i){var o=0+(i-n)/(r-n)*1;return o<=0&&(o=0),o>=1&&(o=1),o}(0,0,this._startedAt,this._decayFrom,e);r.linearRampToValueAtTime(s,e),i.linearRampToValueAtTime(1-s,e),i.setTargetAtTime(0,e,a)}o.setTargetAtTime(1,e,a),r.setTargetAtTime(0,e,a)}return this._voltage.stop(n),n}},onended:{get:function(){return this._voltage.onended},set:function(e){this._voltage.onended=e}}},rn=new Float32Array([1,1]);function on(e){var t=e.context.createGain();return e.connect(t),t}function an(e){return Math.log(e+1)/Math.log(100)}var sn={},un={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function fn(e){return"number"==typeof e}var ln=["attack","decay","sustain","release"],cn=function(e,t,n){var r=!1,i=0,o={},a=e.createGain();a.gain.value=1;var s=Object.assign({},un,n),u={context:e,out:a,opts:s};return t instanceof AudioBuffer?u.buffer=t:u.buffers=t,u.start=function(t,n,a){if(u.buffer&&null!==t)return u.start(null,t,n);var s=t?u.buffers[t]:u.buffer;if(s){if(r){var l=a||sn;n=Math.max(e.currentTime,n||0),u.emit("start",n,t,l);var c=f(t,s,l);return c.id=function(t,n){return n.id=i++,o[n.id]=n,n.source.onended=function(){var t=e.currentTime;n.source.disconnect(),n.env.disconnect(),n.disconnect(),u.emit("ended",t,n.id,n)},n.id}(0,c),c.env.start(n),c.source.start(n),u.emit("started",n,c.id,c),l.duration&&c.stop(n+l.duration),c}console.warn("SamplePlayer not connected to any node.")}else console.warn("Buffer "+t+" not found.")},u.play=function(e,t,n){return u.start(e,t,n)},u.stop=function(e,t){var n;return(t=t||Object.keys(o)).map(function(t){return(n=o[t])?(n.stop(e),n.id):null})},u.connect=function(e){return r=!0,a.connect(e),u},u.emit=function(e,t,n,r){u.onevent&&u.onevent(e,t,n,r);var i=u["on"+e];i&&i(t,n,r)},u;function f(t,n,r){var i,o=e.createGain();return o.gain.value=0,o.connect(a),o.env=function(e,t,n){var r=tn(e),i=t.adsr||n.adsr;return ln.forEach(function(e,o){r[e]=i?i[o]:t[e]||n[e]}),r.value.value=fn(t.gain)?t.gain:fn(n.gain)?n.gain:1,r}(e,r,s),o.env.connect(o.gain),o.source=e.createBufferSource(),o.source.buffer=n,o.source.connect(o),o.source.loop=r.loop||s.loop,o.source.playbackRate.value=(i=r.cents||s.cents)?Math.pow(2,i/1200):1,o.source.loopStart=r.loopStart||s.loopStart,o.source.loopEnd=r.loopEnd||s.loopEnd,o.stop=function(n){var r=n||e.currentTime;u.emit("stop",r,t);var i=o.env.stop(r);o.source.stop(i)},o}},hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn=Array.isArray,dn={},mn=function(e){return e.schedule=function(t,n){var r,i,o,a,s=e.context.currentTime,u=t<s?s:t;return e.emit("schedule",u,n),n.map(function(t){return t?(pn(t)?(r=t[0],i=t[1]):(r=t.time,i=t),function(e){return e&&"object"===(void 0===e?"undefined":hn(e))}(i)?(o=i.name||i.key||i.note||i.midi||null,a=i):(o=i,a=dn),e.start(o,u+(r||0),a)):null})},e},vn={exports:{}};function gn(e,t,n){return Ht(mn(en(Wt(cn(e,t,n)))))}"object"===("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(vn)&&vn.exports&&(vn.exports=gn),"undefined"!=typeof window&&(window.SamplePlayer=gn),vn=vn.exports;var yn,bn={exports:{}},wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};yn=function(e){"use strict";function t(e,t){return Array(t+1).join(e)}function n(e){return"number"==typeof e}function r(e,t){return Math.pow(2,(e-69)/12)*(t||440)}function i(e,t,n){if("string"!=typeof e)return null;var i=u.exec(e);if(!i||!t&&i[4])return null;var o={letter:i[1].toUpperCase(),acc:i[2].replace(/x/g,"##")};o.pc=o.letter+o.acc,o.step=(o.letter.charCodeAt(0)+3)%7,o.alt="b"===o.acc[0]?-o.acc.length:o.acc.length;var a=f[o.step]+o.alt;return o.chroma=a<0?12+a:a%12,i[3]&&(o.oct=+i[3],o.midi=a+12*(o.oct+1),o.freq=r(o.midi,n)),t&&(o.tonicOf=i[4]),o}function o(e){return n(e)?e<0?t("b",-e):t("#",e):""}function a(e){return n(e)?""+e:""}function s(e){if((n(e)||function(e){return"string"==typeof e}(e))&&e>=0&&e<128)return+e;var t=i(e);return t&&void 0!==t.midi?t.midi:null}var u=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,f=[0,2,4,5,7,9,11];e.regex=function(){return u},e.parse=i,e.build=function e(t,n,r){return null==t?null:t.step?e(t.step,t.alt,t.oct):t<0||t>6?null:"CDEFGAB".charAt(t)+o(n)+a(r)},e.midi=s,e.freq=function(e,t){var n=s(e);return null===n?null:r(n,t)},e.letter=function(e){return(i(e)||{}).letter},e.acc=function(e){return(i(e)||{}).acc},e.pc=function(e){return(i(e)||{}).pc},e.step=function(e){return(i(e)||{}).step},e.alt=function(e){return(i(e)||{}).alt},e.chroma=function(e){return(i(e)||{}).chroma},e.oct=function(e){return(i(e)||{}).oct}},"object"==(void 0===bn.exports?"undefined":wn(bn.exports))?yn(bn.exports):"function"==typeof define&&define.amd?define(["exports"],yn):yn(this.NoteParser=this.NoteParser||{}),bn=bn.exports;var xn={};function _n(e,t){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof _n))return new _n(e);this.nameToUrl=t||_n.nameToUrl,this.ctx=e,this.instruments={},this.promises=[]}function Pn(e,t){return t=t||{},function(n,r,i,o){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var a=n>0&&n<129?+n:bn.midi(n),s=a?bn.midiToFreq(a,440):null;if(s){i=i||.2;var u=(o=o||{}).destination||t.destination||e.destination,f=o.vcoType||t.vcoType||"sine",l=o.gain||t.gain||.4,c=e.createOscillator();c.type=f,c.frequency.value=s;var h=e.createGain();return h.gain.value=l,c.connect(h),h.connect(u),c.start(r),i>0&&c.stop(r+i),c}}}_n.prototype.onready=function(e){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(e)},_n.prototype.instrument=function(e,t){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var n=this.ctx;if((e=e||"default")in this.instruments)return this.instruments[e];var r={name:e,play:Pn(n,t)};if(this.instruments[e]=r,"default"!==e){var i=_n.instrument(n,e,t).then(function(e){return r.play=e.play,r});this.promises.push(i),r.onready=function(e){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),i.then(e)}}else r.onready=function(e){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),e()};return r},_n.loadBuffers=function(e,t,n){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),_n.instrument(e,t,n).then(function(e){return e.buffers})},_n.noteToMidi=bn.midi,xn=_n;var Mn={exports:{}},An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Sn(e){return/\.js(\?.*)?$/i.test(e)}function kn(e,t,n){return"https://gleitz.github.io/midi-js-soundfonts/"+(t="FluidR3_GM"===t?t:"MusyngKite")+"/"+e+"-"+(n="ogg"===n?n:"mp3")+".js"}xn.instrument=function e(t,n,r){if(1===arguments.length)return function(n,r){return e(t,n,r)};var i=r||{},o=i.isSoundfontURL||Sn,a=i.nameToUrl||kn,s=o(n)?n:a(n,i.soundfont,i.format);return At(t,s,{only:i.only||i.notes}).then(function(e){var r=vn(t,e,i).connect(i.destination?i.destination:t.destination);return r.url=s,r.name=n,r})},xn.nameToUrl=kn,"object"===An(Mn)&&Mn.exports&&(Mn.exports=xn),"undefined"!=typeof window&&(window.Soundfont=xn),Mn=Mn.exports;var En=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(Yo){i=!0,o=Yo}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Tn={AMDF:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sampleRate||44100,n=e.minFrequency||82,r=e.maxFrequency||1e3,i=e.sensitivity||.1,o=e.ratio||5,a=[],s=Math.round(t/n+.5),u=Math.round(t/r+.5);return function(e){var n=e.length,r=0,f=1/0,l=-1/0,c=void 0,h=void 0,p=void 0,d=void 0,m=void 0,v=void 0,g=void 0,y=void 0;for(d=0;d<n;d++)if(u<=d&&d<=s){for(g=0,y=d,r=0,c=[],h=[];g<n-d;r++,y++,g++)c[r]=e[g],h[r]=e[y];var b=c.length;for(p=[],v=0;v<b;v++)p[v]=c[v]-h[v];var w=0;for(v=0;v<b;v++)w+=Math.abs(p[v]);a[d]=w}for(m=u;m<s;m++)a[m]<f&&(f=a[m]),a[m]>l&&(l=a[m]);var x=Math.round(i*(l-f)+f);for(m=u;m<=s&&a[m]>x;m++);var _=u/2;f=a[m];var P=m;for(d=m-1;d<m+_&&d<=s;d++)a[d]<f&&(f=a[d],P=d);return Math.round(a[P]*o)<l?t/P:null}},YIN:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.threshold||.1,n=e.sampleRate||44100,r=e.probabilityThreshold||.1;return function(e){var i=void 0;for(i=1;i<e.length;i*=2);for(var o=(i/=2)/2,a=new Float32Array(o),s=void 0,u=void 0,f=0;f<o;f++)a[f]=0;for(var l=1;l<o;l++)for(var c=0;c<o;c++){var h=e[c]-e[c+l];a[l]+=h*h}a[0]=1,a[1]=1;for(var p=0,d=1;d<o;d++)p+=a[d],a[d]*=d/p;for(u=2;u<o;u++)if(a[u]<t){for(;u+1<o&&a[u+1]<a[u];)u++;s=1-a[u];break}if(u==o||a[u]>=t)return null;if(s<r)return null;var m,v,g=void 0;if(v=u+1<o?u+1:u,(m=u<1?u:u-1)===u)g=a[u]<=a[v]?u:v;else if(v===u)g=a[u]<=a[m]?u:m;else{var y=a[m],b=a[u],w=a[v];g=u+(w-y)/(2*(2*b-w-y))}return n/g}},DynamicWavelet:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sampleRate||44100;return function(t){for(var n=[],r=[],i=t.length,o=null,a=0,s=0,u=0,f=0;f<i;f++){var l=t[f];a+=l,u=Math.max(u,l),s=Math.min(s,l)}for(var c=.75*((u-=a/=i)>-1*(s-=a)?u:-1*s),h=0,p=-1,d=t.length,m=void 0,v=void 0,g=void 0;m=~~(e/(3e3*Math.pow(2,h))),!(d<2);){var y=void 0,b=-1e3,w=-1e6,x=-1e6,_=!1,P=!1;g=0,v=0;for(var M=2;M<d;M++){var A=t[M]-a,S=t[M-1]-a;S<=0&&A>0&&(_=!0),S>=0&&A<0&&(P=!0),y=A-S,b>-1e3&&(P&&b<0&&y>=0&&Math.abs(A)>=c&&M>w+m&&(n[g++]=M,w=M,P=!1),_&&b>0&&y<=0&&Math.abs(A)>=c&&M>x+m&&(r[v++]=M,x=M,_=!1)),b=y}if(0===g&&0===v)break;for(var k=[],E=0;E<d;E++)k[E]=0;for(var T=0;T<g;T++)for(var O=1;O<3;O++)T+O<g&&(k[Math.abs(n[T]-n[T+O])]+=1);for(var j=-1,C=-1,L=0;L<d;L++){for(var N=0,D=-1*m;D<=m;D++)L+D>=0&&L+D<d&&(N+=k[L+D]);N===C?L===2*j&&(j=L):N>C&&(C=N,j=L)}for(var R=0,I=0,F=-m;F<=m;F++)if(j+F>=0&&j+F<i){var B=k[j+F];B>0&&(I+=B,R+=(j+F)*B)}if(R/=I,p>-1&&Math.abs(2*R-p)<=2*m){o=e/(Math.pow(2,h-1)*p);break}if(p=R,++h>=6||d<2)break;var z=t.subarray(0);d===k.length&&(z=new Float32Array(d/2));for(var U=0;U<d/2;U++)z[U]=(t[2*U]+t[2*U+1])/2;t=z,d/=2}return o}},Macleod:function(e){var t=(e=e||{}).cutoff||.97,n=e.sampleRate||44100,r=e.bufferSize||1024,i=new Float32Array(r),o=void 0,a=void 0,s=[],u=[],f=[],l={},c=function(e){var t=i[e-1],n=i[e],r=i[e+1],s=r+t-2*n;if(0===s)o=e,a=n;else{var u=t-r;o=e+u/(2*s),a=n-u*u/(8*s)}};return function(e){var r=void 0;s=[],u=[],f=[],function(e){for(var t=0;t<e.length;t++){for(var n=0,r=0,o=0;o<e.length-t;o++)n+=e[o]*e[o+t],r+=e[o]*e[o]+e[o+t]*e[o+t];i[t]=2*n/r}}(e),function(){for(var e=0,t=0;e<(i.length-1)/3&&i[e]>0;)e++;for(;e<i.length-1&&i[e]<=0;)e++;for(0==e&&(e=1);e<i.length-1;)if(i[e]>i[e-1]&&i[e]>=i[e+1]&&(0==t?t=e:i[e]>i[t]&&(t=e)),++e<i.length-1&&i[e]<=0)for(t>0&&(s.push(t),t=0);e<i.length-1&&i[e]<=0;)e++;t>0&&s.push(t)}();for(var h=-1/0,p=0;p<s.length;p++){var d=s[p];h=Math.max(h,i[d]),i[d]>.5&&(c(d),f.push(a),u.push(o),h=Math.max(h,a))}if(u.length){for(var m=t*h,v=0,g=0;g<f.length;g++)if(f[g]>=m){v=g;break}var y=u[v],b=n/y;r=b>80?b:-1}else r=-1;return l.probability=h,l.freq=r,l}},frequencies:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.tempo||120,i=n.quantization||4,o=n.sampleRate||44100,a=t.length,s=Math.round(60*o/(i*r)),u=void 0;u=Array.isArray(e)?function(e,t){var n=e.map(function(e){return e(t)}).filter(Boolean).sort(function(e,t){return e<t?-1:1});if(1===n.length)return n[0];if(2===n.length){var r=En(n,2),i=r[0],o=r[1];return 2*i>o?Math.sqrt(i*o):i}var a=n[0],s=n[1],u=n[n.length-2],f=n[n.length-1],l=2*a>s?n:n.slice(1),c=2*u>f?l:l.slice(0,-1);return Math.pow(c.reduce(function(e,t){return e*t},1),1/c.length)}.bind(null,e):e;for(var f=[],l=0,c=a-s;l<=c;l+=s){var h=u(t.slice(l,l+s));f.push(h)}return f}},On={};Object.defineProperty(On,"__esModule",{value:!0});var jn="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),Cn=function(e){return"string"!=typeof e?jn.slice():jn.filter(function(t){var n=t[1]||" ";return-1!==e.indexOf(n)})},Ln=Cn(" #"),Nn=Cn(" b"),Dn=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Rn(e){"string"!=typeof e&&(e="");var t=Dn.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}var In,Fn,Bn=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),zn=[0,2,4,5,7,9,11],Un=(In=function(e){var t=Rn(e);if(""===t[0]||""!==t[3])return Bn;var n=t[0],r=t[1],i=t[2],o={letter:n,acc:r,octStr:i,pc:n+r,name:n+r+i,step:(n.charCodeAt(0)+3)%7,alt:"b"===r[0]?-r.length:r.length,oct:i.length?+i:null,chroma:0,midi:null,freq:null};return o.chroma=(zn[o.step]+o.alt+120)%12,o.midi=null!==o.oct?zn[o.step]+o.alt+12*(o.oct+1):null,o.freq=Vn(o.midi),Object.freeze(o)},void 0===Fn&&(Fn={}),function(e){return Fn[e]||(Fn[e]=In(e))}),qn=function(e){return Un(e).pc},Vn=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},Wn=Math.log(2),Gn=Math.log(440),Hn=function(e){return"CDEFGAB"[e]},Yn=function(e,t){return Array(t+1).join(e)},$n=function(e){return"number"!=typeof(t=e)?"":function(e){return e<0?Yn("b",-e):Yn("#",e)}(t);var t},Qn=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},Un(t),e):e,r=n.step,i=n.alt,o=n.oct;if("number"!=typeof r)return null;var a=Hn(r);if(!a)return null;var s=a+$n(i);return o||0===o?s+o:s},Xn=Qn;function Kn(e,t){return void 0===t&&(t=!1),e=Math.round(e),(!0===t?Ln:Nn)[e%12]+(Math.floor(e/12)-1)}var Jn=function(e,t){void 0===t&&(t=!0);var n=Un(e),r=n.alt,i=n.chroma,o=n.midi;if(null===i)return null;var a=!1===t?r<0:r>0;return null===o?qn(Kn(i,a)):Kn(o,a)};On.names=Cn,On.tokenize=Rn,On.props=Un,On.name=function(e){return Un(e).name},On.pc=qn,On.midi=function(e){if("number"!=typeof e&&"string"!=typeof e)return null;var t,n=Un(e).midi,r=n||0===n?n:+e;return(t=r)>=0&&t<=127?r:null},On.midiToFreq=Vn,On.freq=function(e){return Un(e).freq||Vn(e)},On.freqToMidi=function(e){var t=12*(Math.log(e)-Gn)/Wn+69;return Math.round(100*t)/100},On.chroma=function(e){return Un(e).chroma},On.oct=function(e){return Un(e).oct},On.stepToLetter=Hn,On.altToAcc=$n,On.from=Qn,On.build=Xn,On.fromMidi=Kn,On.simplify=Jn,On.enharmonic=function(e){return Jn(e,!1)};var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});var er=function(e){return e.filter(function(e){return 0===e||e})},tr=function(e){var t=On.props(e).midi;return null!==t?t:On.props(e+"-100").midi};function nr(e){return er(e.map(On.name)).sort(function(e,t){return tr(e)>tr(t)})}Zn.range=function(e,t){return null===e||null===t?[]:e<t?function(e,t){for(var n=[];t--;n[t]=t+e);return n}(e,t-e+1):function(e,t){for(var n=[];t--;n[t]=e-t);return n}(e,e-t+1)},Zn.rotate=function(e,t){var n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))},Zn.compact=er,Zn.sort=nr,Zn.unique=function(e){return nr(e).filter(function(e,t,n){return 0===t||e!==n[t-1]})},Zn.shuffle=function(e,t){var n,r;void 0===t&&(t=Math.random);for(var i=e.length;i;)n=t()*i--|0,r=e[i],e[i]=e[n],e[n]=r;return e},Zn.permutations=function e(t){return 0===t.length?[[]]:e(t.slice(1)).reduce(function(e,n){return e.concat(t.map(function(e,r){var i=n.slice();return i.splice(r,0,t[0]),i}))},[])};var rr={};Object.defineProperty(rr,"__esModule",{value:!0});var ir=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),or=[0,2,4,5,7,9,11],ar=[0,1,2,3,4,5,6,5,4,3,2,1],sr="1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),ur=function(e){var t=ir.exec(""+e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]},fr=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null}),lr=function(e,t){return Array(Math.abs(t)+1).join(e)},cr=function(e,t){return"M"===t&&"M"===e?0:"P"===t&&"P"===e?0:"m"===t&&"M"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?"P"===e?-t.length:-t.length-1:null},hr=function(e,t){return 0===t?"M"===e?"M":"P":-1===t&&"M"===e?"m":t>0?lr("A",t):t<0?lr("d","P"===e?t:t+1):null},pr=function(e){return(Math.abs(e)-1)%7},dr=function(e){var t=ur(e);if(null===t)return fr;var n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return n.num=+t[0],n.q=t[1],n.step=pr(n.num),n.type="PMMPPMM"[n.step],"M"===n.type&&"P"===n.q?fr:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||-8===n.num?n.num:n.dir*(n.step+1),n.alt=cr(n.type,n.q),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(or[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(or[n.step]+n.alt)%12+12)%12,Object.freeze(n))},mr={};function vr(e){return"string"!=typeof e?fr:mr[e]||(mr[e]=dr(e))}var gr=function(e){var t=void 0===e?{}:e,n=t.num,r=t.step,i=t.alt,o=t.oct,a=void 0===o?1:o,s=t.dir;if(void 0!==r&&(n=r+1+7*a),void 0===n)return null;if("number"!=typeof i)return null;var u="number"!=typeof s?"":s<0?"-":"",f="PMMPPMM"[pr(n)];return u+n+hr(f,i)},yr=[1,2,2,3,3,4,5,5,6,6,7,7],br="P m M m M P d P m M m M".split(" ");rr.names=function(e){return"string"!=typeof e?sr.slice():sr.filter(function(t){return-1!==e.indexOf(t[1])})},rr.tokenize=ur,rr.qToAlt=cr,rr.altToQ=hr,rr.props=vr,rr.num=function(e){return vr(e).num},rr.name=function(e){return vr(e).name},rr.semitones=function(e){return vr(e).semitones},rr.chroma=function(e){return vr(e).chroma},rr.ic=function(e){return"string"==typeof e&&(e=vr(e).chroma),"number"==typeof e?ar[e%12]:null},rr.build=gr,rr.simplify=function(e){var t=vr(e);if(t===fr)return null;var n=t;return n.simple+n.q},rr.invert=function(e){var t=vr(e);if(t===fr)return null;var n=t,r=(7-n.step)%7,i="P"===n.type?-n.alt:-(n.alt+1);return gr({step:r,alt:i,oct:n.oct,dir:n.dir})},rr.fromSemitones=function(e){var t=e<0?-1:1,n=Math.abs(e),r=n%12,i=Math.floor(n/12);return t*(yr[r]+7*i)+br[r]};var wr={};Object.defineProperty(wr,"__esModule",{value:!0});var xr=function(e){return On.chroma(e)||rr.chroma(e)||0},_r=function(e){return parseInt(Pr(e),2)};function Pr(e){if(Sr(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(xr).forEach(function(e){t[e]=1}),t.join("")}var Mr=null,Ar=/^[01]{12}$/;function Sr(e){return Ar.test(e)}var kr="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function Er(e,t){return arguments.length>1?Er(e)(t):(e=Pr(e),function(t){return"1"===e[xr(t)]})}wr.chroma=Pr,wr.chromas=function(e){return Mr=Mr||Zn.range(2048,4095).map(function(e){return e.toString(2)}),"number"==typeof e?Mr.filter(function(t){return function(e){return e.replace(/0/g,"").length}(t)===e}):Mr.slice()},wr.modes=function(e,t){t=!1!==t;var n=Pr(e).split("");return Zn.compact(n.map(function(e,r){var i=Zn.rotate(r,n);return t&&"0"===i[0]?null:i.join("")}))},wr.isChroma=Sr,wr.intervals=function(e){return Sr(e)?Zn.compact(e.split("").map(function(e,t){return"1"===e?kr[t]:null})):[]},wr.isEqual=function e(t,n){return 1===arguments.length?function(n){return e(t,n)}:Pr(t)===Pr(n)},wr.isSubsetOf=function e(t,n){return arguments.length>1?e(t)(n):(t=_r(t),function(e){return(e=_r(e))!==t&&(e&t)===e})},wr.isSupersetOf=function e(t,n){return arguments.length>1?e(t)(n):(t=_r(t),function(e){return(e=_r(e))!==t&&(e|t)===e})},wr.includes=Er,wr.filter=function e(t,n){return 1===arguments.length?function(n){return e(t,n)}:n.filter(Er(t))};var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0});var Or=function(e){var t=Object.keys(e).sort(),n=[],r=[],i=function(e,t,i){n[e]=t,r[i]=r[i]||[],r[i].push(e)};t.forEach(function(t){var n=e[t][0].split(" "),r=e[t][1],o=wr.chroma(n);i(t,n,o),r&&r.forEach(function(e){return i(e,n,o)})});var o=Object.keys(n).sort(),a=function(e){return n[e]};return a.names=function(e){return"string"==typeof e?(r[e]||[]).slice():(!0===e?o:t).slice()},a},jr=function(e,t){var n=function(n){return e(n)||t(n)};return n.names=function(n){return e.names(n).concat(t.names(n))},n},Cr=Or({chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],diminished:["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],prometheus:["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],egyptian:["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}),Lr=Or({4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],M:["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],M6:["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],M69:["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],Maddb9:["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],m:["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],m11:["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"]}),Nr=jr(Cr,Lr);Tr.dictionary=Or,Tr.combine=jr,Tr.scale=Cr,Tr.chord=Lr,Tr.pcset=Nr;var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0});var Rr=[0,2,4,-1,1,3,5],Ir=Rr.map(function(e){return Math.floor(7*e/12)}),Fr=[3,0,4,1,5,2,6],Br=function(e,t,n){var r=Fr[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],i=Math.floor((e+1)/7);return void 0===t?{step:r,alt:i,dir:n}:{step:r,alt:i,oct:t+4*i+Ir[r],dir:n}},zr=function(e){return t=function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,i=e.dir;void 0===i&&(i=1);var o=Rr[t]+7*n;return null===r?[i*o]:[i*o,i*(r-Ir[t]-4*n)]}(n)},void 0===n&&(n={}),function(e){return n[e]||(n[e]=t(e))};var t,n},Ur=zr(On.props),qr=zr(rr.props);function Vr(e,t){if(1===arguments.length)return function(t){return Vr(e,t)};var n=Ur(e),r=qr(t);if(null===n||null===r)return null;var i=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return On.build(Br(i[0],i[1]))}var Wr=function(e){return 7*(t=e)[0]+12*t[1]<0?Br(-e[0],-e[1],-1):Br(e[0],e[1],1);var t};function Gr(e,t,n){var r=qr(e),i=qr(t);if(null===r||null===i)return null;var o=[r[0]+n*i[0],r[1]+n*i[1]];return rr.build(Wr(o))}function Hr(e,t){return 1===arguments.length?function(t){return Hr(e,t)}:Gr(e,t,1)}Dr.transpose=Vr,Dr.trFifths=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=Ur(t);return null===r?null:On.build(Br(r[0]+n))},Dr.fifths=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=Ur(t),i=Ur(n);return null===i||null===r?null:i[0]-r[0]},Dr.transposeBy=function(e,t){return 1===arguments.length?function(t){return Vr(t,e)}:Vr(t,e)},Dr.addIntervals=Gr,Dr.add=Hr,Dr.subtract=function(e,t){return 1===arguments.length?function(t){return Hr(e,t)}:Gr(e,t,-1)},Dr.interval=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=Ur(t),i=Ur(n);if(null===r||null===i||r.length!==i.length)return null;var o=1===r.length?[i[0]-r[0],-Math.floor(7*(i[0]-r[0])/12)]:[i[0]-r[0],i[1]-r[1]];return rr.build(Wr(o))},Dr.semitones=function e(t,n){if(1===arguments.length)return function(n){return e(t,n)};var r=On.props(t),i=On.props(n);return null!==r.midi&&null!==i.midi?i.midi-r.midi:null!==r.chroma&&null!==i.chroma?(i.chroma-r.chroma+12)%12:null};var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});var $r,Qr,Xr=Tr.chord.names,Kr=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),Jr=($r=function(e){var t=Tr.chord(e);if(!t)return Kr;var n={intervals:t,name:e};return n.chroma=wr.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=Tr.chord.names(n.chroma),n},void 0===Qr&&(Qr={}),function(e){return Qr[e]||(Qr[e]=$r(e))}),Zr=function(e){return Jr(ti(e)[1]).intervals},ei=/^(6|64|7|9|11|13)$/;function ti(e){var t=On.tokenize(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:ei.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}Yr.names=Xr,Yr.props=Jr,Yr.intervals=Zr,Yr.notes=function(e,t){if(t)return Jr(t).intervals.map(Dr.transpose(e));var n=ti(e),r=n[0],i=n[1];return Jr(i).intervals.map(Dr.transpose(r))},Yr.exists=function(e){return void 0!==Tr.chord(ti(e)[1])},Yr.supersets=function(e){if(!Zr(e).length)return[];var t=wr.isSupersetOf(Zr(e));return Tr.chord.names().filter(function(e){return t(Tr.chord(e))})},Yr.subsets=function(e){var t=wr.isSubsetOf(Zr(e));return Tr.chord.names().filter(function(e){return t(Tr.chord(e))})},Yr.tokenize=ti;var ni={};Object.defineProperty(ni,"__esModule",{value:!0});var ri,ii,oi=Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),ai=(ri=function(e){var t=Tr.scale(e);if(!t)return oi;var n={intervals:t,name:e};return n.chroma=wr.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=Tr.scale.names(n.chroma),Object.freeze(n)},ii={},function(e){return ii[e]||(ii[e]=ri(e))}),si=Tr.scale.names,ui=function(e){var t=li(e);return ai(t[1]).intervals};function fi(e,t){var n=li(e);return t=t||n[1],ui(t).map(Dr.transpose(n[0]))}function li(e){if("string"!=typeof e)return["",""];var t=e.indexOf(" "),n=On.name(e.substring(0,t))||On.name(e)||"",r=""!==n?e.substring(n.length+1):e;return[n,r.length?r:""]}ni.props=ai,ni.names=si,ni.intervals=ui,ni.notes=fi,ni.exists=function(e){var t=li(e);return void 0!==Tr.scale(t[1])},ni.tokenize=li,ni.modeNames=function(e){var t=ui(e),n=fi(e);return wr.modes(t).map(function(e,r){var i=Tr.scale.names(e)[0];if(i)return[n[r]||t[r],i]}).filter(function(e){return e})},ni.chords=function(e){var t=wr.isSubsetOf(ui(e));return Tr.chord.names().filter(function(e){return t(Tr.chord(e))})},ni.toScale=function(e){var t=Zn.compact(e.map(On.pc));if(!t.length)return t;var n=t[0],r=Zn.unique(t);return Zn.rotate(r.indexOf(n),r)},ni.supersets=function(e){if(!ui(e).length)return[];var t=wr.isSupersetOf(ui(e));return Tr.scale.names().filter(function(e){return t(Tr.scale(e))})},ni.subsets=function(e){var t=wr.isSubsetOf(ui(e));return Tr.scale.names().filter(function(e){return t(Tr.scale(e))})};var ci={};Object.defineProperty(ci,"__esModule",{value:!0});var hi=Dr.transpose,pi=Dr.interval,di=On.props,mi=On.midi,vi=On.freq,gi=Tr.chord,yi=Tr.scale;ci.Array=Zn,ci.Note=On,ci.Interval=rr,ci.Distance=Dr,ci.Dictionary=Tr,ci.Scale=ni,ci.Chord=Yr,ci.PcSet=wr,ci.transpose=hi,ci.interval=pi,ci.note=di,ci.midi=mi,ci.freq=vi,ci.chord=gi,ci.scale=yi;var bi=Tn.AMDF();function wi(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var xi={},_i={};(function(e){var t,n=void 0!==e?e:"undefined"!=typeof window?window:{};"undefined"!=typeof document?t=document:(t=n["__GLOBAL_DOCUMENT_CACHE@4"])||(t=n["__GLOBAL_DOCUMENT_CACHE@4"]=xi),_i=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Pi,Mi=Object.create(null),Ai="onloadid"+(new Date%9e6).toString(36),Si="data-"+Ai,ki=0;if(Me&&Me.MutationObserver){var Ei=new MutationObserver(function(e){if(!(Object.keys(Mi).length<1))for(var t=0;t<e.length;t++)e[t].attributeName!==Si?(Ci(e[t].removedNodes,ji),Ci(e[t].addedNodes,Oi)):(n=e[t],r=Oi,i=ji,o=void 0,o=n.target.getAttribute(Si),function(e,t){return!(!e||!t)&&Mi[e][3]===Mi[t][3]}(n.oldValue,o)?Mi[o]=Mi[n.oldValue]:(Mi[n.oldValue]&&i(n.oldValue,n.target),Mi[o]&&r(o,n.target)));var n,r,i,o});_i.body?Ti(Ei):_i.addEventListener("DOMContentLoaded",function(e){Ti(Ei)})}function Ti(e){e.observe(_i.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:[Si]})}function Oi(e,t){Mi[e][0]&&0===Mi[e][2]&&(Mi[e][0](t),Mi[e][2]=1)}function ji(e,t){Mi[e][1]&&1===Mi[e][2]&&(Mi[e][1](t),Mi[e][2]=0)}function Ci(e,t){for(var n=Object.keys(Mi),r=0;r<e.length;r++){if(e[r]&&e[r].getAttribute&&e[r].getAttribute(Si)){var i=e[r].getAttribute(Si);n.forEach(function(n){i===n&&t(n,e[r])})}e[r].childNodes.length>0&&Ci(e[r].childNodes,t)}}(Pi=function e(t,n,r,i){return n=n||function(){},r=r||function(){},t.setAttribute(Si,"o"+ki),Mi["o"+ki]=[n,r,0,i||e.caller],ki+=1,t}).KEY_ATTR=Si;var Li,Ni=Pi.KEY_ID=Ai,Di=Pi.KEY_ATTR;function Ri(e){this._hasWindow="undefined"!=typeof window,this._id=null,this._ncID=null,this._olID=null,this._proxy=null,this._loaded=!1,this._rootNodeName=null,this._name=e||"nanocomponent",this._rerender=!1,this._handleLoad=this._handleLoad.bind(this),this._handleUnload=this._handleUnload.bind(this),this._arguments=[];var t=this;Object.defineProperty(this,"element",{get:function(){var e=_i.getElementById(t._id);if(e)return e.dataset.nanocomponent===t._ncID?e:void 0}})}Li=Ri,Ri.prototype.render=function(){for(var e,t=ze(this._name+".render"),n=new Array(arguments.length),r=0;r<arguments.length;r++)n[r]=arguments[r];if(this._hasWindow){if(this.element){e=this.element;var i=ze(this._name+".update"),o=this._rerender||this.update.apply(this,n);if(i(),this._rerender&&(this._rerender=!1),o){var a=this._handleRender(n),s=ze(this._name+".morph");tt(e,a),s(),this.afterupdate&&this.afterupdate(e)}return this._proxy||(this._proxy=this._createProxy()),t(),this._proxy}return this._reset(),e=this._handleRender(n),this.beforerender&&this.beforerender(e),(this.load||this.unload||this.afterreorder)&&(Pi(e,this._handleLoad,this._handleUnload,this._ncID),this._olID=e.dataset[Ni]),t(),e}var u=ze(this._name+".create");return e=this.createElement.apply(this,n),u(),t(),e},Ri.prototype.rerender=function(){this._rerender=!0,this.render.apply(this,this._arguments)},Ri.prototype._handleRender=function(e){var t=ze(this._name+".createElement"),n=this.createElement.apply(this,e);return t(),this._rootNodeName||(this._rootNodeName=n.nodeName),this._arguments=e,this._brandNode(this._ensureID(n))},Ri.prototype._createProxy=function(){var e=_i.createElement(this._rootNodeName),t=this;return this._brandNode(e),e.id=this._id,e.setAttribute("data-proxy",""),e.isSameNode=function(e){return e&&e.dataset.nanocomponent===t._ncID},e},Ri.prototype._reset=function(){this._ncID="ncid-"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),this._olID=null,this._id=null,this._proxy=null,this._rootNodeName=null},Ri.prototype._brandNode=function(e){return e.setAttribute("data-nanocomponent",this._ncID),this._olID&&e.setAttribute(Di,this._olID),e},Ri.prototype._ensureID=function(e){return e.id?this._id=e.id:e.id=this._id=this._ncID,this._proxy&&this._proxy.id!==this._id&&(this._proxy.id=this._id),e},Ri.prototype._handleLoad=function(e){this._loaded?this.afterreorder&&this.afterreorder(e):(this._loaded=!0,this.load&&this.load(e))},Ri.prototype._handleUnload=function(e){this.element||(this._loaded=!1,this.unload&&this.unload(e))},Ri.prototype.createElement=function(){throw new Error("nanocomponent: createElement should be implemented!")},Ri.prototype.update=function(){throw new Error("nanocomponent: update should be implemented!")};var Ii=Li,Fi=function(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e},Bi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},zi=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},Ui=Object.prototype.toString,qi=function(e){var t;return"[object Object]"===Ui.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))},Vi={};(function(e){"use strict";Vi=function(n){var r,i,o=[],a=1;if("string"==typeof n)if(Bi[n])o=Bi[n].slice(),i="rgb";else if("transparent"===n)a=0,i="rgb",o=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(n)){var s=n.slice(1);a=1,(f=s.length)<=4?(o=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],4===f&&(a=parseInt(s[3]+s[3],16)/255)):(o=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],8===f&&(a=parseInt(s[6]+s[7],16)/255)),o[0]||(o[0]=0),o[1]||(o[1]=0),o[2]||(o[2]=0),i="rgb"}else if(r=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(n)){var u=r[1];i=s=u.replace(/a$/,"");var f="cmyk"===s?4:"gray"===s?1:3;o=r[2].trim().split(/\s*,\s*/).map(function(e,n){if(/%$/.test(e))return n===f?parseFloat(e)/100:"rgb"===s?255*parseFloat(e)/100:parseFloat(e);if("h"===s[n]){if(/deg$/.test(e))return parseFloat(e);if(void 0!==t[e])return t[e]}return parseFloat(e)}),u===s&&o.push(1),a=void 0===o[f]?1:o[f],o=o.slice(0,f)}else n.length>10&&/[0-9](?:\s|\/)/.test(n)&&(o=n.match(/([0-9]+)/g).map(function(e){return parseFloat(e)}),i=n.match(/([a-z])/gi).join("").toLowerCase());else if(isNaN(n))if(qi(n)){var l=zi(n.r,n.red,n.R,null);null!==l?(i="rgb",o=[l,zi(n.g,n.green,n.G),zi(n.b,n.blue,n.B)]):(i="hsl",o=[zi(n.h,n.hue,n.H),zi(n.s,n.saturation,n.S),zi(n.l,n.lightness,n.L,n.b,n.brightness)]),a=zi(n.a,n.alpha,n.opacity,1),null!=n.opacity&&(a/=100)}else(Array.isArray(n)||e.ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(n))&&(o=[n[0],n[1],n[2]],i="rgb",a=4===n.length?n[3]:1);else i="rgb",o=[n>>>16,(65280&n)>>>8,255&n];return{space:i,values:o,alpha:a}};var t={red:0,orange:60,yellow:120,green:180,blue:240,purple:300}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Wi;Wi={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(e){var t,n,r,i,o,a=e[0]/360,s=e[1]/100,u=e[2]/100;if(0===s)return[o=255*u,o,o];t=2*u-(n=u<.5?u*(1+s):u+s-u*s),i=[0,0,0];for(var f=0;f<3;f++)(r=a+1/3*-(f-1))<0?r++:r>1&&r--,o=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,i[f]=255*o;return i}};var Gi=function(e,t){"float"!==t&&t||(t="array"),"uint"===t&&(t="uint8"),"uint_clamped"===t&&(t="uint8_clamped");var n=new(function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}(t))(4),r="uint8"!==t&&"uint8_clamped"!==t;return e.length&&"string"!=typeof e||((e=function(e){var t,n=Vi(e);return n.space?((t=Array(3))[0]=Fi(n.values[0],0,255),t[1]=Fi(n.values[1],0,255),t[2]=Fi(n.values[2],0,255),"h"===n.space[0]&&(t=Wi.rgb(t)),t.push(Fi(n.alpha,0,1)),t):[]}(e))[0]/=255,e[1]/=255,e[2]/=255),function(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||!!(Array.isArray(e)&&(e[0]>1||0===e[0])&&(e[1]>1||0===e[1])&&(e[2]>1||0===e[2])&&(!e[3]||e[3]>1))}(e)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=null!=e[3]?e[3]:255,r&&(n[0]/=255,n[1]/=255,n[2]/=255,n[3]/=255),n):(r?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=null!=e[3]?e[3]:1):(n[0]=Fi(Math.floor(255*e[0]),0,255),n[1]=Fi(Math.floor(255*e[1]),0,255),n[2]=Fi(Math.floor(255*e[2]),0,255),n[3]=null==e[3]?255:Fi(Math.floor(255*e[3]),0,255)),n)},Hi=function(e,t,n){var r,i,o={};if("string"==typeof t&&(t=$i(t)),Array.isArray(t)){var a={};for(i=0;i<t.length;i++)a[t[i]]=!0;t=a}for(r in t)t[r]=$i(t[r]);var s={};for(r in t){var u=t[r];if(Array.isArray(u))for(i=0;i<u.length;i++){var f=u[i];if(n&&(s[f]=!0),f in e){if(o[r]=e[f],n)for(var l=i;l<u.length;l++)s[u[l]]=!0;break}}else r in e&&(t[r]&&(o[r]=e[r]),n&&(s[r]=!0))}if(n)for(r in e)s[r]||(o[r]=e[r]);return o},Yi={};function $i(e){return Yi[e]?Yi[e]:("string"==typeof e&&(e=Yi[e]=e.split(/\s*,\s*|\s+/)),e)}var Qi={};(function(e){"use strict";function t(t){if(t.container)if(t.container==document.body)document.body.style.width||(t.canvas.width=t.width||t.pixelRatio*e.innerWidth),document.body.style.height||(t.canvas.height=t.height||t.pixelRatio*e.innerHeight);else{var n=t.container.getBoundingClientRect();t.canvas.width=t.width||n.right-n.left,t.canvas.height=t.height||n.bottom-n.top}}function n(e){return"function"==typeof e.getContext&&"width"in e&&"height"in e}function r(){var e=document.createElement("canvas");return e.style.position="absolute",e.style.top=0,e.style.left=0,e}Qi=function(i){var o;if(i?"string"==typeof i&&(i={container:i}):i={},(i=n(i)?{container:i}:"string"==typeof(o=i).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?{container:i}:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(i)?{gl:i}:Hi(i,{container:"container target element el canvas holder parent parentNode wrapper use ref root node",gl:"gl context webgl glContext",attrs:"attributes attrs contextAttributes",pixelRatio:"pixelRatio pxRatio px ratio pxratio pixelratio",width:"w width",height:"h height"},!0)).pixelRatio||(i.pixelRatio=e.pixelRatio||1),i.gl)return i.gl;if(i.canvas&&(i.container=i.canvas.parentNode),i.container){if("string"==typeof i.container){var a=document.querySelector(i.container);if(!a)throw Error("Element "+i.container+" is not found");i.container=a}n(i.container)?(i.canvas=i.container,i.container=i.canvas.parentNode):i.canvas||(i.canvas=r(),i.container.appendChild(i.canvas),t(i))}else if(!i.canvas){if("undefined"==typeof document)throw Error("Not DOM environment. Use headless-gl.");i.container=document.body||document.documentElement,i.canvas=r(),i.container.appendChild(i.canvas),t(i)}if(!i.gl)try{i.gl=i.canvas.getContext("webgl",i.attrs)}catch(o){try{i.gl=i.canvas.getContext("experimental-webgl",i.attrs)}catch(o){i.gl=i.canvas.getContext("webgl-experimental",i.attrs)}}return i.gl}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Xi=function(e){"string"==typeof e&&(e=[e]);for(var t=[].slice.call(arguments,1),n=[],r=0;r<e.length-1;r++)n.push(e[r],t[r]||"");return n.push(e[r]),n.join("")},Ki=function(e){return Object.is(e,-0)},Ji=Object.getOwnPropertySymbols,Zi=Object.prototype.hasOwnProperty,eo=Object.prototype.propertyIsEnumerable,to=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(Yo){return!1}}()?Object.assign:function(e,t){for(var n,r,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))Zi.call(n,a)&&(i[a]=n[a]);if(Ji){r=Ji(n);for(var s=0;s<r.length;s++)eo.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i};"function"==typeof Symbol&&Symbol.iterator;var no,ro={},io="undefined"!=typeof window,oo=io&&window.requestIdleCallback,ao=function(e,t){t||(t=[0,""]),e=String(e);var n=parseFloat(e,10);return t[0]=n,t[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t},so={exports:{}},uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};no=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function n(e){var t=new Error("(regl) "+e);throw console.error(t),t}function r(e,t){e||n(t)}function i(e){return e?": "+e:""}function o(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var a=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function s(e,t){for(e+="";e.length<t;)e=" "+e;return e}function u(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function l(e,t,n){this.file=e,this.line=t,this.message=n}function c(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function h(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function p(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new u,0:new u};a.unknown.name=a[0].name=t||c(),a.unknown.lines.push(new f(0,""));for(var s=0;s<r.length;++s){var l=r[s],h=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(l);if(h)switch(h[1]){case"line":var p=/(\d+)(\s+\d+)?/.exec(h[2]);p&&(i=0|p[1],p[2]&&((o=0|p[2])in a||(a[o]=new u)));break;case"define":var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(h[2]);d&&(a[o].name=d[1]?(n=d[2],"undefined"!=typeof atob?atob(n):"base64:"+n):d[2])}a[o].lines.push(new f(i++,l))}return Object.keys(a).forEach(function(e){var t=a[e];t.lines.forEach(function(e){t.index[e.number]=e})}),a}function d(e){e._commandRef=c()}function m(e,t){var r=h();n(e+" in command "+(t||c())+("unknown"===r?"":" called from "+r))}function v(e,t,n,r){(void 0===e?"undefined":uo(e))!==t&&m("invalid parameter type"+i(n)+". expected "+t+", got "+(void 0===e?"undefined":uo(e)),r||c())}var g=32819,y=32820,b=33635,w=34042,x={};function _(e,t){return e===y||e===g||e===b?2:e===w?4:x[e]*t}function P(e){return!(e&e-1||!e)}x[5120]=x[5121]=1,x[5122]=x[5123]=x[36193]=x[b]=x[g]=x[y]=2,x[5124]=x[5125]=x[5126]=x[w]=4;var M=t(r,{optional:function(e){e()},raise:n,commandRaise:m,command:function(e,t,n){e||m(t,n||c())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||m("unknown parameter ("+e+")"+i(n)+". possible values: "+Object.keys(t).join(),r||c())},constructor:function(e){Object.keys(e).forEach(function(e){a.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+a)})},type:function(e,t,r){(void 0===e?"undefined":uo(e))!==t&&n("invalid parameter type"+i(r)+". expected "+t+", got "+(void 0===e?"undefined":uo(e)))},commandType:v,isTypedArray:function(t,r){e(t)||n("invalid parameter type"+i(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:o,shaderError:function(e,t,n,i,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),u=i===e.FRAGMENT_SHADER?"fragment":"vertex";v(n,"string",u+" shader source must be a string",o);var f=p(n,o),c=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);n?t.push(new l(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new l("unknown",0,e))}}),t}(a);!function(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(f,c),Object.keys(f).forEach(function(e){var t=f[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){i(s(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(n){var r=n.message,o=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(r);if(o){var a=o[1];switch(r=o[2],a){case"assign":a="="}t=Math.max(e.line.indexOf(a,t),0)}else t=0;i(s("| ",6)),i(s("^^^",t+3)+"\n","font-weight:bold"),i(s("| ",6)),i(r+"\n","font-weight:bold")}),i(s("| ",6)+"\n")}else i(s(e.number,4)+"|  "),i(e.line+"\n","color:red")}),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}}),r.raise("Error compiling "+u+" shader, "+f[0].name)}},linkError:function(e,t,n,i,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),s=p(n,o),u='Error linking program with vertex shader, "'+p(i,o)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+a),r.raise(u)}},callSite:h,saveCommandRef:d,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}d(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?o(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):o(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:c,texture2D:function(e,t,n){var i,o=t.width,a=t.height,s=t.channels;r(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||r(P(o)&&P(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&r(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(r(P(o)&&P(a),"texture must be a square power of 2 to support mipmapping"),r(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&r(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),r(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(i=0;i<16;++i)if(u[i]){var f=o>>i,l=a>>i;r(t.mipmask&1<<i,"missing mipmap data");var c=u[i];if(r(c.width===f&&c.height===l,"invalid shape for mip images"),r(c.format===t.format&&c.internalformat===t.internalformat&&c.type===t.type,"incompatible type for mip image"),c.compressed);else if(c.data){var h=Math.ceil(_(c.type,s)*f/c.unpackAlignment)*c.unpackAlignment;r(c.data.byteLength===h*l,"invalid data for image, buffer size is inconsistent with image format")}else c.element||c.copy}else e.genMipmaps||r(0==(t.mipmask&1<<i),"extra mipmap data");t.compressed&&r(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,i){var o=e.width,a=e.height,s=e.channels;r(o>0&&o<=i.maxTextureSize&&a>0&&a<=i.maxTextureSize,"invalid texture shape"),r(o===a,"cube map must be square"),r(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var f=n[u];r(f.width===o&&f.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(r(!f.compressed,"can not generate mipmap for compressed textures"),r(1===f.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=f.images,c=0;c<16;++c){var h=l[c];if(h){var p=o>>c,d=a>>c;r(f.mipmask&1<<c,"missing mipmap data"),r(h.width===p&&h.height===d,"invalid shape for mip images"),r(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?r(h.data.byteLength===p*d*Math.max(_(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}}),A=0;function S(e,t){this.id=A++,this.type=e,this.data=t}function k(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function E(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+k(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var o=t.split(".");if(1===o.length)return['"'+k(t)+'"'];for(var a=[],s=0;s<o.length;++s)a=a.concat(e(o[s]));return a}(e).join("][")+"]"}var T={DynamicVariable:S,define:function(e,t){return new S(e,E(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof S},unbox:function(e,t){return"function"==typeof e?new S(0,e):e},accessor:E},O={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},j="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function C(e){return"string"==typeof e?e.split():(M(Array.isArray(e),"invalid extension array"),e)}function L(e){return"string"==typeof e?(M("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function N(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var D=5120,R=5121,I=5122,F=5123,B=5124,z=5125,U=5126;function q(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function V(){var e=N(8,function(){return[]});function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[q(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[q(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case D:r=new Int8Array(t(n),0,n);break;case R:r=new Uint8Array(t(n),0,n);break;case I:r=new Int16Array(t(2*n),0,n);break;case F:r=new Uint16Array(t(2*n),0,n);break;case B:r=new Int32Array(t(4*n),0,n);break;case z:r=new Uint32Array(t(4*n),0,n);break;case U:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var W=V();W.zero=V();function G(t){return!!t&&"object"===(void 0===t?"undefined":uo(t))&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var H=function(e){return Object.keys(e).map(function(t){return e[t]})},Y={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||W.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:$(e,t[0],t[1],t[2],a,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(n.length-r==4){var f=n[r+1],l=n[r+2],c=n[r+3];for(s=0;s<u;++s)$(t[s],f,l,c,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,a,0)}return a}};function $(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],f=0;f<n;++f)for(var l=u[f],c=0;c<r;++c)i[a++]=l[c]}var Q={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},X={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},K={dynamic:35048,stream:35040,static:35044},J=Y.flatten,Z=Y.shape,ee=35044,te=5121,ne=5126,re=[];function ie(e){return 0|Q[Object.prototype.toString.call(e)]}function oe(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function ae(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var f=0;f<r;++f)e[s++]=t[i*u+o*f+a]}re[5120]=1,re[5122]=2,re[5124]=4,re[5121]=1,re[5123]=2,re[5125]=4,re[5126]=4;var se={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ue=0,fe=1,le=4,ce=5120,he=5121,pe=5122,de=5123,me=5124,ve=5125,ge=34963,ye=35044,be=new Float32Array(1),we=new Uint32Array(be.buffer),xe=5123;function _e(e){for(var t=W.allocType(xe,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{be[0]=e[n];var r=we[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function Pe(t){return Array.isArray(t)||e(t)}var Me=function(e){return!(e&e-1||!e)},Ae=34467,Se=3553,ke=34067,Ee=34069,Te=6408,Oe=6406,je=6407,Ce=6409,Le=6410,Ne=32854,De=32855,Re=36194,Ie=32819,Fe=32820,Be=33635,ze=34042,Ue=6402,qe=34041,Ve=35904,We=35906,Ge=36193,He=33776,Ye=33777,$e=33778,Qe=33779,Xe=35986,Ke=35987,Je=34798,Ze=35840,et=35841,tt=35842,nt=35843,rt=36196,it=5121,ot=5123,at=5125,st=5126,ut=10242,ft=10243,lt=10497,ct=33071,ht=33648,pt=10240,dt=10241,mt=9728,vt=9729,gt=9984,yt=9985,bt=9986,wt=9987,xt=33170,_t=4352,Pt=4353,Mt=4354,At=34046,St=3317,kt=37440,Et=37441,Tt=37443,Ot=37444,jt=33984,Ct=[gt,bt,yt,wt],Lt=[0,Ce,Le,je,Te],Nt={};function Dt(e){return"[object "+e+"]"}Nt[Ce]=Nt[Oe]=Nt[Ue]=1,Nt[qe]=Nt[Le]=2,Nt[je]=Nt[Ve]=3,Nt[Te]=Nt[We]=4;var Rt=Dt("HTMLCanvasElement"),It=Dt("CanvasRenderingContext2D"),Ft=Dt("ImageBitmap"),Bt=Dt("HTMLImageElement"),zt=Dt("HTMLVideoElement"),Ut=Object.keys(Q).concat([Rt,It,Ft,Bt,zt]),qt=[];qt[it]=1,qt[st]=4,qt[Ge]=2,qt[ot]=2,qt[at]=4;var Vt=[];function Wt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Gt(e){return!!Array.isArray(e)&&!(0===e.length||!Pe(e[0]))}function Ht(e){return Object.prototype.toString.call(e)}function Yt(e){return Ht(e)===Rt}function $t(e){if(!e)return!1;var t=Ht(e);return Ut.indexOf(t)>=0||Wt(e)||Gt(e)||G(e)}function Qt(e){return 0|Q[Object.prototype.toString.call(e)]}function Xt(e,t){return W.allocType(e.type===Ge?st:e.type,t)}function Kt(e,t){e.type===Ge?(e.data=_e(t),W.freeType(t)):e.data=t}function Jt(e,t,n,r,i,o){var a;if(a=void 0!==Vt[e]?Vt[e]:Nt[e]*qt[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}Vt[Ne]=2,Vt[De]=2,Vt[Re]=2,Vt[qe]=4,Vt[He]=.5,Vt[Ye]=.5,Vt[$e]=1,Vt[Qe]=1,Vt[Xe]=.5,Vt[Ke]=1,Vt[Je]=1,Vt[Ze]=.5,Vt[et]=.25,Vt[tt]=.5,Vt[nt]=.25,Vt[rt]=.5;var Zt=36161,en=32854,tn=[];function nn(e,t,n){return tn[e]*t*n}tn[en]=2,tn[32855]=2,tn[36194]=2,tn[33189]=2,tn[36168]=1,tn[34041]=4,tn[35907]=4,tn[34836]=16,tn[34842]=8,tn[34843]=6;var rn=36160,on=36161,an=3553,sn=34069,un=36064,fn=36096,ln=36128,cn=33306,hn=36053,pn=6402,dn=[6407,6408],mn=[];mn[6408]=4,mn[6407]=3;var vn=[];vn[5121]=1,vn[5126]=4,vn[36193]=2;var gn=33189,yn=36168,bn=34041,wn=[32854,32855,36194,35907,34842,34843,34836],xn={};xn[hn]="complete",xn[36054]="incomplete attachment",xn[36057]="incomplete dimensions",xn[36055]="incomplete, missing attachment",xn[36061]="unsupported";var _n=5126;function Pn(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=_n,this.offset=0,this.stride=0,this.divisor=0}var Mn=35632,An=35633,Sn=35718,kn=35721,En=6408,Tn=5121,On=3333,jn=5126;function Cn(e){return Array.prototype.slice.call(e)}function Ln(e){return Cn(e).join("")}var Nn="xyzw".split(""),Dn=5121,Rn=1,In=2,Fn=0,Bn=1,zn=2,Un=3,qn=4,Vn="dither",Wn="blend.enable",Gn="blend.color",Hn="blend.equation",Yn="blend.func",$n="depth.enable",Qn="depth.func",Xn="depth.range",Kn="depth.mask",Jn="colorMask",Zn="cull.enable",er="cull.face",tr="frontFace",nr="lineWidth",rr="polygonOffset.enable",ir="polygonOffset.offset",or="sample.alpha",ar="sample.enable",sr="sample.coverage",ur="stencil.enable",fr="stencil.mask",lr="stencil.func",cr="stencil.opFront",hr="stencil.opBack",pr="scissor.enable",dr="scissor.box",mr="viewport",vr="profile",gr="framebuffer",yr="vert",br="frag",wr="elements",xr="primitive",_r="count",Pr="offset",Mr="instances",Ar=gr+"Width",Sr=gr+"Height",kr=mr+"Width",Er=mr+"Height",Tr="drawingBufferWidth",Or="drawingBufferHeight",jr=[Yn,Hn,lr,cr,hr,sr,mr,dr,ir],Cr=34962,Lr=34963,Nr=3553,Dr=34067,Rr=2884,Ir=3042,Fr=3024,Br=2960,zr=2929,Ur=3089,qr=32823,Vr=32926,Wr=32928,Gr=5126,Hr=35664,Yr=35665,$r=35666,Qr=5124,Xr=35667,Kr=35668,Jr=35669,Zr=35670,ei=35671,ti=35672,ni=35673,ri=35674,ii=35675,oi=35676,ai=35678,si=35680,ui=4,fi=1028,li=1029,ci=2304,hi=2305,pi=32775,di=32776,mi=519,vi=7680,gi=0,yi=1,bi=32774,wi=513,xi=36160,_i=36064,Pi={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Mi=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ai={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Si={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ki={frag:35632,vert:35633},Ei={cw:ci,ccw:hi};function Ti(t){return Array.isArray(t)||e(t)||G(t)}function Oi(e){return e.sort(function(e,t){return e===mr?-1:t===mr?1:e<t?-1:1})}function ji(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function Ci(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Li(e){return new ji(!1,!1,!1,e)}function Ni(e,t){var n=e.type;if(n===Fn){var r=e.data.length;return new ji(!0,r>=1,r>=2,t)}if(n===qn){var i=e.data;return new ji(i.thisDep,i.contextDep,i.propDep,t)}return new ji(n===Un,n===zn,n===Bn,t)}var Di=new ji(!1,!1,!1,function(){});function Ri(e,n,r,i,o,a,s,u,f,l,c,h,p,d,m){var v=l.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=pi,g.max=di);var y=r.angle_instanced_arrays,b=r.webgl_draw_buffers,w={dirty:!0,profile:m.profile},x={},_=[],P={},A={};function S(e){return e.replace(".","_")}function k(e,t,n){var r=S(e);_.push(e),x[r]=w[r]=!!n,P[r]=t}function E(e,t,n){var r=S(e);_.push(e),Array.isArray(n)?(w[r]=n.slice(),x[r]=n.slice()):w[r]=x[r]=n,A[r]=t}k(Vn,Fr),k(Wn,Ir),E(Gn,"blendColor",[0,0,0,0]),E(Hn,"blendEquationSeparate",[bi,bi]),E(Yn,"blendFuncSeparate",[yi,gi,yi,gi]),k($n,zr,!0),E(Qn,"depthFunc",wi),E(Xn,"depthRange",[0,1]),E(Kn,"depthMask",!0),E(Jn,Jn,[!0,!0,!0,!0]),k(Zn,Rr),E(er,"cullFace",li),E(tr,tr,hi),E(nr,nr,1),k(rr,qr),E(ir,"polygonOffset",[0,0]),k(or,Vr),k(ar,Wr),E(sr,"sampleCoverage",[1,!1]),k(ur,Br),E(fr,"stencilMask",-1),E(lr,"stencilFunc",[mi,0,-1]),E(cr,"stencilOpSeparate",[fi,vi,vi,vi]),E(hr,"stencilOpSeparate",[li,vi,vi,vi]),k(pr,Ur),E(dr,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),E(mr,mr,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var O={gl:e,context:p,strings:n,next:x,current:w,draw:h,elements:a,buffer:o,shader:c,attributes:l.state,uniforms:f,framebuffer:u,extensions:r,timer:d,isBufferArgs:Ti},j={primTypes:se,compareFuncs:Ai,blendFuncs:Pi,blendEquations:g,stencilOps:Si,glTypes:X,orientationType:Ei};M.optional(function(){O.isArrayLike=Pe}),b&&(j.backBuffer=[li],j.drawBuffer=N(i.maxDrawbuffers,function(e){return 0===e?[0]:N(e,function(e){return _i+e})}));var C=0;function L(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t(function(){n.push.apply(n,Cn(arguments))},{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Cn(arguments)),n.push(";")),t},toString:function(){return Ln([r.length>0?"var "+r+";":"",Ln(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t(function(){e.apply(e,Cn(arguments))},{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),f=u.toString;return s[e]=t(u,{arg:i,toString:function(){return Ln(["function(",r.join(),"){",f(),"}"])}})},scope:o,cond:function(){var e=Ln(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,Cn(arguments)),this},else:function(){return r.apply(r,Cn(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Ln(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach(function(t){e.push('"',t,'":',s[t].toString(),",")}),e.push("}");var t=Ln(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=C++,e.batchId="0";var o=r(O),a=e.shared={props:"a0"};Object.keys(O).forEach(function(e){a[e]=i.def(o,".",e)}),M.optional(function(){e.CHECK=r(M),e.commandStr=M.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},j.invalidBlendCombinations=Mi});var s=e.next={},u=e.current={};Object.keys(A).forEach(function(e){Array.isArray(w[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))});var f=e.constants={};Object.keys(j).forEach(function(e){f[e]=i.def(JSON.stringify(j[e]))}),e.invoke=function(t,n){switch(n.type){case Fn:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case Bn:return t.def(a.props,n.data);case zn:return t.def(a.context,n.data);case Un:return t.def("this",n.data);case qn:return n.data.append(e,t),n.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in c)return c[t];var i=l.scope[t];return i||(i=l.scope[t]=new v),c[t]=r(i)},e}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach(function(o){t.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(e,t),";")}),t(i)}function R(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,f=e.constants,l=f.drawBuffer,c=f.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",xi,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",xi,",null);"),b&&t(i,".drawBuffersWEBGL(",c,");"),t("}",s,".cur=",u,";"),r||t("}")}function I(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,f=e.cond(s,".dirty");_.forEach(function(t){var r,l,c=S(t);if(!(c in n.state))if(c in a){r=a[c],l=o[c];var h=N(w[c].length,function(e){return f.def(r,"[",e,"]")});f(e.cond(h.map(function(e,t){return e+"!=="+l+"["+t+"]"}).join("||")).then(i,".",A[c],"(",h,");",h.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";"))}else{r=f.def(u,".",c);var p=e.cond(r,"!==",s,".",c);f(p),c in P?p(e.cond(r).then(i,".enable(",P[c],");").else(i,".disable(",P[c],");"),s,".",c,"=",r,";"):p(i,".",A[c],"(",r,");",s,".",c,"=",r,";")}}),0===Object.keys(n.state).length&&f(s,".dirty=false;"),t(f)}function F(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;Oi(Object.keys(n)).forEach(function(i){var u=n[i];if(!r||r(u)){var f=u.append(e,t);if(P[i]){var l=P[i];Ci(u)?t(s,f?".enable(":".disable(",l,");"):t(e.cond(f).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",f,";")}else if(Pe(f)){var c=o[i];t(s,".",A[i],"(",f,");",f.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";")}else t(s,".",A[i],"(",f,");",a,".",i,"=",f,";")}})}function B(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function z(e,t,n,r,i){var o,a,s,u=e.shared,f=e.stats,l=u.current,c=u.timer,h=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(f,".count+=",i,";"):e(f,".count++;"),d&&(r?e(a=t.def(),"=",c,".getNumPendingQueries();"):e(c,".beginQuery(",f,");"))}function v(e){e(f,".cpuTime+=",p(),"-",o,";"),d&&(r?e(c,".pushScopeStats(",a,",",c,".getNumPendingQueries(),",f,");"):e(c,".endQuery();"))}function g(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(h){if(Ci(h))return void(h.enable?(m(t),v(t.exit),g("true")):g("false"));g(s=h.append(e,t))}else s=t.def(l,".profile");var y=e.block();m(y),t("if(",s,"){",y,"}");var b=e.block();v(b),t.exit("if(",s,"){",b,"}")}function U(e,t,n,r,i){var o=e.shared;r.forEach(function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(Di))return;var f=e.scopeAttrib(s);M.optional(function(){e.assert(t,f+".state","missing attribute "+s)}),a={},Object.keys(new v).forEach(function(e){a[e]=t.def(f,".",e)})}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),f=i.state,l=i.buffer,c=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map(function(e){return u+"."+e+"!=="+i[e]}).join("||"),"){",a,".bindBuffer(",Cr,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map(function(e){return u+"."+e+"="+i[e]+";"}).join(""),"}"),y){var f=i.divisor;t("if(",u,".divisor!==",f,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,f],");",u,".divisor=",f,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");","}if(",Nn.map(function(e,t){return u+"."+e+"!=="+c[t]}).join("||"),"){",a,".vertexAttrib4f(",s,",",c,");",Nn.map(function(e,t){return u+"."+e+"="+c[t]+";"}).join(""),"}")}f===Rn?p():f===In?d():(t("if(",f,"===",Rn,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(r.info.type){case Hr:case Xr:case ei:return 2;case Yr:case Kr:case ti:return 3;case $r:case Jr:case ni:return 4;default:return 1}}(),a)})}function q(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,f=0;f<i.length;++f){var l,c=i[f],h=c.name,p=c.info.type,d=r.uniforms[h],m=e.link(c)+".location";if(d){if(!o(d))continue;if(Ci(d)){var v=d.value;if(M.command(null!=v,'missing uniform "'+h+'"',e.commandStr),p===ai||p===si){M.command("function"==typeof v&&(p===ai&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||p===si&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+h,e.commandStr);var g=e.link(v._texture||v.color[0]._texture);t(u,".uniform1i(",m,",",g+".bind());"),t.exit(g,".unbind();")}else if(p===ri||p===ii||p===oi){M.optional(function(){M.command(Pe(v),"invalid matrix for uniform "+h,e.commandStr),M.command(p===ri&&4===v.length||p===ii&&9===v.length||p===oi&&16===v.length,"invalid length for matrix uniform "+h,e.commandStr)});var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),b=2;p===ii?b=3:p===oi&&(b=4),t(u,".uniformMatrix",b,"fv(",m,",false,",y,");")}else{switch(p){case Gr:M.commandType(v,"number","uniform "+h,e.commandStr),a="1f";break;case Hr:M.command(Pe(v)&&2===v.length,"uniform "+h,e.commandStr),a="2f";break;case Yr:M.command(Pe(v)&&3===v.length,"uniform "+h,e.commandStr),a="3f";break;case $r:M.command(Pe(v)&&4===v.length,"uniform "+h,e.commandStr),a="4f";break;case Zr:M.commandType(v,"boolean","uniform "+h,e.commandStr),a="1i";break;case Qr:M.commandType(v,"number","uniform "+h,e.commandStr),a="1i";break;case ei:case Xr:M.command(Pe(v)&&2===v.length,"uniform "+h,e.commandStr),a="2i";break;case ti:case Kr:M.command(Pe(v)&&3===v.length,"uniform "+h,e.commandStr),a="3i";break;case ni:case Jr:M.command(Pe(v)&&4===v.length,"uniform "+h,e.commandStr),a="4i"}t(u,".uniform",a,"(",m,",",Pe(v)?Array.prototype.slice.call(v):v,");")}continue}l=d.append(e,t)}else{if(!o(Di))continue;l=t.def(s.uniforms,"[",n.id(h),"]")}p===ai?t("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}"):p===si&&t("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}"),M.optional(function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){n("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(s.isArrayLike+"("+l+")&&"+l+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(t===Nr?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case Qr:r("number");break;case Xr:i(2);break;case Kr:i(3);break;case Jr:i(4);break;case Gr:r("number");break;case Hr:i(2);break;case Yr:i(3);break;case $r:i(4);break;case Zr:r("boolean");break;case ei:i(2);break;case ti:i(3);break;case ni:case ri:i(4);break;case ii:i(9);break;case oi:i(16);break;case ai:o(Nr);break;case si:o(Dr)}});var w=1;switch(p){case ai:case si:var x=t.def(l,"._texture");t(u,".uniform1i(",m,",",x,".bind());"),t.exit(x,".unbind();");continue;case Qr:case Zr:a="1i";break;case Xr:case ei:a="2i",w=2;break;case Kr:case ti:a="3i",w=3;break;case Jr:case ni:a="4i",w=4;break;case Gr:a="1f";break;case Hr:a="2f",w=2;break;case Yr:a="3f",w=3;break;case $r:a="4f",w=4;break;case ri:a="Matrix2fv";break;case ii:a="Matrix3fv";break;case oi:a="Matrix4fv"}if(t(u,".uniform",a,"(",m,","),"M"===a.charAt(0)){var _=Math.pow(p-ri+2,2),P=e.global.def("new Float32Array(",_,")");t("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",N(_,function(e){return P+"["+e+"]="+l+"["+e+"]"}),",",P,")")}else t(w>1?N(w,function(e){return l+"["+e+"]"}):l);t(");")}}function V(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var i,u=s.elements,f=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(f=n),i=u.append(e,f)):i=f.def(a,".",wr),i&&f("if("+i+")"+o+".bindBuffer("+Lr+","+i+".buffer.buffer);"),i}();function f(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var l,c,h=f(xr),p=f(Pr),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),M.optional(function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")})):(i=u.def(a,".",_r),M.optional(function(){e.assert(u,i+">=0","missing vertex count")})),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");y&&(l=f(Mr),c=e.instancing);var m=u+".type",v=s.elements&&Ci(s.elements);function g(){function e(){n(c,".drawElementsInstancedANGLE(",[h,d,m,p+"<<(("+m+"-"+Dn+")>>1)",l],");")}function t(){n(c,".drawArraysInstancedANGLE(",[h,p,d,l],");")}u?v?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function b(){function e(){n(o+".drawElements("+[h,d,m,p+"<<(("+m+"-"+Dn+")>>1)"]+");")}function t(){n(o+".drawArrays("+[h,p,d]+");")}u?v?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof l||l>=0)?"string"==typeof l?(n("if(",l,">0){"),g(),n("}else if(",l,"<0){"),b(),n("}")):g():b()}function W(e,t,n,r,i){var o=L(),a=o.proc("body",i);return M.optional(function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)}),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function G(e,t,n,r){B(e,t),U(e,t,n,r.attributes,function(){return!0}),q(e,t,n,r.uniforms,function(){return!0}),V(e,t,t,n)}function H(e,t,n,r){function i(){return!0}e.batchId="a1",B(e,t),U(e,t,n,r.attributes,i),q(e,t,n,r.uniforms,i),V(e,t,t,n)}function Y(e,t,n,r){B(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function f(e){return e.contextDep&&i||e.propDep}function l(e){return!f(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&D(e,u,n.context),n.needsFramebuffer&&R(e,u,n.framebuffer),F(e,u,n.state,f),n.profile&&f(n.profile)&&z(e,u,n,!1,!0),r)U(e,s,n,r.attributes,l),U(e,u,n,r.attributes,f),q(e,s,n,r.uniforms,l),q(e,u,n,r.uniforms,f),V(e,s,u,n);else{var c=e.global.def("{}"),h=n.shader.progVar.append(e,u),p=u.def(h,".id"),d=u.def(c,"[",p,"]");u(e.shared.gl,".useProgram(",h,".program);","if(!",d,"){",d,"=",c,"[",p,"]=",e.link(function(t){return W(H,e,n,t,2)}),"(",h,");}",d,".call(this,a0[",o,"],",o,");")}}function $(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===(void 0===e?"undefined":uo(e))&&!Pe(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(T.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,f=e.global.def("{}");o.forEach(function(t){var n=r[t];if(T.isDynamic(n)){"function"==typeof n&&(n=r[t]=T.unbox(n));var o=Ni(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(f,".",t,"="),void 0===n?"undefined":uo(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}}),t.dynamic[n]=new T.DynamicVariable(qn,{thisDep:a,contextDep:s,propDep:u,ref:f,append:function(e,t){o.forEach(function(n){var i=r[n];if(T.isDynamic(i)){var o=e.invoke(t,i);t(f,".",n,"=",o,";")}})}}),delete t.static[n]}}return{next:x,current:w,procs:function(){var e=L(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var o,a=e.shared,s=a.gl,u=a.next,f=a.current;r(f,".dirty=false;"),R(e,t),R(e,n,null,!0),y&&(o=e.link(y));for(var l=0;l<i.maxAttributes;++l){var c=n.def(a.attributes,"[",l,"]"),h=e.cond(c,".buffer");h.then(s,".enableVertexAttribArray(",l,");",s,".bindBuffer(",Cr,",",c,".buffer.buffer);",s,".vertexAttribPointer(",l,",",c,".size,",c,".type,",c,".normalized,",c,".stride,",c,".offset);").else(s,".disableVertexAttribArray(",l,");",s,".vertexAttrib4f(",l,",",c,".x,",c,".y,",c,".z,",c,".w);",c,".buffer=null;"),n(h),y&&n(o,".vertexAttribDivisorANGLE(",l,",",c,".divisor);")}return Object.keys(P).forEach(function(i){var o=P[i],a=r.def(u,".",i),l=e.block();l("if(",a,"){",s,".enable(",o,")}else{",s,".disable(",o,")}",f,".",i,"=",a,";"),n(l),t("if(",a,"!==",f,".",i,"){",l,"}")}),Object.keys(A).forEach(function(i){var o,a,l=A[i],c=w[i],h=e.block();if(h(s,".",l,"("),Pe(c)){var p=c.length;o=e.global.def(u,".",i),a=e.global.def(f,".",i),h(N(p,function(e){return o+"["+e+"]"}),");",N(p,function(e){return a+"["+e+"]="+o+"["+e+"];"}).join("")),t("if(",N(p,function(e){return o+"["+e+"]!=="+a+"["+e+"]"}).join("||"),"){",h,"}")}else o=r.def(u,".",i),a=r.def(f,".",i),h(o,");",f,".",i,"=",o,";"),t("if(",o,"!==",a,"){",h,"}");n(h)}),e.compile()}(),compile:function(e,t,r,s,f){var l=L();l.stats=l.link(f),Object.keys(t.static).forEach(function(e){$(l,t,e)}),jr.forEach(function(t){$(l,e,t)});var h=function(e,t,r,s,f){var l=e.static,h=e.dynamic;M.optional(function(){var e=[gr,yr,br,wr,xr,Pr,_r,Mr,vr].concat(_);function t(t){Object.keys(t).forEach(function(t){M.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',f.commandStr)})}t(l),t(h)});var p=function(e,t){var n=e.static,r=e.dynamic;if(gr in n){var i=n[gr];return i?(i=u.getFramebuffer(i),M.command(i,"invalid framebuffer object"),Li(function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+Ar,n+".width"),t.set(o,"."+Sr,n+".height"),n})):Li(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Ar,r+"."+Tr),t.set(r,"."+Sr,r+"."+Or),"null"})}if(gr in r){var o=r[gr];return Ni(o,function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");M.optional(function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")}),t.set(i,".next",a);var s=r.context;return t.set(s,"."+Ar,a+"?"+a+".width:"+s+"."+Tr),t.set(s,"."+Sr,a+"?"+a+".height:"+s+"."+Or),a})}return null}(e),d=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];M.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,f=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,M.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,M.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ji(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",Ar,"-",f));var i=s;return"height"in o||(i=t.def(n,".",Sr,"-",l)),[f,l,r,i]})}if(e in i){var c=i[e],h=Ni(c,function(t,n){var r=t.invoke(n,c);M.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ar,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Sr,"-",a,")");return M.optional(function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)}),[o,a,s,u]});return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new ji(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Ar),t.def(n,".",Sr)]}):null}var a=o(mr);if(a){var s=a;a=new ji(a.thisDep,a.contextDep,a.propDep,function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+kr,n[2]),t.set(r,"."+Er,n[3]),n})}return{viewport:a,scissor_box:o(dr)}}(e,p,f),m=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(wr in n){var e=n[wr];Ti(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e),M.command(e,"invalid elements",t.commandStr));var i=Li(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return i.value=e,i}if(wr in r){var o=r[wr];return Ni(o,function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),f=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return M.optional(function(){e.assert(f.else,"!"+a+"||"+s,"invalid elements")}),t.entry(f),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s})}return null}();function o(e,o){if(e in n){var a=0|n[e];return M.command(!o||a>=0,"invalid "+e,t.commandStr),Li(function(e,t){return o&&(e.OFFSET=a),a})}if(e in r){var s=r[e];return Ni(s,function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,M.optional(function(){t.assert(n,r+">=0","invalid "+e)})),r})}return o&&i?Li(function(e,t){return e.OFFSET="0",0}):null}var s=o(Pr,!0);return{elements:i,primitive:function(){if(xr in n){var e=n[xr];return M.commandParameter(e,se,"invalid primitve",t.commandStr),Li(function(t,n){return se[e]})}if(xr in r){var o=r[xr];return Ni(o,function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return M.optional(function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(se))}),t.def(n,"[",r,"]")})}return i?Ci(i)?i.value?Li(function(e,t){return t.def(e.ELEMENTS,".primType")}):Li(function(){return ui}):new ji(i.thisDep,i.contextDep,i.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",ui)}):null}(),count:function(){if(_r in n){var e=0|n[_r];return M.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Li(function(){return e})}if(_r in r){var o=r[_r];return Ni(o,function(e,t){var n=e.invoke(t,o);return M.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")}),n})}if(i){if(Ci(i)){if(i)return s?new ji(s.thisDep,s.contextDep,s.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return M.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):Li(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var a=Li(function(){return-1});return M.optional(function(){a.MISSING=!0}),a}var u=new ji(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return M.optional(function(){u.DYNAMIC=!0}),u}return null}(),instances:o(Mr,!1),offset:s}}(e,f),b=function(e,t){var n=e.static,r=e.dynamic,o={};return _.forEach(function(e){var a=S(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=Li(function(){return s})}else if(e in r){var u=r[e];o[a]=Ni(u,function(e,t){return i(e,t,e.invoke(t,u))})}}switch(e){case Zn:case Wn:case Vn:case ur:case $n:case pr:case rr:case or:case ar:case Kn:return s(function(n){return M.commandType(n,"boolean",e,t.commandStr),n},function(t,n,r){return M.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)}),r});case Qn:return s(function(n){return M.commandParameter(n,Ai,"invalid "+e,t.commandStr),Ai[n]},function(t,n,r){var i=t.constants.compareFuncs;return M.optional(function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Ai))}),n.def(i,"[",r,"]")});case Xn:return s(function(e){return M.command(Pe(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,n){return M.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]});case Yn:return s(function(e){M.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return M.commandParameter(n,Pi,a+".srcRGB",t.commandStr),M.commandParameter(r,Pi,a+".srcAlpha",t.commandStr),M.commandParameter(i,Pi,a+".dstRGB",t.commandStr),M.commandParameter(o,Pi,a+".dstAlpha",t.commandStr),M.command(-1===Mi.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Pi[n],Pi[i],Pi[r],Pi[o]]},function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return M.optional(function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Pi))}),s}M.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var a=o("src","RGB"),s=o("dst","RGB");M.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var u=n.def(i,"[",a,"]"),f=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),f,n.def(i,"[",o("dst","Alpha"),"]")]});case Hn:return s(function(n){return"string"==typeof n?(M.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"===(void 0===n?"undefined":uo(n))?(M.commandParameter(n.rgb,g,e+".rgb",t.commandStr),M.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void M.commandRaise("invalid blend.equation",t.commandStr)},function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return M.optional(function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")}),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]});case Gn:return s(function(e){return M.command(Pe(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,function(t){return+e[t]})},function(e,t,n){return M.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),N(4,function(e){return t.def("+",n,"[",e,"]")})});case fr:return s(function(e){return M.commandType(e,"number",a,t.commandStr),0|e},function(e,t,n){return M.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case lr:return s(function(n){M.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return M.commandParameter(r,Ai,e+".cmp",t.commandStr),M.commandType(i,"number",e+".ref",t.commandStr),M.commandType(o,"number",e+".mask",t.commandStr),[Ai[r],i,o]},function(e,t,n){var r=e.constants.compareFuncs;return M.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",vi),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]});case cr:case hr:return s(function(n){M.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return M.commandParameter(r,Si,e+".fail",t.commandStr),M.commandParameter(i,Si,e+".zfail",t.commandStr),M.commandParameter(o,Si,e+".zpass",t.commandStr),[e===hr?li:fi,Si[r],Si[i],Si[o]]},function(t,n,r){var i=t.constants.stencilOps;function o(o){return M.optional(function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(Si))}),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",vi)}return M.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===hr?li:fi,o("fail"),o("zfail"),o("zpass")]});case ir:return s(function(e){M.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return M.commandType(n,"number",a+".factor",t.commandStr),M.commandType(r,"number",a+".units",t.commandStr),[n,r]},function(t,n,r){return M.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[n.def(r,".factor|0"),n.def(r,".units|0")]});case er:return s(function(e){var n=0;return"front"===e?n=fi:"back"===e&&(n=li),M.command(!!n,a,t.commandStr),n},function(e,t,n){return M.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',fi,":",li)});case nr:return s(function(e){return M.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e},function(e,t,n){return M.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")}),n});case tr:return s(function(e){return M.commandParameter(e,Ei,a,t.commandStr),Ei[e]},function(e,t,n){return M.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+ci+":"+hi)});case Jn:return s(function(e){return M.command(Pe(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,n){return M.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),N(4,function(e){return"!!"+n+"["+e+"]"})});case sr:return s(function(e){M.command("object"===(void 0===e?"undefined":uo(e))&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return M.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]},function(e,t,n){return M.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]})}}),o}(e,f),w=function(e){var t=e.static,r=e.dynamic;function i(e){if(e in t){var i=n.id(t[e]);M.optional(function(){c.shader(ki[e],i,M.guessCommand())});var o=Li(function(){return i});return o.id=i,o}if(e in r){var a=r[e];return Ni(a,function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return M.optional(function(){n(t.shared.shader,".shader(",ki[e],",",i,",",t.command,");")}),i})}return null}var o,a=i(br),s=i(yr),u=null;return Ci(a)&&Ci(s)?(u=c.program(s.id,a.id),o=Li(function(e,t){return e.link(u)})):o=new ji(a&&a.thisDep||s&&s.thisDep,a&&a.contextDep||s&&s.contextDep,a&&a.propDep||s&&s.propDep,function(e,t){var n,r=e.shared.shader;n=a?a.append(e,t):t.def(r,".",br);var i=r+".program("+(s?s.append(e,t):t.def(r,".",yr))+","+n;return M.optional(function(){i+=","+e.command}),t.def(i+")")}),{frag:a,vert:s,progVar:o,program:u}}(e);function x(e){var t=d[e];t&&(b[e]=t)}x(mr),x(S(dr));var P=Object.keys(b).length>0,A={framebuffer:p,draw:m,shader:w,state:b,dirty:P};return A.profile=function(e){var t,n=e.static,r=e.dynamic;if(vr in n){var i=!!n[vr];(t=Li(function(e,t){return i})).enable=i}else if(vr in r){var o=r[vr];t=Ni(o,function(e,t){return e.invoke(t,o)})}return t}(e),A.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach(function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=Li(function(){return o});else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=Li(function(e){return e.link(o)}):"framebuffer"===a||"framebufferCube"===a?(M.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=Li(function(e){return e.link(o.color[0])})):M.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Pe(o)?r=Li(function(t){return t.global.def("[",N(o.length,function(n){return M.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]}),"]")}):M.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r}),Object.keys(r).forEach(function(e){var t=r[e];i[e]=Ni(t,function(e,n){return e.invoke(n,t)})}),i}(r,f),A.attributes=function(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach(function(e){var i=r[e],s=n.id(e),u=new v;if(Ti(i))u.state=Rn,u.buffer=o.getBuffer(o.create(i,Cr,!1,!0)),u.type=0;else{var f=o.getBuffer(i);if(f)u.state=Rn,u.buffer=f,u.type=0;else if(M.command("object"===(void 0===i?"undefined":uo(i))&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=In,"number"==typeof l?u.x=l:(M.command(Pe(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),Nn.forEach(function(e,t){t<l.length&&(u[e]=l[t])}))}else{f=Ti(i.buffer)?o.getBuffer(o.create(i.buffer,Cr,!1,!0)):o.getBuffer(i.buffer),M.command(!!f,'missing buffer for attribute "'+e+'"',t.commandStr);var c=0|i.offset;M.command(c>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|i.stride;M.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;M.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,m=0;"type"in i&&(M.commandParameter(i.type,X,"invalid type for attribute "+e,t.commandStr),m=X[i.type]);var g=0|i.divisor;"divisor"in i&&(M.command(0===g||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),M.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),M.optional(function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach(function(t){M.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)})}),u.buffer=f,u.state=Rn,u.size=p,u.normalized=d,u.type=m||f.dtype,u.offset=c,u.stride=h,u.divisor=g}}a[e]=Li(function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach(function(e){r[e]=u[e]}),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r})}),Object.keys(i).forEach(function(e){var t=i[e];a[e]=Ni(t,function(n,r){var i=n.invoke(r,t),o=n.shared,a=o.isBufferArgs,s=o.buffer;M.optional(function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+a+"("+i+")||"+s+".getBuffer("+i+")||"+s+".getBuffer("+i+".buffer)||"+a+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')});var u={isStream:r.def(!1)},f=new v;f.state=Rn,Object.keys(f).forEach(function(e){u[e]=r.def(""+f[e])});var l=u.buffer,c=u.type;function h(e){r(u[e],"=",i,".",e,"|0;")}return r("if(",a,"(",i,")){",u.isStream,"=true;",l,"=",s,".createStream(",Cr,",",i,");",c,"=",l,".dtype;","}else{",l,"=",s,".getBuffer(",i,");","if(",l,"){",c,"=",l,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",In,";","if(typeof "+i+'.constant === "number"){',u[Nn[0]],"=",i,".constant;",Nn.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",Nn.map(function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",a,"(",i,".buffer)){",l,"=",s,".createStream(",Cr,",",i,".buffer);","}else{",l,"=",s,".getBuffer(",i,".buffer);","}",c,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",l,".dtype;",u.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",u.isStream,"){",s,".destroyStream(",l,");","}"),u})}),a}(t,f),A.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=Li(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=Ni(t,function(e,n){return e.invoke(n,t)})}),r}(s),A}(e,t,r,s,l);return function(e,t){var n=e.proc("draw",1);B(e,n),D(e,n,t.context),R(e,n,t.framebuffer),I(e,n,t),F(e,n,t.state),z(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)G(e,n,t,t.shader.program);else{var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link(function(n){return W(G,e,t,n,1)}),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(l,h),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),Oi(Object.keys(t.state)).forEach(function(n){var o=t.state[n].append(e,r);Pe(o)?o.forEach(function(t,i){r.set(e.next[n],"["+i+"]",t)}):r.set(i.next,"."+n,o)}),z(e,r,t,!0,!0),[wr,Pr,_r,Mr,xr].forEach(function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))}),Object.keys(t.uniforms).forEach(function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))}),Object.keys(t.attributes).forEach(function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new v).forEach(function(e){r.set(o,"."+e,i[e])})}),a(yr),a(br),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(l,h),function(e,t){var n=e.proc("batch",2);e.batchId="0",B(e,n);var r=!1,i=!0;Object.keys(t.context).forEach(function(e){r=r||t.context[e].propDep}),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||R(e,n,o)):R(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),I(e,n,t),F(e,n,t.state,function(e){return!s(e)}),t.profile&&s(t.profile)||z(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)Y(e,n,t,null);else{var f=u.append(e,n);if(n(e.shared.gl,".useProgram(",f,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{var l=e.global.def("{}"),c=n.def(f,".id"),h=n.def(l,"[",c,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",l,"[",c,"]=",e.link(function(n){return W(Y,e,t,n,2)}),"(",f,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(l,h),l.compile()}}}var Ii=16384,Fi=256,Bi=1024;function zi(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=function(e){var n,r,i,o,a,s=e||{},u={},f=[],l=[],c="undefined"==typeof window?1:window.devicePixelRatio,h=!1,p=function(e){e&&M.raise(e)},d=function(){};if("string"==typeof s?(M("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),M(n,"invalid query string for element")):"object"===(void 0===s?"undefined":uo(s))?"string"==typeof(a=s).nodeName&&"function"==typeof a.appendChild&&"function"==typeof a.getBoundingClientRect?n=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(o=s).canvas:(M.constructor(s),"gl"in s?o=s.gl:"canvas"in s?i=L(s.canvas):"container"in s&&(r=L(s.container)),"attributes"in s&&(u=s.attributes,M.type(u,"object","invalid context attributes")),"extensions"in s&&(f=C(s.extensions)),"optionalExtensions"in s&&(l=C(s.optionalExtensions)),"onDone"in s&&(M.type(s.onDone,"function","invalid or missing onDone callback"),p=s.onDone),"profile"in s&&(h=!!s.profile),"pixelRatio"in s&&(c=+s.pixelRatio,M(c>0,"invalid pixel ratio"))):M.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){M("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var m=function(e,n,r){var i=document.createElement("canvas");function o(){var n=window.innerWidth,o=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,o=a.bottom-a.top}i.width=r*n,i.height=r*o,t(i.style,{width:n+"px",height:o+"px"})}return t(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",o,!1),o(),{canvas:i,onDestroy:function(){window.removeEventListener("resize",o),e.removeChild(i)}}}(r||document.body,0,c);if(!m)return null;i=m.canvas,d=m.onDestroy}o=function(e,t){function n(n){try{return e.getContext(n,t)}catch($o){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return o?{gl:o,canvas:i,container:r,extensions:f,optionalExtensions:l,pixelRatio:c,profile:h,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),a=i.isContextLost(),s=function(e,t){var n={};function r(t){M.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch($o){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)})}}}(i,r);if(!s)return null;var u,f,l=(u={"":0},f=[""],{id:function(e){var t=u[e];return t||(t=u[e]=f.length,f.push(e),t)},str:function(e){return f[e]}}),c={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},h=s.extensions,p=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function f(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var l=[],c=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),f(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:f,update:function(){var e,n,o=i.length;if(0!==o){c.length=Math.max(c.length,o+1),l.length=Math.max(l.length,o+1),l[0]=0,c[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var f=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(f,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(f,34918),r(f)):i[e++]=f,l[n+1]=a,c[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var h=u[n],p=h.startQueryIndex,d=h.endQueryIndex;h.sum+=l[d]-l[p];var m=c[p],v=c[d];v===m?(h.stats.gpuTime+=h.sum/1e6,s(h)):(h.startQueryIndex=m,h.endQueryIndex=v,u[e++]=h)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}}(0,h),d=j(),m=i.drawingBufferWidth,v=i.drawingBufferHeight,g={tick:0,time:0,viewportWidth:m,viewportHeight:v,framebufferWidth:m,framebufferHeight:v,drawingBufferWidth:m,drawingBufferHeight:v,pixelRatio:r.pixelRatio},y=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(3553,a),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,a,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=W.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),W.freeType(u)}}var f=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),c=W.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,c),W.freeType(c),e.bindTexture(34067,null),e.deleteTexture(l),f=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:f}}(i,h),b=function(e,t,n,r){for(var i=n.maxAttributes,o=new Array(i),a=0;a<i;++a)o[a]=new Pn;return{Record:Pn,scope:{},state:o}}(0,0,y),w=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=ee,this.byteLength=0,this.dimension=1,this.dtype=te,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){c(this)};var u=[];function f(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function l(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||ne,n.length>0)if(Array.isArray(n[0])){s=Z(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];t.dimension=l,f(t,u=J(n,s,t.dtype),r),a?t.persistentData=u:W.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=W.allocType(t.dtype,n.length);oe(h,n),f(t,h,r),a?t.persistentData=h:W.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||ie(n[0])||ne,f(t,u=J(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:W.freeType(u)):M.raise("invalid buffer data")}else if(e(n))t.dtype=i||ie(n),t.dimension=o,f(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(G(n)){s=n.shape;var p=n.stride,d=n.offset,m=0,v=0,g=0,y=0;1===s.length?(m=s[0],v=1,g=p[0],y=0):2===s.length?(m=s[0],v=s[1],g=p[0],y=p[1]):M.raise("invalid shape"),t.dtype=i||ie(n.data)||ne,t.dimension=v;var b=W.allocType(t.dtype,m*v);ae(b,n.data,m,v,g,y,d),f(t,b,r),a?t.persistentData=b:W.freeType(b)}else M.raise("invalid buffer data")}function c(e){n.bufferCount--;for(var r=0;r<i.state.length;++r){var o=i.state[r];o.buffer===e&&(t.disableVertexAttribArray(r),o.buffer=null)}var s=e.buffer;M(s,"buffer must not be deleted already"),t.deleteBuffer(s),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach(function(t){e+=a[t].stats.size}),e}),{create:function(i,o,u,f){n.bufferCount++;var h=new s(o);function p(n){var i=ee,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||G(n)?o=n:"number"==typeof n?a=0|n:n&&(M.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(M(null===o||Array.isArray(o)||e(o)||G(o),"invalid data for buffer"),o=n.data),"usage"in n&&(M.parameter(n.usage,K,"invalid buffer usage"),i=K[n.usage]),"type"in n&&(M.parameter(n.type,X,"invalid buffer type"),s=X[n.type]),"dimension"in n&&(M.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(M.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?l(h,o,i,s,u,f):(a&&t.bufferData(h.type,a,i),h.dtype=s||te,h.usage=i,h.dimension=u,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*re[h.dtype]),p}function d(e,n){M(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,u||p(i),p._reglType="buffer",p._buffer=h,p.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t))d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=W.allocType(h.dtype,t.length);oe(o,t),d(o,i),W.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=Z(t);var a=J(t,r,h.dtype);d(a,i),W.freeType(a)}else M.raise("invalid buffer data")}else if(G(t)){r=t.shape;var s=t.stride,u=0,f=0,l=0,c=0;1===r.length?(u=r[0],f=1,l=s[0],c=0):2===r.length?(u=r[0],f=r[1],l=s[0],c=s[1]):M.raise("invalid shape");var m=Array.isArray(t.data)?h.dtype:ie(t.data),v=W.allocType(m,u*f);ae(v,t.data,u,f,l,c,t.offset),d(v,i),W.freeType(v)}else M.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=h.stats),p.destroy=function(){c(h)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){H(a).forEach(c),u.forEach(c)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){H(a).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:l}}(i,c,r,b),x=function(t,n,r,i){var o={},a=0,s={uint8:he,uint16:de};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=le,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=ve),u.prototype.bind=function(){this.buffer.bind()};var f=[];function l(i,o,a,s,u,f,l){if(i.buffer.bind(),o){var c=l;l||e(o)&&(!G(o)||e(o.data))||(c=n.oes_element_index_uint?ve:de),r._initBuffer(i.buffer,o,a,c,3)}else t.bufferData(ge,f,a),i.buffer.dtype=h||he,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=f;var h=l;if(!l){switch(i.buffer.dtype){case he:case ce:h=he;break;case de:case pe:h=de;break;case ve:case me:h=ve;break;default:M.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,M(h!==ve||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,h===de?p>>=1:h===ve&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=le;var m=i.buffer.dimension;1===m&&(d=ue),2===m&&(d=fe),3===m&&(d=le)}i.primType=d}function c(e){i.elementsCount--,M(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,ge,!0),a=new u(o._buffer);function f(t){if(t)if("number"==typeof t)o(t),a.primType=le,a.vertCount=0|t,a.type=he;else{var n=null,r=ye,i=-1,u=-1,c=0,h=0;Array.isArray(t)||e(t)||G(t)?n=t:(M.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,M(Array.isArray(n)||e(n)||G(n),"invalid data for element buffer")),"usage"in t&&(M.parameter(t.usage,K,"invalid element buffer usage"),r=K[t.usage]),"primitive"in t&&(M.parameter(t.primitive,se,"invalid element buffer primitive"),i=se[t.primitive]),"count"in t&&(M("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(M.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?c=0|t.length:(c=u,h===de||h===pe?c*=2:h!==ve&&h!==me||(c*=4))),l(a,n,r,i,u,c,h)}else o(),a.primType=le,a.vertCount=0,a.type=he;return f}return i.elementsCount++,f(t),f._reglType="elements",f._elements=a,f.subdata=function(e,t){return o.subdata(e,t),f},f.destroy=function(){c(a)},f},createStream:function(e){var t=f.pop();return t||(t=new u(r.create(null,ge,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){f.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){H(o).forEach(c)}}}(i,h,w,c),_=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(n,r,a){var s=n===Mn?i:o,u=s[r];if(!u){var f=t.str(r);u=e.createShader(n),e.shaderSource(u,f),e.compileShader(u),M.shaderError(e,u,f,n,a),s[r]=u}return u}var f={},l=[],c=0;function h(e,t){this.id=c++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(n,i){var o,f,l=u(Mn,n.fragId),c=u(An,n.vertId),h=n.program=e.createProgram();e.attachShader(h,l),e.attachShader(h,c),e.linkProgram(h),M.linkError(e,h,t.str(n.fragId),t.str(n.vertId),i);var p=e.getProgramParameter(h,Sn);r.profile&&(n.stats.uniformsCount=p);var d=n.uniforms;for(o=0;o<p;++o)if(f=e.getActiveUniform(h,o))if(f.size>1)for(var m=0;m<f.size;++m){var v=f.name.replace("[0]","["+m+"]");s(d,new a(v,t.id(v),e.getUniformLocation(h,v),f))}else s(d,new a(f.name,t.id(f.name),e.getUniformLocation(h,f.name),f));var g=e.getProgramParameter(h,kn);r.profile&&(n.stats.attributesCount=g);var y=n.attributes;for(o=0;o<g;++o)(f=e.getActiveAttrib(h,o))&&s(y,new a(f.name,t.id(f.name),e.getAttribLocation(h,f.name),f))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return l.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return l.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);H(i).forEach(t),i={},H(o).forEach(t),o={},l.forEach(function(t){e.deleteProgram(t.program)}),l.length=0,f={},n.shaderCount=0},program:function(e,t,r){M.command(e>=0,"missing vertex shader",r),M.command(t>=0,"missing fragment shader",r);var i=f[t];i||(i=f[t]={});var o=i[e];return o||(o=new h(t,e),n.shaderCount++,p(o,r),i[e]=o,l.push(o)),o},restore:function(){i={},o={};for(var e=0;e<l.length;++e)p(l[e])},shader:u,frag:-1,vert:-1}}(i,l,c,r),P=function(n,r,i,o,a,s,u){var f={"don't care":_t,"dont care":_t,nice:Mt,fast:Pt},l={repeat:lt,clamp:ct,mirror:ht},c={nearest:mt,linear:vt},h=t({mipmap:wt,"nearest mipmap nearest":gt,"linear mipmap nearest":yt,"nearest mipmap linear":bt,"linear mipmap linear":wt},c),p={none:0,browser:Ot},d={uint8:it,rgba4:Ie,rgb565:Be,"rgb5 a1":Fe},m={alpha:Oe,luminance:Ce,"luminance alpha":Le,rgb:je,rgba:Te,rgba4:Ne,"rgb5 a1":De,rgb565:Re},v={};r.ext_srgb&&(m.srgb=Ve,m.srgba=We),r.oes_texture_float&&(d.float32=d.float=st),r.oes_texture_half_float&&(d.float16=d["half float"]=Ge),r.webgl_depth_texture&&(t(m,{depth:Ue,"depth stencil":qe}),t(d,{uint16:ot,uint32:at,"depth stencil":ze})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":He,"rgba s3tc dxt1":Ye,"rgba s3tc dxt3":$e,"rgba s3tc dxt5":Qe}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":Xe,"rgba atc explicit alpha":Ke,"rgba atc interpolated alpha":Je}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":Ze,"rgb pvrtc 2bppv1":et,"rgba pvrtc 4bppv1":tt,"rgba pvrtc 2bppv1":nt}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=rt);var g=Array.prototype.slice.call(n.getParameter(Ae));Object.keys(v).forEach(function(e){var t=v[e];g.indexOf(t)>=0&&(m[e]=t)});var y=Object.keys(m);i.textureFormats=y;var b=[];Object.keys(m).forEach(function(e){var t=m[e];b[t]=e});var w=[];Object.keys(d).forEach(function(e){var t=d[e];w[t]=e});var x=[];Object.keys(c).forEach(function(e){var t=c[e];x[t]=e});var _=[];Object.keys(h).forEach(function(e){var t=h[e];_[t]=e});var P=[];Object.keys(l).forEach(function(e){var t=l[e];P[t]=e});var A=y.reduce(function(e,t){var n=m[t];return n===Ce||n===Oe||n===Ce||n===Le||n===Ue||n===qe?e[n]=n:n===De||t.indexOf("rgba")>=0?e[n]=Te:e[n]=je,e},{});function S(){this.internalformat=Te,this.format=Te,this.type=it,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ot,this.width=0,this.height=0,this.channels=0}function k(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function E(e,t){if("object"===(void 0===t?"undefined":uo(t))&&t){if("premultiplyAlpha"in t&&(M.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(M.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(M.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(M.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;M(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),M(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),M(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(n,d,"invalid texture type"),e.type=d[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(M(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],M(s>0&&s<=4,"invalid number of channels"),u=!0),M(o>=0&&o<=i.maxTextureSize,"invalid width"),M(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,M(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,M(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,M(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,M(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var f=!1;if("format"in t){var l=t.format;M(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(l,m,"invalid texture format");var c=e.internalformat=m[l];e.format=A[c],l in d&&("type"in t||(e.type=d[l])),l in v&&(e.compressed=!0),f=!0}!u&&f?e.channels=Nt[e.format]:u&&!f?e.channels!==Lt[e.format]&&(e.format=e.internalformat=Lt[e.channels]):f&&u&&M(e.channels===Nt[e.format],"number of channels inconsistent with specified format")}}function T(e){n.pixelStorei(kt,e.flipY),n.pixelStorei(Et,e.premultiplyAlpha),n.pixelStorei(Tt,e.colorSpace),n.pixelStorei(St,e.unpackAlignment)}function O(){S.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function j(t,n){var r=null;if($t(n)?r=n:n&&(M.type(n,"object","invalid pixel data type"),E(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),$t(n.data)&&(r=n.data)),M(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){M(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,M(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==it||(t.type=Qt(r));else if(Wt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case it:case ot:case at:case st:var r=W.allocType(e.type,n);r.set(t),e.data=r;break;case Ge:e.data=_e(t);break;default:M.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(G(r)){var u=r.data;Array.isArray(u)||t.type!==it||(t.type=Qt(u));var f,l,c,h,p,d,m=r.shape,v=r.stride;3===m.length?(c=m[2],d=v[2]):(M(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),c=1,d=1),f=m[0],l=m[1],h=v[0],p=v[1],t.alignment=1,t.width=f,t.height=l,t.channels=c,t.format=t.internalformat=Lt[c],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,f=Xt(e,a*s*u),l=0,c=0;c<s;++c)for(var h=0;h<a;++h)for(var p=0;p<u;++p)f[l++]=t[n*h+r*c+i*p+o];Kt(e,f)}(t,u,h,p,d,r.offset)}else if(Yt(r)||Ht(r)===It)Yt(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Ht(r)===Ft)t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Ht(r)===Bt)t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Ht(r)===zt)t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Gt(r)){var g=t.width||r[0].length,y=t.height||r.length,b=t.channels;b=Pe(r[0][0])?b||r[0][0].length:b||1;for(var w=Y.shape(r),x=1,_=0;_<w.length;++_)x*=w[_];var P=Xt(t,x);Y.flatten(r,w,"",P),Kt(t,P),t.alignment=1,t.width=g,t.height=y,t.channels=b,t.format=t.internalformat=Lt[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===st?M(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Ge&&M(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function C(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,f=e.type,l=e.width,c=e.height,h=e.channels;if(T(e),i)n.texImage2D(t,r,u,u,f,i);else if(e.compressed)n.compressedTexImage2D(t,r,s,l,c,0,a);else if(e.needsCopy)o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,l,c,0);else{var p=!a;p&&(a=W.zero.allocType(f,l*c*h)),n.texImage2D(t,r,u,l,c,0,u,f,a),p&&a&&W.zero.freeType(a)}}function L(e,t,r,i,a){var s=e.element,u=e.data,f=e.internalformat,l=e.format,c=e.type,h=e.width,p=e.height;T(e),s?n.texSubImage2D(t,a,r,i,l,c,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,f,h,p,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,p)):n.texSubImage2D(t,a,r,i,h,p,l,c,u)}var N=[];function D(){return N.pop()||new O}function R(e){e.needsFree&&W.freeType(e.data),O.call(e),N.push(e)}function I(){S.call(this),this.genMipmaps=!1,this.mipmapHint=_t,this.mipmask=0,this.images=Array(16)}function F(e,t,n){var r=e.images[0]=D();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function B(e,t){var n=null;if($t(t))k(n=e.images[0]=D(),e),j(n,t),e.mipmask=1;else if(E(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)k(n=e.images[i]=D(),e),n.width>>=i,n.height>>=i,j(n,r[i]),e.mipmask|=1<<i;else k(n=e.images[0]=D(),e),j(n,t),e.mipmask=1;k(e,e.images[0]),(e.compressed&&e.internalformat===He||e.internalformat===Ye||e.internalformat===$e||e.internalformat===Qe)&&M(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;C(n[r],t,r)}}var U=[];function q(){var e=U.pop()||new I;S.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function V(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&R(t[n]),t[n]=null;U.push(e)}function $(){this.minFilter=mt,this.magFilter=mt,this.wrapS=ct,this.wrapT=ct,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=_t}function Q(e,t){if("min"in t){var n=t.min;M.parameter(n,h),e.minFilter=h[n],Ct.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;M.parameter(r,c),e.magFilter=c[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(M.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(M.parameter(s[0],l),M.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;M.parameter(u,l),o=l[u]}if("wrapT"in t){var p=t.wrapT;M.parameter(p,l),a=l[p]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var d=t.anisotropic;M("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(uo(t.mipmap)){case"string":M.parameter(t.mipmap,f,"invalid mipmap hint"),e.mipmapHint=f[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":M(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:M.raise("invalid mipmap type")}!m||"min"in t||(e.minFilter=gt)}}function X(e,t){n.texParameteri(t,dt,e.minFilter),n.texParameteri(t,pt,e.magFilter),n.texParameteri(t,ut,e.wrapS),n.texParameteri(t,ft,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,At,e.anisotropic),e.genMipmaps&&(n.hint(xt,e.mipmapHint),n.generateMipmap(t))}var K=0,J={},Z=i.maxTextureUnits,ee=Array(Z).map(function(){return null});function te(e){S.call(this),this.mipmask=0,this.internalformat=Te,this.id=K++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new $,u.profile&&(this.stats={size:0})}function ne(e){n.activeTexture(jt),n.bindTexture(e.target,e.texture)}function re(){var e=ee[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(Se,null)}function ie(e){var t=e.texture;M(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(jt+r),n.bindTexture(i,null),ee[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],s.textureCount--}return t(te.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<Z;++t){var r=ee[t];if(r){if(r.bindCount>0)continue;r.unit=-1}ee[t]=this,e=t;break}e>=Z&&M.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,n.activeTexture(jt+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ie(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach(function(t){e+=J[t].stats.size}),e}),{create2D:function(e,t){var r=new te(Se);function o(e,t){var n=r.texInfo;$.call(n);var a=q();return"number"==typeof e?F(a,0|e,"number"==typeof t?0|t:0|e):e?(M.type(e,"object","invalid arguments to regl.texture"),Q(n,e),B(a,e)):F(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,k(r,a),M.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,ne(r),z(a,Se),X(n,Se),re(),V(a),u.profile&&(r.stats.size=Jt(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=w[r.type],o.mag=x[n.magFilter],o.min=_[n.minFilter],o.wrapS=P[n.wrapS],o.wrapT=P[n.wrapT],o}return J[r.id]=r,s.textureCount++,o(e,t),o.subimage=function(e,t,n,i){M(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,f=D();return k(f,r),f.width=0,f.height=0,j(f,e),f.width=f.width||(r.width>>u)-a,f.height=f.height||(r.height>>u)-s,M(r.type===f.type&&r.format===f.format&&r.internalformat===f.internalformat,"incompatible format for texture.subimage"),M(a>=0&&s>=0&&a+f.width<=r.width&&s+f.height<=r.height,"texture.subimage write out of bounds"),M(r.mipmask&1<<u,"missing mipmap data"),M(f.data||f.element||f.needsCopy,"missing image data"),ne(r),L(f,Se,a,s,u),re(),R(f),o},o.resize=function(e,t){var i,a=0|e,s=0|t||a;if(a===r.width&&s===r.height)return o;o.width=r.width=a,o.height=r.height=s,ne(r);for(var f=r.channels,l=r.type,c=0;r.mipmask>>c;++c){var h=a>>c,p=s>>c;if(!h||!p)break;i=W.zero.allocType(l,h*p*f),n.texImage2D(Se,c,r.format,h,p,0,r.format,r.type,i),i&&W.zero.freeType(i)}return re(),u.profile&&(r.stats.size=Jt(r.internalformat,r.type,a,s,!1,!1)),o},o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,a,f){var l=new te(ke);J[l.id]=l,s.cubeCount++;var c=new Array(6);function h(e,t,n,r,o,a){var s,f=l.texInfo;for($.call(f),s=0;s<6;++s)c[s]=q();if("number"!=typeof e&&e)if("object"===(void 0===e?"undefined":uo(e)))if(t)B(c[0],e),B(c[1],t),B(c[2],n),B(c[3],r),B(c[4],o),B(c[5],a);else if(Q(f,e),E(l,e),"faces"in e){var p=e.faces;for(M(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)M("object"===uo(p[s])&&!!p[s],"invalid input for cube map face"),k(c[s],l),B(c[s],p[s])}else for(s=0;s<6;++s)B(c[s],e);else M.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)F(c[s],d,d)}for(k(l,c[0]),i.npotTextureCube||M(Me(l.width)&&Me(l.height),"your browser does not support non power or two texture dimensions"),f.genMipmaps?l.mipmask=(c[0].width<<1)-1:l.mipmask=c[0].mipmask,M.textureCube(l,f,c,i),l.internalformat=c[0].internalformat,h.width=c[0].width,h.height=c[0].height,ne(l),s=0;s<6;++s)z(c[s],Ee+s);for(X(f,ke),re(),u.profile&&(l.stats.size=Jt(l.internalformat,l.type,h.width,h.height,f.genMipmaps,!0)),h.format=b[l.internalformat],h.type=w[l.type],h.mag=x[f.magFilter],h.min=_[f.minFilter],h.wrapS=P[f.wrapS],h.wrapT=P[f.wrapT],s=0;s<6;++s)V(c[s]);return h}return h(e,t,r,o,a,f),h.subimage=function(e,t,n,r,i){M(!!t,"must specify image data"),M("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return k(u,l),u.width=0,u.height=0,j(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,M(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),M(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),M(l.mipmask&1<<s,"missing mipmap data"),M(u.data||u.element||u.needsCopy,"missing image data"),ne(l),L(u,Ee+e,o,a,s),re(),R(u),h},h.resize=function(e){var t=0|e;if(t!==l.width){h.width=l.width=t,h.height=l.height=t,ne(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(Ee+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return re(),u.profile&&(l.stats.size=Jt(l.internalformat,l.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=l,u.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){for(var e=0;e<Z;++e)n.activeTexture(jt+e),n.bindTexture(Se,null),ee[e]=null;H(J).forEach(ie),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<Z;++e){var t=ee[e];t&&(t.bindCount=0,t.unit=-1,ee[e]=null)}H(J).forEach(function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Se)n.texImage2D(Se,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(Ee+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);X(e.texInfo,e.target)})}}}(i,h,y,function(){k.procs.poll()},g,c,r),A=function(e,t,n,r,i){var o={rgba4:en,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var a=[];Object.keys(o).forEach(function(e){var t=o[e];a[t]=e});var s=0,u={};function f(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=en,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;M(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(Zt,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return f.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach(function(t){e+=u[t].stats.size}),e}),{create:function(t,s){var l=new f(e.createRenderbuffer());function c(t,r){var s=0,u=0,f=en;if("object"===(void 0===t?"undefined":uo(t))&&t){var h=t;if("shape"in h){var p=h.shape;M(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in h&&(s=u=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(M.parameter(h.format,o,"invalid renderbuffer format"),f=o[h.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?M.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(M(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||f!==l.format)return c.width=l.width=s,c.height=l.height=u,l.format=f,e.bindRenderbuffer(Zt,l.renderbuffer),e.renderbufferStorage(Zt,f,s,u),M(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=nn(l.format,l.width,l.height)),c.format=a[l.format],c}return u[l.id]=l,r.renderbufferCount++,c(t,s),c.resize=function(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height?c:(M(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),c.width=l.width=o,c.height=l.height=a,e.bindRenderbuffer(Zt,l.renderbuffer),e.renderbufferStorage(Zt,l.format,o,a),M(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=nn(l.format,l.width,l.height)),c)},c._reglType="renderbuffer",c._renderbuffer=l,i.profile&&(c.stats=l.stats),c.destroy=function(){l.decRef()},c},clear:function(){H(u).forEach(l)},restore:function(){H(u).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Zt,t.renderbuffer),e.renderbufferStorage(Zt,t.format,t.width,t.height)}),e.bindRenderbuffer(Zt,null)}}}(i,h,y,c,r),S=function(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],f=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&f.push("srgba"),n.ext_color_buffer_half_float&&f.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&f.push("rgba32f");var l=["uint8"];function c(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);M(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;M(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(rn,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(rn,t,on,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=an,n=null,r=null,i=e;"object"===(void 0===e?"undefined":uo(e))&&(i=e.data,"target"in e&&(t=0|e.target)),M.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,M(t===an)):"textureCube"===o?(n=i,M(t>=sn&&t<sn+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=on):M.raise("invalid regl object for attachment"),new c(t,n,r)}function v(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new c(an,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new c(on,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var b=0,w={};function x(){this.id=b++,w[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function P(t){var n=t.framebuffer;M(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete w[t.id]}function A(t){var n;e.bindFramebuffer(rn,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(un+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(rn,un+n,an,null,0);e.framebufferTexture2D(rn,cn,an,null,0),e.framebufferTexture2D(rn,fn,an,null,0),e.framebufferTexture2D(rn,ln,an,null,0),d(fn,t.depthAttachment),d(ln,t.stencilAttachment),d(cn,t.depthStencilAttachment);var o=e.checkFramebufferStatus(rn);e.isContextLost()||o===hn||M.raise("framebuffer configuration not supported, status = "+xn[o]),e.bindFramebuffer(rn,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function S(e,i){var o=new x;function c(e,t){var i;M(s.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,d=!0,y=!0,b=null,w=!0,x="rgba",P="uint8",S=1,k=null,E=null,T=null,O=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){M.type(e,"object","invalid arguments for framebuffer");var j=e;if("shape"in j){var C=j.shape;M(Array.isArray(C)&&C.length>=2,"invalid shape for framebuffer"),a=C[0],h=C[1]}else"radius"in j&&(a=h=j.radius),"width"in j&&(a=j.width),"height"in j&&(h=j.height);("color"in j||"colors"in j)&&(b=j.color||j.colors,Array.isArray(b)&&M(1===b.length||n.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in j&&(S=0|j.colorCount,M(S>0,"invalid color buffer count")),"colorTexture"in j&&(w=!!j.colorTexture,x="rgba4"),"colorType"in j&&(P=j.colorType,w?(M(n.oes_texture_float||!("float"===P||"float32"===P),"you must enable OES_texture_float in order to use floating point framebuffer objects"),M(n.oes_texture_half_float||!("half float"===P||"float16"===P),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===P||"float16"===P?(M(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==P&&"float32"!==P||(M(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),M.oneOf(P,l,"invalid color type")),"colorFormat"in j&&(x=j.colorFormat,u.indexOf(x)>=0?w=!0:f.indexOf(x)>=0?w=!1:w?M.oneOf(j.colorFormat,u,"invalid color format for texture"):M.oneOf(j.colorFormat,f,"invalid color format for renderbuffer"))),("depthTexture"in j||"depthStencilTexture"in j)&&(O=!(!j.depthTexture&&!j.depthStencilTexture),M(!O||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in j&&("boolean"==typeof j.depth?d=j.depth:(k=j.depth,y=!1)),"stencil"in j&&("boolean"==typeof j.stencil?y=j.stencil:(E=j.stencil,d=!1)),"depthStencil"in j&&("boolean"==typeof j.depthStencil?d=y=j.depthStencil:(T=j.depthStencil,d=!1,y=!1))}else a=h=1;var L=null,N=null,D=null,R=null;if(Array.isArray(b))L=b.map(m);else if(b)L=[m(b)];else for(L=new Array(S),i=0;i<S;++i)L[i]=v(a,h,w,x,P);M(n.webgl_draw_buffers||L.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),M(L.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||L[0].width,h=h||L[0].height,k?N=m(k):d&&!y&&(N=v(a,h,O,"depth","uint32")),E?D=m(E):y&&!d&&(D=v(a,h,!1,"stencil","uint8")),T?R=m(T):!k&&!E&&y&&d&&(R=v(a,h,O,"depth stencil","depth stencil")),M(!!k+!!E+!!T<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var I=null;for(i=0;i<L.length;++i)if(p(L[i],a,h),M(!L[i]||L[i].texture&&dn.indexOf(L[i].texture._texture.format)>=0||L[i].renderbuffer&&wn.indexOf(L[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),L[i]&&L[i].texture){var F=mn[L[i].texture._texture.format]*vn[L[i].texture._texture.type];null===I?I=F:M(I===F,"all color attachments much have the same number of bits per pixel.")}return p(N,a,h),M(!N||N.texture&&N.texture._texture.format===pn||N.renderbuffer&&N.renderbuffer._renderbuffer.format===gn,"invalid depth attachment for framebuffer object"),p(D,a,h),M(!D||D.renderbuffer&&D.renderbuffer._renderbuffer.format===yn,"invalid stencil attachment for framebuffer object"),p(R,a,h),M(!R||R.texture&&R.texture._texture.format===bn||R.renderbuffer&&R.renderbuffer._renderbuffer.format===bn,"invalid depth-stencil attachment for framebuffer object"),_(o),o.width=a,o.height=h,o.colorAttachments=L,o.depthAttachment=N,o.stencilAttachment=D,o.depthStencilAttachment=R,c.color=L.map(g),c.depth=g(N),c.stencil=g(D),c.depthStencil=g(R),c.width=o.width,c.height=o.height,A(o),c}return a.framebufferCount++,c(e,i),t(c,{resize:function(e,t){M(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return c;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=c.width=n,o.height=c.height=r,A(o),c},_reglType:"framebuffer",_framebuffer:o,destroy:function(){P(o),_(o)},use:function(e){s.setFBO({framebuffer:c},e)}})}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:S,createCube:function(e){var o=Array(6);function a(e){var r;M(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var f,c={color:null},h=0,p=null,d="rgba",m="uint8",v=1;if("number"==typeof e)h=0|e;else if(e){M.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;M(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),M(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in g&&(h=0|g.radius),"width"in g?(h=0|g.width,"height"in g&&M(g.height===h,"must be square")):"height"in g&&(h=0|g.height);("color"in g||"colors"in g)&&(p=g.color||g.colors,Array.isArray(p)&&M(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in g&&(v=0|g.colorCount,M(v>0,"invalid color buffer count")),"colorType"in g&&(M.oneOf(g.colorType,l,"invalid color type"),m=g.colorType),"colorFormat"in g&&(d=g.colorFormat,M.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(c.depth=g.depth),"stencil"in g&&(c.stencil=g.stencil),"depthStencil"in g&&(c.depthStencil=g.depthStencil)}else h=1;if(p)if(Array.isArray(p))for(f=[],r=0;r<p.length;++r)f[r]=p[r];else f=[p];else{f=Array(v);var b={radius:h,format:d,type:m};for(r=0;r<v;++r)f[r]=i.createCube(b)}for(c.color=Array(f.length),r=0;r<f.length;++r){var w=f[r];M("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),h=h||w.width,M(w.width===h&&w.height===h,"invalid cube map shape"),c.color[r]={target:sn,data:f[r]}}for(r=0;r<6;++r){for(var x=0;x<f.length;++x)c.color[x].target=sn+r;r>0&&(c.depth=o[0].depth,c.stencil=o[0].stencil,c.depthStencil=o[0].depthStencil),o[r]?o[r](c):o[r]=S(c)}return t(a,{width:h,height:h,color:f})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(M(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach(function(e){e.destroy()})}})},clear:function(){H(w).forEach(P)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,H(w).forEach(function(t){t.framebuffer=e.createFramebuffer(),A(t)})}})}(i,h,y,P,A,c),k=Ri(i,l,h,y,w,x,0,S,{},b,_,{elements:null,primitive:4,count:-1,offset:0,instances:-1},g,p,r),E=function(t,n,r,i,o,a,s){function u(u){var f;null===n.next?(M(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),f=Tn):(M(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),f=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(M(f===Tn||f===jn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),f===jn&&M(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):M(f===Tn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var l=0,c=0,h=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(M.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,c=0|u.y,M(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),M(c>=0&&c<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-l),p=0|(u.height||i.framebufferHeight-c),d=u.data||null),d&&(f===Tn?M(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):f===jn&&M(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),M(h>0&&h+l<=i.framebufferWidth,"invalid width for read pixels"),M(p>0&&p+c<=i.framebufferHeight,"invalid height for read pixels"),r();var m=h*p*4;return d||(f===Tn?d=new Uint8Array(m):f===jn&&(d=d||new Float32Array(m))),M.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),M(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(On,4),t.readPixels(l,c,h,p,En,f,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},function(){t=u(e)}),t}(e):u(e)}}(i,S,k.procs.poll,g,o,h,y),N=k.next,D=i.canvas,R=[],I=[],F=[],B=[r.onDestroy],z=null;function U(){if(0===R.length)return p&&p.update(),void(z=null);z=O.next(U),Ut();for(var e=R.length-1;e>=0;--e){var t=R[e];t&&t(g,null,0)}i.flush(),p&&p.update()}function q(){!z&&R.length>0&&(z=O.next(U))}function V(){z&&(O.cancel(U),z=null)}function $(e){e.preventDefault(),a=!0,V(),I.forEach(function(e){e()})}function Q(e){i.getError(),a=!1,s.restore(),_.restore(),w.restore(),P.restore(),A.restore(),S.restore(),p&&p.restore(),k.procs.refresh(),q(),F.forEach(function(e){e()})}function be(e){function n(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];T.isDynamic(i)?n[r]=T.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}M(!!e,"invalid args to regl({...})"),M.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),n}(e)),u={gpuTime:0,cpuTime:0,count:0},f=k.compile(s,o,i,r,u),l=f.draw,c=f.batch,h=f.scope,p=[];return t(function(e,t){var n;if(a&&M.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(n=0;n<e;++n)h.call(this,null,t,n);return}if(Array.isArray(e)){for(n=0;n<e.length;++n)h.call(this,e[n],t,n);return}return h.call(this,e,t,0)}if("number"==typeof e){if(e>0)return c.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return c.call(this,e,e.length)}},{stats:u})}D&&(D.addEventListener("webglcontextlost",$,!1),D.addEventListener("webglcontextrestored",Q,!1));var we=S.setFBO=be({framebuffer:T.define.call(null,1,"framebuffer")});function xe(e,t){var n=0;k.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=Ii),"depth"in t&&(i.clearDepth(+t.depth),n|=Fi),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=Bi),M(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function Dt(e){return M.type(e,"function","regl.frame() callback must be a function"),R.push(e),q(),{cancel:function(){var t=zi(R,e);M(t>=0,"cannot cancel a frame twice"),R[t]=function e(){var t=zi(R,e);R[t]=R[R.length-1],R.length-=1,R.length<=0&&V()}}}}function Rt(){var e=N.viewport,t=N.scissor_box;e[0]=e[1]=t[0]=t[1]=0,g.viewportWidth=g.framebufferWidth=g.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,g.viewportHeight=g.framebufferHeight=g.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function Ut(){g.tick+=1,g.time=Vt(),Rt(),k.procs.poll()}function qt(){Rt(),k.procs.refresh(),p&&p.update()}function Vt(){return(j()-d)/1e3}qt();var tn=t(be,{clear:function(e){if(M("object"===(void 0===e?"undefined":uo(e))&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)we(t({framebuffer:e.framebuffer.faces[n]},e),xe);else we(e,xe);else xe(0,e)},prop:T.define.bind(null,1),context:T.define.bind(null,2),this:T.define.bind(null,3),draw:be({}),buffer:function(e){return w.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:P.create2D,cube:P.createCube,renderbuffer:A.create,framebuffer:S.create,framebufferCube:S.createCube,attributes:o,frame:Dt,on:function(e,t){var n;switch(M.type(t,"function","listener callback must be a function"),e){case"frame":return Dt(t);case"lost":n=I;break;case"restore":n=F;break;case"destroy":n=B;break;default:M.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:y,hasExtension:function(e){return y.extensions.indexOf(e.toLowerCase())>=0},read:E,destroy:function(){R.length=0,V(),D&&(D.removeEventListener("webglcontextlost",$),D.removeEventListener("webglcontextrestored",Q)),_.clear(),S.clear(),A.clear(),P.clear(),x.clear(),w.clear(),p&&p.clear(),B.forEach(function(e){e()})},_gl:i,_refresh:qt,poll:function(){Ut(),p&&p.update()},now:Vt,stats:c});return r.onDone(null,tn),tn}},"object"===(void 0===so.exports?"undefined":uo(so.exports))?so.exports=no():"function"==typeof define&&define.amd?define(no):this.createREGL=no(),so=so.exports;var fo={};(fo=co).float32=fo.float=co,fo.fract32=fo.fract=function(e){if(e.length){for(var t=co(e),n=0,r=t.length;n<r;n++)t[n]=e[n]-t[n];return t}return co(e-co(e))};var lo=new Float32Array(1);function co(e){if(e.length){if(e instanceof Float32Array)return e;var t=new Float32Array(e);return t.set(e),t}return lo[0]=e,lo[0]}var ho=go,po=vo("in",document.body);function mo(e,t){var n=ao(getComputedStyle(e).getPropertyValue(t));return n[0]*go(n[1],e)}function vo(e,t){var n=document.createElement("div");n.style.height="128"+e,t.appendChild(n);var r=mo(n,"height")/128;return t.removeChild(n),r}function go(e,t){if(!e)return null;switch(t=t||document.body,e=(e+""||"px").trim().toLowerCase(),t!==window&&t!==document||(t=document.body),e){case"%":return t.clientHeight/100;case"ch":case"ex":return vo(e,t);case"em":return mo(t,"font-size");case"rem":return mo(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return po;case"cm":return po/2.54;case"mm":return po/25.4;case"pt":return po/72;case"pc":return po/6;case"px":return 1}var n=ao(e);if(!isNaN(n[0])&&n[1]){var r=go(n[1],t);return"number"==typeof r?n[0]*r:null}return null}var yo={};function bo(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}yo.INT_BITS=32,yo.INT_MAX=2147483647,yo.INT_MIN=-1<<31,yo.sign=function(e){return(e>0)-(e<0)},yo.abs=function(e){var t=e>>31;return(e^t)-t},yo.min=function(e,t){return t^(e^t)&-(e<t)},yo.max=function(e,t){return e^(e^t)&-(e<t)},yo.isPow2=function(e){return!(e&e-1||!e)},yo.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},yo.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},yo.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},yo.countTrailingZeros=bo,yo.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},yo.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},yo.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var wo=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;e[t]=r<<i&255}}(wo),yo.reverse=function(e){return wo[255&e]<<24|wo[e>>>8&255]<<16|wo[e>>>16&255]<<8|wo[e>>>24&255]},yo.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},yo.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},yo.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},yo.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},yo.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>bo(e)+1};var xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_o=function(e,t){switch(void 0===t&&(t=0),void 0===e?"undefined":xo(e)){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,n,r){var i=0|t[r];if(i<=0)return[];var o,a=new Array(i);if(r===t.length-1)for(o=0;o<i;++o)a[o]=n;else for(o=0;o<i;++o)a[o]=e(t,n,r+1);return a}(e,t,0)}return[]},Po={};(function(e,t){"use strict";e.__TYPEDARRAY_POOL||(e.__TYPEDARRAY_POOL={UINT8:_o([32,0]),UINT16:_o([32,0]),UINT32:_o([32,0]),INT8:_o([32,0]),INT16:_o([32,0]),INT32:_o([32,0]),FLOAT:_o([32,0]),DOUBLE:_o([32,0]),DATA:_o([32,0]),UINT8C:_o([32,0]),BUFFER:_o([32,0])});var n="undefined"!=typeof Uint8ClampedArray,r=e.__TYPEDARRAY_POOL;r.UINT8C||(r.UINT8C=_o([32,0])),r.BUFFER||(r.BUFFER=_o([32,0]));var i=r.DATA,o=r.BUFFER;function a(e){if(e){var t=e.length||e.byteLength,n=yo.log2(t);i[n].push(e)}}function s(e){e=yo.nextPow2(e);var t=yo.log2(e),n=i[t];return n.length>0?n.pop():new ArrayBuffer(e)}function u(e){return new Uint8Array(s(e),0,e)}function f(e){return new Uint16Array(s(2*e),0,e)}function l(e){return new Uint32Array(s(4*e),0,e)}function c(e){return new Int8Array(s(e),0,e)}function h(e){return new Int16Array(s(2*e),0,e)}function p(e){return new Int32Array(s(4*e),0,e)}function d(e){return new Float32Array(s(4*e),0,e)}function m(e){return new Float64Array(s(8*e),0,e)}function v(e){return n?new Uint8ClampedArray(s(e),0,e):u(e)}function g(e){return new DataView(s(e),0,e)}function y(e){e=yo.nextPow2(e);var n=yo.log2(e),r=o[n];return r.length>0?r.pop():new t(e)}Po.free=function(e){if(t.isBuffer(e))o[yo.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var n=e.length||e.byteLength,r=0|yo.log2(n);i[r].push(e)}},Po.freeUint8=Po.freeUint16=Po.freeUint32=Po.freeInt8=Po.freeInt16=Po.freeInt32=Po.freeFloat32=Po.freeFloat=Po.freeFloat64=Po.freeDouble=Po.freeUint8Clamped=Po.freeDataView=function(e){a(e.buffer)},Po.freeArrayBuffer=a,Po.freeBuffer=function(e){o[yo.log2(e.length)].push(e)},Po.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return s(e);switch(t){case"uint8":return u(e);case"uint16":return f(e);case"uint32":return l(e);case"int8":return c(e);case"int16":return h(e);case"int32":return p(e);case"float":case"float32":return d(e);case"double":case"float64":return m(e);case"uint8_clamped":return v(e);case"buffer":return y(e);case"data":case"dataview":return g(e);default:return null}return null},Po.mallocArrayBuffer=s,Po.mallocUint8=u,Po.mallocUint16=f,Po.mallocUint32=l,Po.mallocInt8=c,Po.mallocInt16=h,Po.mallocInt32=p,Po.mallocFloat32=Po.mallocFloat=d,Po.mallocFloat64=Po.mallocDouble=m,Po.mallocUint8Clamped=v,Po.mallocDataView=g,Po.mallocBuffer=y,Po.clearCache=function(){for(var e=0;e<32;++e)r.UINT8[e].length=0,r.UINT16[e].length=0,r.UINT32[e].length=0,r.INT8[e].length=0,r.INT16[e].length=0,r.INT32[e].length=0,r.FLOAT[e].length=0,r.DOUBLE[e].length=0,r.UINT8C[e].length=0,i[e].length=0,o[e].length=0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t({}).Buffer);var Mo={};!function(){"use strict";if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=m);var e=!1;if("function"==typeof WeakMap){var t=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var n=new t,r=Object.freeze({});if(n.set(r,1),1===n.get(r))return void(Mo=WeakMap);e=!0}}Object.prototype.hasOwnProperty;var i=Object.getOwnPropertyNames,o=Object.defineProperty,a=Object.isExtensible,s="weakmap:",u=s+"ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var f=new ArrayBuffer(25),l=new Uint8Array(f);crypto.getRandomValues(l),u=s+"rand:"+Array.prototype.map.call(l,function(e){return(e%36).toString(36)}).join("")+"___"}if(o(Object,"getOwnPropertyNames",{value:function(e){return i(e).filter(v)}}),"getPropertyNames"in Object){var c=Object.getPropertyNames;o(Object,"getPropertyNames",{value:function(e){return c(e).filter(v)}})}!function(){var e=Object.freeze;o(Object,"freeze",{value:function(t){return g(t),e(t)}});var t=Object.seal;o(Object,"seal",{value:function(e){return g(e),t(e)}});var n=Object.preventExtensions;o(Object,"preventExtensions",{value:function(e){return g(e),n(e)}})}();var h=!1,p=0,d=function e(){this instanceof e||b();var t=[],n=[],r=p++;return Object.create(e.prototype,{get___:{value:y(function(e,i){var o,a=g(e);return a?r in a?a[r]:i:(o=t.indexOf(e))>=0?n[o]:i})},has___:{value:y(function(e){var n=g(e);return n?r in n:t.indexOf(e)>=0})},set___:{value:y(function(e,i){var o,a=g(e);return a?a[r]=i:(o=t.indexOf(e))>=0?n[o]=i:(o=t.length,n[o]=i,t[o]=e),this})},delete___:{value:y(function(e){var i,o,a=g(e);return a?r in a&&delete a[r]:!((i=t.indexOf(e))<0||(o=t.length-1,t[i]=void 0,n[i]=n[o],t[i]=t[o],t.length=o,n.length=o,0))})}})};d.prototype=Object.create(Object.prototype,{get:{value:function(e,t){return this.get___(e,t)},writable:!0,configurable:!0},has:{value:function(e){return this.has___(e)},writable:!0,configurable:!0},set:{value:function(e,t){return this.set___(e,t)},writable:!0,configurable:!0},delete:{value:function(e){return this.delete___(e)},writable:!0,configurable:!0}}),"function"==typeof t?function(){function n(){this instanceof d||b();var n,r=new t,i=void 0,o=!1;return n=e?function(e,t){return r.set(e,t),r.has(e)||(i||(i=new d),i.set(e,t)),this}:function(e,t){if(o)try{r.set(e,t)}catch($o){i||(i=new d),i.set___(e,t)}else r.set(e,t);return this},Object.create(d.prototype,{get___:{value:y(function(e,t){return i?r.has(e)?r.get(e):i.get___(e,t):r.get(e,t)})},has___:{value:y(function(e){return r.has(e)||!!i&&i.has___(e)})},set___:{value:y(n)},delete___:{value:y(function(e){var t=!!r.delete(e);return i&&i.delete___(e)||t})},permitHostObjects___:{value:y(function(e){if(e!==m)throw new Error("bogus call to permitHostObjects___");o=!0})}})}e&&"undefined"!=typeof Proxy&&(Proxy=void 0),n.prototype=d.prototype,Mo=n,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),Mo=d)}function m(e){e.permitHostObjects___&&e.permitHostObjects___(m)}function v(e){return!(e.substr(0,s.length)==s&&"___"===e.substr(e.length-3))}function g(e){if(e!==Object(e))throw new TypeError("Not an object: "+e);var t=e[u];if(t&&t.key===e)return t;if(a(e)){t={key:e};try{return o(e,u,{value:t,writable:!1,enumerable:!1,configurable:!1}),t}catch(n){return}}}function y(e){return e.prototype=null,Object.freeze(e)}function b(){h||"undefined"==typeof console||(h=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}();var Ao={},So=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(Yo){i=!0,o=Yo}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Eo(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var To=fo,Oo=!0,jo=new Mo;function Co(e){var t=this;return this instanceof Co?e instanceof Co?(No(this,"textures",e),No(this,"textures2",e),No(this,"lastY",e),No(this,"minY",e),No(this,"maxY",e),No(this,"total",e),No(this,"shader",e),No(this,"gl",e),No(this,"regl",e),No(this,"canvas",e),No(this,"blankTexture",e),No(this,"NaNTexture",e),No(this,"pushQueue",e),No(this,"textureLength",e),No(this,"textureShape",e),Object.defineProperty(this,"dirty",{get:function(){return t._dirty||e.dirty||e.drawOptions.total!==t.drawOptions.total},set:function(e){return t._dirty=e}}),this.dirty=!0,this.drawOptions={},this.isClone=!0,this.update({color:e.color,thickness:e.thickness}),this):(this.textures=[],this.textures2=[],this.lastY,this.minY=1/0,this.maxY=-1/0,this.total=0,this.drawOptions={},this.shader=this.createShader(e),this.gl=this.shader.gl,this.regl=this.shader.regl,this.canvas=this.gl.canvas,this.blankTexture=this.shader.blankTexture,this.NaNTexture=this.shader.NaNTexture,this.pushQueue=[],this.dirty=!0,void(qi(e)&&this.update(e))):new Co(e)}function Lo(e){if("number"==typeof e)return e;if(!Oo)return parseFloat(e);var t=ao(e);return t[0]*ho(t[1])}function No(e,t,n){Object.defineProperty(e,t,{get:function(){return n[t]},set:function(e){return n[t]=e}})}Co.prototype.createShader=function(e){var t=void 0,n=void 0,r=void 0;if(e||(e={}),r=jo.get(e))return r;if(function(e){return"function"==typeof e&&e._gl&&e.prop&&e.texture&&e.buffer}(e)&&(e={regl:e}),!qi(e)||e.canvas||e.gl||e.regl){if(n=Qi(e),r=jo.get(n))return r;t=so({gl:n,extensions:"OES_texture_float"})}else if(n=(t=so({extensions:"OES_texture_float"}))._gl,r=jo.get(n))return r;var i=t.buffer({usage:"static",type:"int16",data:function(e){var t=Array();t.push(-2,1,1,-2,-1,1);for(var n=-1;n<e;n++)t.push(n,1,-1,n,-1,-1),t.push(n,1,1,n,-1,1);return t}(this.maxSampleCount)}),o={primitive:function(e,t){return t.primitive||"triangle strip"},offset:t.prop("offset"),count:t.prop("count"),frag:Xi(["// fragment shader with fading based on distance from average\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform vec4 viewport;\nuniform float thickness;\n\nvarying vec4 fragColor;\nvarying float normThickness;\nvarying vec3 statsLeft, statsRight, statsPrevRight, statsNextLeft;\n\nconst float TAU = 6.283185307179586;\n\nfloat pdf (float x, float mean, float variance) {\n\tif (variance == 0.) return x == mean ? 9999. : 0.;\n\telse return exp(-.5 * pow(x - mean, 2.) / variance) / sqrt(TAU * variance);\n}\n\nfloat fade(float y, vec3 stats) {\n\tfloat avg = stats.x;\n\tfloat sdev = stats.y;\n\tfloat nan = stats.z;\n\tif (nan == -1.) return 0.;\n\tfloat dist = abs(y - avg);\n\tfloat pdfCoef = pdf(0., 0., sdev * sdev );\n\t// pdfCoef makes sure pdf is normalized - has 1. value at the max\n\tdist = pdf(dist, 0., sdev * sdev  ) / pdfCoef;\n\treturn dist;\n}\n\nvoid main() {\n\tfloat halfThickness = normThickness * .5;\n\n\tfloat x = (gl_FragCoord.x - viewport.x) / viewport.z;\n\tfloat y = (gl_FragCoord.y - viewport.y) / viewport.w;\n\n\tgl_FragColor = fragColor;\n\n\tfloat avgRight = statsRight.x;\n\tfloat avgLeft = statsLeft.x;\n\tfloat avgNextLeft = statsNextLeft.x;\n\tfloat avgPrevRight = statsPrevRight.x;\n\tfloat sdevRight = statsRight.y;\n\tfloat sdevLeft = statsLeft.y;\n\tfloat sdevNextLeft = statsNextLeft.y;\n\tfloat sdevPrevRight = statsPrevRight.y;\n\n\tif (y > avgRight + halfThickness) {\n\t\tif (avgRight > avgLeft) {\n\t\t\t// local max\n\t\t\tif (avgRight > avgNextLeft) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsRight);\n\t\t\t}\n\t\t\t// sdev can make y go over the\n\t\t\telse if (sdevRight > 0. && y > avgNextLeft + halfThickness) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsNextLeft);\n\t\t\t}\n\t\t}\n\t}\n\tif (y > avgLeft + halfThickness) {\n\t\t// local max\n\t\tif (avgLeft > avgRight) {\n\t\t\t// local max\n\t\t\tif (avgLeft > avgPrevRight) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsLeft);\n\t\t\t}\n\t\t\t// sdev can make y go over the\n\t\t\telse if (sdevLeft > 0. && y > avgPrevRight + halfThickness) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsPrevRight);\n\t\t\t}\n\t\t}\n\t}\n\tif (y < avgRight - halfThickness) {\n\t\tif (avgRight < avgLeft) {\n\t\t\t// local min\n\t\t\tif (avgRight < avgNextLeft) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsRight);\n\t\t\t}\n\t\t\t// sdev can make y go over the\n\t\t\telse if (sdevRight > 0. && y < avgNextLeft - halfThickness) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsNextLeft);\n\t\t\t}\n\t\t}\n\t}\n\tif (y < avgLeft - halfThickness) {\n\t\t// local min\n\t\tif (avgLeft < avgRight) {\n\t\t\t// local min\n\t\t\tif (avgLeft < avgPrevRight) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsLeft);\n\t\t\t}\n\t\t\t// sdev can make y go over the\n\t\t\telse if (sdevLeft > 0. && y < avgPrevRight - halfThickness) {\n\t\t\t\tgl_FragColor.a *= fade(y, statsPrevRight);\n\t\t\t}\n\t\t}\n\t}\n\n\t// if (dist == 0.) { discard; return; }\n\n\t// gl_FragColor.a *= dist;\n}\n"]),uniforms:{"samples.id":t.prop("textureId"),samplesData:t.prop("samples"),"samples.prev":t.prop("prevSamples"),"samples.next":t.prop("nextSamples"),"samples.shape":t.prop("dataShape"),"samples.length":t.prop("dataLength"),"samples.sum":function(e,t){return To.float(t.samples.sum)},"samples.sum2":function(e,t){return To.float(t.samples.sum2)},"samples.prevSum":function(e,t){return To.float(t.prevSamples.sum)},"samples.prevSum2":function(e,t){return To.float(t.prevSamples.sum2)},"fractions.id":t.prop("textureId"),fractionsData:t.prop("fractions"),"fractions.prev":t.prop("prevFractions"),"fractions.next":t.prop("nextFractions"),"fractions.shape":t.prop("dataShape"),"fractions.length":t.prop("dataLength"),"fractions.sum":function(e,t){return To.fract(t.samples.sum)},"fractions.sum2":function(e,t){return To.fract(t.samples.sum2)},"fractions.prevSum":function(e,t){return To.fract(t.prevSamples.sum)},"fractions.prevSum2":function(e,t){return To.fract(t.prevSamples.sum2)},passNum:t.prop("passNum"),passId:t.prop("passId"),passOffset:t.prop("passOffset"),total:t.prop("total"),range:t.prop("range"),pxStep:t.prop("pxStep"),posShift:t.prop("posShift"),sampleStep:t.prop("sampleStep"),translate:t.prop("translate"),amplitude:t.prop("amplitude"),viewport:t.prop("viewport"),opacity:t.prop("opacity"),color:t.prop("color"),thickness:function(e,t){return t.thickness*e.pixelRatio}},attributes:{id:{buffer:i,stride:6,offset:0},sign:{buffer:i,stride:6,offset:2},side:{buffer:i,stride:6,offset:4}},blend:{enable:!0,color:[0,0,0,0],equation:{rgb:"add",alpha:"add"},func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:"one minus dst alpha",dstAlpha:"one"}},depth:{enable:!1},scissor:{enable:!0,box:function(e,t){var n=t.clip,r=t.viewport;return n?{x:n[0],y:n[1],width:n[2],height:n[3]}:{x:r[0],y:r[1],width:r[2],height:r[3]}}},viewport:function(e,t){var n=t.viewport;return{x:n[0],y:n[1],width:n[2],height:n[3]}},stencil:!1},a=t(to({vert:Xi(["// output range-average samples line with sdev weighting\n\nprecision highp float;\n#define GLSLIFY 1\n\n// linear interpolation\nvec4 lerp(vec4 a, vec4 b, float t) {\n\treturn t * b + (1. - t) * a;\n}\nvec2 lerp(vec2 a, vec2 b, float t) {\n\treturn t * b + (1. - t) * a;\n}\n\n// bring sample value to 0..1 from amplitude range\nfloat reamp(float v, vec2 amp) {\n\treturn (v - amp.x) / (amp.y - amp.x);\n}\n\nstruct Samples {\n\tfloat id;\n\t// sampler2D data;\n\tsampler2D prev;\n\tsampler2D next;\n\tvec2 shape;\n\tfloat length;\n\tfloat sum, prevSum, sum2, prevSum2;\n};\n\nattribute float id, sign, side;\n\nuniform Samples samples, fractions;\nuniform sampler2D samplesData, fractionsData;\nuniform float opacity, thickness, pxStep, sampleStep, total, translate, passNum, passId;\nuniform vec4 viewport, color;\nuniform vec2 amplitude;\n\nvarying vec4 fragColor;\nvarying vec3 statsLeft, statsRight, statsPrevRight, statsNextLeft;\nvarying float normThickness;\n\nconst float FLT_EPSILON = 1.19209290e-7;\n\n// returns sample picked from the texture\nvec4 picki (Samples samples, sampler2D data, float offset) {\n\t// translate is here in order to remove float32 error (at the latest stage)\n\toffset += translate;\n\n\tvec2 uv = vec2(\n\t\tfloor(mod(offset, samples.shape.x)) + .5,\n\t\tfloor(offset / samples.shape.x) + .5\n\t) / samples.shape;\n\n\tvec4 sample;\n\n\t// prev texture\n\tif (uv.y < 0.) {\n\t\tuv.y += 1.;\n\t\tsample = texture2D(samples.prev, uv);\n\t\tsample.y -= samples.prevSum;\n\t\tsample.z -= samples.prevSum2;\n\t}\n\t// next texture\n\telse if (uv.y > 1.) {\n\t\tuv.y -= 1.;\n\t\tsample = texture2D(samples.next, uv);\n\t\tsample.y += samples.sum;\n\t\tsample.z += samples.sum2;\n\t}\n\t// curr texture\n\telse {\n\t\tsample = texture2D(data, uv);\n\t}\n\n\treturn sample;\n}\n\n// returns {avg, sdev, isNaN}\nvec3 stats (float offset) {\n\tfloat sampleStep = sampleStep;\n\n\tfloat offset0 = offset - sampleStep * .5;\n\tfloat offset1 = offset + sampleStep * .5;\n\tfloat offset0l = floor(offset0);\n\tfloat offset1l = floor(offset1);\n\tfloat offset0r = ceil(offset0);\n\tfloat offset1r = ceil(offset1);\n\n\tvec4 sample = picki(samples, samplesData, offset);\n\t// if (sample.w == -1.) return vec3(0,0,-1);\n\n\t// head picks half the first sample\n\tvec4 sample0l = picki(samples, samplesData, offset0l);\n\tvec4 sample1l = picki(samples, samplesData, offset1l);\n\tvec4 sample0r = picki(samples, samplesData, offset0r);\n\tvec4 sample1r = picki(samples, samplesData, offset1r);\n\n\tvec4 sample0lf = picki(fractions, fractionsData, offset0l);\n\tvec4 sample1lf = picki(fractions, fractionsData, offset1l);\n\tvec4 sample0rf = picki(fractions, fractionsData, offset0r);\n\tvec4 sample1rf = picki(fractions, fractionsData, offset1r);\n\n\tfloat t0 = 0., t1 = 0.;\n\n\t// partial sample steps require precision\n\t// WARN: we removed lerp in order to \u2191 precision\n\t// if (mod(sampleStep, 1.) != 0. && sample0l.w != -1. && sample1r.w != -1.) {\n\t// \tt0 = offset0 - offset0l, t1 = offset1 - offset1l;\n\t// }\n\n\tif (sample0l.w == -1.) {\n\t\t// return vec3(0,0,-1);\n\t\t// sample0l.y = 0.;\n\t}\n\n\tfloat n = (offset1l - offset0l);\n\n\tfloat avg = (\n\t\t+ sample1l.y\n\t\t- sample0l.y\n\t\t+ sample1lf.y\n\t\t- sample0lf.y\n\t\t// + t1 * (sample1r.y - sample1l.y)\n\t\t// - t0 * (sample0r.y - sample0l.y)\n\t\t// + t1 * (sample1rf.y - sample1lf.y)\n\t\t// - t0 * (sample0rf.y - sample0lf.y)\n\t);\n\tavg /= n;\n\n\tfloat mx2 = (\n\t\t+ sample1l.z\n\t\t- sample0l.z\n\t\t+ sample1lf.z\n\t\t- sample0lf.z\n\t\t// + t1 * (sample1r.z - sample1l.z)\n\t\t// - t0 * (sample0r.z - sample0l.z)\n\t\t// + t1 * (sample1rf.z - sample1lf.z)\n\t\t// - t0 * (sample0rf.z - sample0lf.z)\n\t);\n\tmx2 /= n;\n\n\t// \u03c3(x)\xb2 = M(x\xb2) - M(x)\xb2\n\tfloat m2 = avg * avg;\n\tfloat variance = abs(mx2 - m2);\n\n\t// get float32 tolerance for the power of mx2/m2\n\t// float tol = FLT_EPSILON * pow(2., ceil(9. + log2(max(mx2, m2))));\n\n\t// float sdev = variance <= tol ? 0. : sqrt(variance);\n\tfloat sdev = sqrt(variance);\n\n\treturn vec3(avg, sdev, min(sample0r.w, sample1l.w));\n}\n\nvoid main() {\n\tgl_PointSize = 3.5;\n\tif (color.a == 0.) return;\n\n\tnormThickness = thickness / viewport.w;\n\n\tfragColor = color / 255.;\n\tfragColor.a *= opacity;\n\n\tfloat offset = id * sampleStep;\n\n\t// compensate snapping for low scale levels\n\tfloat posShift = 0.;\n\n\tvec3 statsCurr = stats(offset);\n\n\t// ignore NaN amplitudes\n\tif (statsCurr.z == -1.) return;\n\n\tvec3 statsPrev = stats(offset - sampleStep);\n\tvec3 statsPrev2 = stats(offset - 2. * sampleStep);\n\tvec3 statsNext = stats(offset + sampleStep);\n\tvec3 statsNext2 = stats(offset + 2. * sampleStep);\n\n\tfloat avgCurr = statsCurr.x;\n\tfloat avgPrev = statsPrev.x;\n\tfloat avgPrev2 = statsPrev2.z != -1. ? statsPrev2.x : avgPrev;\n\tfloat avgNext = statsNext.x;\n\tfloat avgNext2 = statsNext2.z != -1. ? statsNext2.x : avgNext;\n\n\tfloat ampRange = abs(\n\t\t+ amplitude.y - amplitude.x\n\t);\n\tfloat sdevCurr = statsCurr.y / ampRange;\n\tfloat sdevPrev = statsPrev.y / ampRange;\n\tfloat sdevPrev2 = statsPrev2.y / ampRange;\n\tfloat sdevNext = statsNext.y / ampRange;\n\tfloat sdevNext2 = statsNext2.y / ampRange;\n\n\tfloat sdev = sdevCurr;\n\n\tavgCurr = reamp(avgCurr, amplitude);\n\tavgNext = reamp(avgNext, amplitude);\n\tavgNext2 = reamp(avgNext2, amplitude);\n\tavgPrev = reamp(avgPrev, amplitude);\n\tavgPrev2 = reamp(avgPrev2, amplitude);\n\n\t// compensate for sampling rounding\n\tvec2 position = vec2(\n\t\t(pxStep * (id + .5)) / viewport.z,\n\t\tavgCurr\n\t);\n\n\tvec2 normalLeft = normalize(vec2(\n\t\t-(avgCurr - avgPrev), pxStep / viewport.w\n\t));\n\tvec2 normalRight = normalize(vec2(\n\t\t-(avgNext - avgCurr), pxStep / viewport.w\n\t));\n\n\tvec2 bisec = normalize(normalLeft + normalRight);\n\tvec2 vert = vec2(0, 1);\n\tfloat bisecLen = abs(1. / dot(normalLeft, bisec));\n\tfloat vertRightLen = abs(1. / dot(normalRight, vert));\n\tfloat vertLeftLen = abs(1. / dot(normalLeft, vert));\n\tfloat maxVertLen = max(vertLeftLen, vertRightLen);\n\tfloat minVertLen = min(vertLeftLen, vertRightLen);\n\n\t// 2\u03c3 covers 68% of a line. 4\u03c3 covers 95% of line\n\tfloat vertSdev = 2. * sdev * viewport.w / thickness;\n\n\tvec2 join;\n\n\tif (statsPrev.z == -1.) {\n\t\tjoin = normalRight;\n\t}\n\telse if (statsNext.z == -1.) {\n\t\tjoin = normalLeft;\n\t}\n\t// sdev less than projected to vertical shows simple line\n\t// FIXME: sdev should be compensated by curve bend\n\telse if (vertSdev < maxVertLen) {\n\t\t// sdev more than normal but less than vertical threshold\n\t\t// rotates join towards vertical\n\t\tif (vertSdev > minVertLen) {\n\t\t\tfloat t = (vertSdev - minVertLen) / (maxVertLen - minVertLen);\n\t\t\tjoin = lerp(bisec * bisecLen, vert * maxVertLen, t);\n\t\t}\n\t\telse {\n\t\t\tjoin = bisec * bisecLen;\n\t\t}\n\t}\n\t// sdev more than projected to vertical modifies only y coord\n\telse {\n\t\tjoin = vert * vertSdev;\n\t}\n\n\t// figure out segment varyings\n\tstatsCurr = vec3(avgCurr, sdevCurr, statsCurr.z);\n\tstatsPrev = vec3(avgPrev, sdevPrev, statsPrev.z);\n\tstatsNext = vec3(avgNext, sdevNext, statsNext.z);\n\tstatsNext2 = vec3(avgNext2, sdevNext2, statsNext2.z);\n\tstatsPrev2 = vec3(avgPrev2, sdevPrev2, statsPrev2.z);\n\tstatsRight = side < 0. ? statsCurr : statsNext;\n\tstatsLeft = side < 0. ? statsPrev : statsCurr;\n\tstatsPrevRight = side < 0. ? statsPrev2 : statsPrev;\n\tstatsNextLeft = side < 0. ? statsNext : statsNext2;\n\n\tposition += sign * join * .5 * thickness / viewport.zw;\n\n\t// shift position by the clip offset\n\tposition.x += passId * pxStep * samples.length / sampleStep / viewport.z;\n\n\tgl_Position = vec4(position * 2. - 1., 0, 1);\n}\n"])},o)),s=t(to({vert:Xi(["// direct sample output, connected by line, to the contrary to range\n\nprecision highp float;\n#define GLSLIFY 1\n\n// bring sample value to 0..1 from amplitude range\nfloat reamp(float v, vec2 amp) {\n\treturn (v - amp.x) / (amp.y - amp.x);\n}\n\nstruct Samples {\n\tfloat id;\n\t// sampler2D data;\n\tsampler2D prev;\n\tsampler2D next;\n\tvec2 shape;\n\tfloat length;\n\tfloat sum, prevSum, sum2, prevSum2;\n};\n\nattribute float id, sign, side;\n\nuniform Samples samples;\nuniform sampler2D samplesData;\nuniform float opacity, thickness, pxStep, sampleStep, total, translate, posShift;\nuniform vec4 viewport, color;\nuniform vec2 amplitude, range;\nuniform float passNum, passId, passOffset;\n\nvarying vec4 fragColor;\nvarying vec3 statsLeft, statsRight, statsPrevRight, statsNextLeft;\nvarying float normThickness;\n\nbool isNaN (vec4 sample) {\n\treturn sample.w == -1.;\n}\n\nvec4 stats (float offset) {\n\t// translate is here in order to remove float32 error (at the latest stage)\n\toffset += translate;\n\n\tvec2 uv = vec2(\n\t\tfloor(mod(offset, samples.shape.x)) + .5,\n\t\tfloor((offset) / samples.shape.x) + .5\n\t) / samples.shape;\n\n\tvec4 sample;\n\n\t// prev texture\n\tif (uv.y < 0.) {\n\t\tuv.y += 1.;\n\t\tsample = texture2D(samples.prev, uv);\n\t}\n\t// next texture\n\telse if (uv.y > 1.) {\n\t\tuv.y -= 1.;\n\t\tsample = texture2D(samples.next, uv);\n\t}\n\t// curr texture\n\telse {\n\t\tsample = texture2D(samplesData, uv);\n\t}\n\n\treturn sample;\n}\n\nvoid main () {\n\tgl_PointSize = 4.5;\n\tif (color.a == 0.) return;\n\n\tfragColor = color / 255.;\n\tfragColor.a *= opacity;\n\n\tnormThickness = thickness / viewport.w;\n\n\tfloat offset = id * sampleStep;\n\n\t// calc average of curr..next sampling points\n\tvec4 sampleCurr = stats(offset);\n\tif (isNaN(sampleCurr)) return;\n\n\tvec4 sampleNext = stats(offset + sampleStep);\n\tvec4 sampleNext2 = stats(offset + 2. * sampleStep);\n\tvec4 samplePrev = stats(offset - sampleStep);\n\tvec4 samplePrev2 = stats(offset - 2. * sampleStep);\n\n\tbool isStart = isNaN(samplePrev);\n\tbool isEnd = isNaN(sampleNext);\n\n\tfloat avgCurr = reamp(sampleCurr.x, amplitude);\n\tfloat avgNext = reamp(isEnd ? sampleCurr.x : sampleNext.x, amplitude);\n\tfloat avgNext2 = reamp(sampleNext2.x, amplitude);\n\tfloat avgPrev = reamp(isStart ? sampleCurr.x : samplePrev.x, amplitude);\n\tfloat avgPrev2 = reamp(samplePrev2.x, amplitude);\n\n\t// fake sdev 2\u03c3 = thickness\n\t// sdev = normThickness / 2.;\n\tfloat sdev = 0.;\n\n\tvec2 position = vec2(\n\t\tpxStep * (id + .5) / (viewport.z),\n\t\tavgCurr\n\t);\n\n\tfloat x = (pxStep) / viewport.z;\n\tvec2 normalLeft = normalize(vec2(\n\t\t-(avgCurr - avgPrev), x\n\t) / viewport.zw);\n\tvec2 normalRight = normalize(vec2(\n\t\t-(avgNext - avgCurr), x\n\t) / viewport.zw);\n\n\tvec2 join;\n\tif (isStart || isStart) {\n\t\tjoin = normalRight;\n\t}\n\telse if (isEnd || isEnd) {\n\t\tjoin = normalLeft;\n\t}\n\telse {\n\t\tvec2 bisec = normalLeft * .5 + normalRight * .5;\n\t\tfloat bisecLen = abs(1. / dot(normalLeft, bisec));\n\t\tjoin = bisec * bisecLen;\n\t}\n\n\t// FIXME: limit join by prev vertical\n\t// float maxJoinX = min(abs(join.x * thickness), 40.) / thickness;\n\t// join.x *= maxJoinX / join.x;\n\n\t// figure out closest to current min/max\n\tvec3 statsCurr = vec3(avgCurr, 0, sampleCurr.z);\n\tvec3 statsPrev = vec3(avgPrev, 0, samplePrev.z);\n\tvec3 statsNext = vec3(avgNext, 0, sampleNext.z);\n\tvec3 statsNext2 = vec3(avgNext2, 0, sampleNext2.z);\n\tvec3 statsPrev2 = vec3(avgPrev2, 0, samplePrev2.z);\n\n\tstatsRight = side < 0. ? statsCurr : statsNext;\n\tstatsLeft = side < 0. ? statsPrev : statsCurr;\n\tstatsPrevRight = side < 0. ? statsPrev2 : statsPrev;\n\tstatsNextLeft = side < 0. ? statsNext : statsNext2;\n\n\tposition += sign * join * .5 * thickness / viewport.zw;\n\n\t// compensate snapped sampleStep to enable smooth zoom\n\tposition.x += posShift / viewport.z;\n\n\t// shift position by the clip offset\n\t// FIXME: move to uniform\n\tposition.x += passId * pxStep * samples.length / sampleStep / viewport.z;\n\n\tgl_Position = vec4(position * 2. - 1., 0, 1);\n}\n"])},o)),u=t.texture({width:1,height:1,channels:this.textureChannels,type:"float"});u.sum=0,u.sum2=0;var f=t.texture({width:1,height:1,channels:this.textureChannels,type:"float",data:new Float32Array([NaN,0,0,-1])});return f.sum=0,f.sum2=0,r={drawRanges:a,drawLine:s,regl:t,idBuffer:i,NaNTexture:f,blankTexture:u,gl:n},jo.set(n,r),r},Object.defineProperties(Co.prototype,{viewport:{get:function(){return this.dirty?(e=this._viewport?[this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height]:[0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight],this.flip||(e[1]=this.gl.drawingBufferHeight-e[1]-e[3]),e):this.drawOptions.viewport;var e},set:function(e){this._viewport=e?function(e){var t;return arguments.length>1&&(e=arguments),"string"==typeof e?e=e.split(/\s/).map(parseFloat):"number"==typeof e&&(e=[e]),e.length&&"number"==typeof e[0]?t=1===e.length?{width:e[0],height:e[0],x:0,y:0}:2===e.length?{width:e[0],height:e[1],x:0,y:0}:{x:e[0],y:e[1],width:e[2]-e[0]||0,height:e[3]-e[1]||0}:e&&(t={x:(e=Hi(e,{left:"x l left Left",top:"y t top Top",width:"w width W Width",height:"h height W Width",bottom:"b bottom Bottom",right:"r right Right"})).left||0,y:e.top||0},null==e.width?e.right?t.width=e.right-t.x:t.width=0:t.width=e.width,null==e.height?e.bottom?t.height=e.bottom-t.y:t.height=0:t.height=e.height),t}(e):e}},color:{get:function(){return this.dirty?this._color||[0,0,0,255]:this.drawOptions.color},set:function(e){if(e||(e="transparent"),"string"==typeof e)this._color=Gi(e,"uint8");else if("number"==typeof e[0]){var t=Math.max(e.length,4);this._color&&Po.freeUint8(this._color),this._color=Po.mallocUint8(t);for(var n=(e.subarray||e.slice).bind(e),r=0;r<t;r+=4)this._color.set(Gi(n(r,r+4),"uint8"),r)}else{var i=e.length;this._color&&Po.freeUint8(this._color),this._color=Po.mallocUint8(4*i);for(var o=0;o<i;o++)this._color.set(Gi(e[o],"uint8"),4*o)}}},amplitude:{get:function(){return this.dirty?this._amplitude||[this.minY,this.maxY]:this.drawOptions.amplitude},set:function(e){"number"==typeof e?this._amplitude=[-e,+e]:e.length?this._amplitude=[e[0],e[1]]:this._amplitude=e}},range:{get:function(){return this.dirty?null!=this._range?"number"==typeof this._range?[(e=this._range,t=this.total,null==e?0:Ki(e)?t:e<=-t?0:e<0?t+e%t:Math.min(t,e)),this.total]:this._range:[0,this.total]:this.drawOptions.range;var e,t},set:function(e){if(!e)return this._range=null;e.length?4===e.length?(this._range=[e[0],e[2]],this.amplitude=[e[1],e[3]]):this._range=[e[0],e[1]]:"number"==typeof e&&(this._range=e),this.dirty=!0}}}),Co.prototype.update=function(e){if(!e)return this;if(null!=e.length)e={data:e};else if("object"!==(void 0===e?"undefined":ko(e)))throw Error("Argument must be a data or valid object");if(this.dirty=!0,void 0!==(e=Hi(e,{data:"data value values sample samples",range:"range dataRange dataBox dataBounds dataLimits",amplitude:"amp amplitude amplitudes ampRange bounds limits maxAmplitude maxAmp",thickness:"thickness width linewidth lineWidth line-width",pxStep:"step pxStep",color:"color colour colors colours fill fillColor fill-color",line:"line line-style lineStyle linestyle",viewport:"clip vp viewport viewBox viewbox viewPort area",opacity:"opacity alpha transparency visible visibility opaque",flip:"flip iviewport invertViewport inverseViewport",mode:"mode",shape:"shape textureShape",sampleStep:"sampleStep"})).mode&&(this.mode=e.mode),void 0!==e.shape){if(this.textures.length)throw Error("Cannot set texture shape because textures are initialized already");this.textureShape=e.shape,this.textureLength=this.textureShape[0]*this.textureShape[1]}if(e.line)if("string"==typeof e.line){var t=e.line.split(/\s+/);/0-9/.test(t[0][0])?(e.thickness||(e.thickness=t[0]),!e.color&&t[1]&&(e.color=t[1])):(!e.thickness&&t[1]&&(e.thickness=t[1]),e.color||(e.color=t[0]))}else e.color=e.line;return void 0!==e.thickness&&(this.thickness=Lo(e.thickness)),void 0!==e.pxStep&&(this.pxStep=Lo(e.pxStep)),void 0!==e.opacity&&(this.opacity=parseFloat(e.opacity)),void 0!==e.viewport&&(this.viewport=e.viewport),e.flip&&(this.flip=!!e.flip),void 0!==e.range&&(this.range=e.range),void 0!==e.color&&(this.color=e.color),void 0!==e.amplitude&&(this.amplitude=e.amplitude),e.data&&(this.total=0,this.lastY=null,this.minY=1/0,this.maxY=-1/0,this.push(e.data)),e.push&&this.push(e.push),e.sampleStep&&(this.sampleStep=e.sampleStep),this},Co.prototype.calc=function(){if(!this.dirty)return this.drawOptions;this.flush();var e=this.total,t=this.opacity,n=this.amplitude,r=this.viewport,i=this.range,o=this.color,a=this.thickness,s=Math.abs(i[1]-i[0])||1,u=Math.max(r[2]/s,this.pxStep||.5),f=u*s/r[2];f=To.float(f),f=Math.max(Math.round(f),1),this.sampleStep&&(f=this.sampleStep);var l=(u=r[2]*f/s)/f,c=0;l>1&&(c=(Math.round(i[0])-i[0])*l);for(var h=this.mode,p=Math.ceil(Math.floor(1e3*s)/1e3/this.textureLength),d=Array(p),m=Math.round(i[0]/this.textureLength),v=Math.min(this.textureLength/f*u,r[2]),g=0;g<p;g++){var y=m+g;if(!(y<-1||y>this.textures.length)){var b=Math.round(g*v),w=Math.round((g+1)*v),x=[b+r[0],r[1],w-b,r[3]],_=Math.round(i[0]/this.textureLength)*this.textureLength,P=Math.round(i[0])-_,M=Math.min(Math.ceil(v/u),Math.ceil(this.textureLength/f));d[g]={passId:g,textureId:y,clip:x,passOffset:_,translate:P,count:Math.min(4+4*M*3+4,this.maxSampleCount),offset:0,samples:this.textures[y]||this.NaNTexture,fractions:this.textures2[y]||this.blankTexture,prevSamples:this.textures[y-1]||this.NaNTexture,nextSamples:this.textures[y+1]||this.NaNTexture,prevFractions:this.textures2[y-1]||this.blankTexture,nextFractions:this.textures2[y+1]||this.blankTexture,shift:0}}}return this.drawOptions={thickness:a,color:o,pxStep:u,pxPerSample:l,viewport:r,sampleStep:f,span:s,total:e,opacity:t,amplitude:n,range:i,mode:h,passes:d,passNum:p,posShift:c,dataShape:this.textureShape,dataLength:this.textureLength},this.dirty=!1,this.drawOptions},Co.prototype.render=function(){var e=this;if(this.flush(),this.total<2)return this;var t=this.calc();return t.passes.forEach(function(n){to(t,n),t.color,t.pxPerSample<=1||"range"===t.mode&&"line"!=t.mode?e.shader.drawRanges.call(e,t):e.shader.drawLine.call(e,t)}),this},Co.prototype.push=function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(!n||!n.length)return this;for(var i=0;i<n.length;i++){var o;if(n[i].length)if(n[i].length>1024)for(var a=0;a<n[i].length;a++)this.pushQueue.push(n[i][a]);else(o=this.pushQueue).push.apply(o,Eo(n[i]));else this.pushQueue.push(n[i])}return this.cancelFlush&&(this.cancelFlush(),this.cancelFlush=null),this.dirty=!0,this.cancelFlush=function e(t,n){var r;return n=n||ro,oo?(r=window.requestIdleCallback(function(r){if(r.timeRemaining()<=1&&!r.didTimeout)return e(t,n);t(r)},n),window.cancelIdleCallback.bind(window,r)):io?(r=setTimeout(t,0),clearTimeout.bind(window,r)):void 0}(function(){e.cancelFlush=null,e.flush()}),this},Co.prototype.flush=function(){if(this.cancelFlush&&(this.cancelFlush(),this.cancelFlush=null),this.pushQueue.length){var e=this.pushQueue;this.set(e,this.total),this.pushQueue.length=0}return this},Co.prototype.set=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e||!e.length)return this;if(t+e.length>this.total+this.pushQueue.length&&this.flush(),t>this.total&&this.set(Array(t-this.total),this.total),this.dirty=!0,Array.isArray(e)){for(var n=Po.mallocFloat64(e.length),r=0;r<e.length;r++)null==e[r]||isNaN(e[r])?n[r]=NaN:n[r]=e[r];e=n}for(var i=0;i<e.length;i++)this.minY>e[i]&&(this.minY=e[i]),this.maxY<e[i]&&(this.maxY=e[i]);this.textureShape||(this.textureShape=[512,512],this.textureLength=this.textureShape[0]*this.textureShape[1]);var o=So(this.textureShape,2),a=o[0],s=o[1],u=this.textureLength,f=t%u,l=Math.floor(t/u),c=Math.floor(f/a),h=f%a,p=u-f,d=this.textureChannels,m=this.textures[l],v=this.textures2[l];if(!m){for(var g=Po.mallocFloat64(u*d),y=0;y<g.length;y+=d)g[y+0]=g[y+1]=g[y+2]=0,g[y+3]=-1;m=this.textures[l]=this.regl.texture({width:this.textureShape[0],height:this.textureShape[1],channels:d,type:"float",min:"nearest",mag:"nearest",wrap:["clamp","clamp"],data:To.float(g)}),this.lastY=m.sum=m.sum2=0,v=this.textures2[l]=this.regl.texture({width:this.textureShape[0],height:this.textureShape[1],channels:d,type:"float",min:"nearest",mag:"nearest",wrap:["clamp","clamp"]}),m.data=g}for(var b=Math.min(p,e.length),w=m.data.subarray(f*d,f*d+b*d),x=0,_=b;x<_;x++)isNaN(e[x])?(w[x*d]=NaN,w[x*d+3]=-1):(w[x*d]=this.lastY=e[x],w[x*d+3]=0),m.sum+=this.lastY,m.sum2+=this.lastY*this.lastY,w[x*d+1]=m.sum,w[x*d+2]=m.sum2;this.total-t<b&&(this.total+=b-(this.total-t));var P=0;if(h){if(k(h,c,P=Math.min(a-h,b),1,w.subarray(0,P*d)),h+e.length<=a)return Po.freeFloat64(e),Po.freeFloat64(w),this;if(++c===s)return Po.freeFloat64(w),this.push(e.subarray(P)),Po.freeFloat64(e),this;f+=P}var M=Math.floor((b-P)/a),A=0;M&&(A=M*a,k(0,c,a,M,w.subarray(P*d,(P+A)*d)),c+=M);var S=b-P-A;if(S&&k(0,c,S,1,w.subarray(-S*d)),p<e.length)return this.set(e.subarray(p),this.total),Po.freeFloat64(e),Po.freeFloat64(w),this;function k(e,t,n,r,i){for(var o=Po.mallocFloat32(i.length),a=Po.mallocFloat32(i.length),s=0;s<i.length;s++)o[s]=i[s],a[s]=i[s]-o[s];m.subimage({width:n,height:r,data:o},e,t),v.subimage({width:n,height:r,data:a},e,t),Po.freeFloat32(o),Po.freeFloat32(a)}return this},Co.prototype.pick=function(e){if(!this.storeData)throw Error("Picking is disabled. Enable it via constructor options.");"number"!=typeof e&&(e=Math.max(e.clientX-function(e){if(e.getBoundingClientRect)return e.getBoundingClientRect();var t=0,n=0;do{t+=e.offsetLeft-e.scrollLeft,n+=e.offsetTop-e.scrollTop}while(e=e.offsetParent);return{left:t,top:n}}(this.canvas).left,0));var t=this.calc(),n=t.span,r=t.translater,i=t.translateri,o=t.viewport,a=t.currTexture,s=(t.sampleStep,t.pxPerSample,t.pxStep,t.amplitude),u=this.textures[a];if(!u)return null;var f=Math.floor(n*e/o[2]),l=Math.floor(r+f),c=r-i;if(l<0||l>this.total)return null;var h=this.textureChannels,p=u.data.subarray(l*h,l*h+h)[0];return{average:p,sdev:0,offset:[l,l],x:o[2]*(f-c)/n+this.viewport.x,y:(-p-s[0])/(s[1]-s[0])*this.viewport.height+this.viewport.y}},Co.prototype.clear=function(){if(!this.drawOptions)return this;var e=this.gl,t=this.regl,n=this.viewport,r=n.x,i=n.y,o=n.width,a=n.height;return e.enable(e.SCISSOR_TEST),e.scissor(r,i,o,a),t.clear({color:[0,0,0,0],depth:1}),e.clear(e.COLOR_BUFFRE_BIT|e.DEPTH_BUFFER_BIT),e.disable(e.SCISSOR_TEST),this},Co.prototype.destroy=function(){this.textures.forEach(function(e){e.destroy()}),this.textures2.forEach(function(e){e.destroy()})},Co.prototype.opacity=1,Co.prototype.thickness=1,Co.prototype.mode=null,Co.prototype.flip=!1,Co.prototype.textureShape,Co.prototype.textureLength,Co.prototype.textureChannels=4,Co.prototype.maxSampleCount=16384,Ao=Co;var Do=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Ro=function(e){function t(e,n,r){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.local=n.components[e]={},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Ii),Do(t,[{key:"load",value:function(e){this.waveform=new Ao}},{key:"update",value:function(e){return!1}},{key:"createElement",value:function(e){return this.local.options=e,document.createElement("div")}}]),t}(),Io=/\n[\s]+$/,Fo=/^\n[\s]+/,Bo=/[\s]+$/,zo=/^[\s]+/,Uo=/[\n\s]+/g,qo=["a","abbr","b","bdi","bdo","br","cite","data","dfn","em","i","kbd","mark","q","rp","rt","rtc","ruby","s","amp","small","span","strong","sub","sup","time","u","var","wbr"],Vo=["code","pre","textarea"],Wo=function e(t,n){if(Array.isArray(n))for(var r,i,o=t.nodeName.toLowerCase(),a=!1,s=0,u=n.length;s<u;s++){var f=n[s];if(Array.isArray(f))e(t,f);else{("number"==typeof f||"boolean"==typeof f||"function"==typeof f||f instanceof Date||f instanceof RegExp)&&(f=f.toString());var l=t.childNodes[t.childNodes.length-1];if("string"==typeof f)a=!0,l&&"#text"===l.nodeName?l.nodeValue+=f:(f=document.createTextNode(f),t.appendChild(f),l=f),s===u-1&&(a=!1,-1===qo.indexOf(o)&&-1===Vo.indexOf(o)?""===(r=l.nodeValue.replace(Fo,"").replace(Bo,"").replace(Io,"").replace(Uo," "))?t.removeChild(l):l.nodeValue=r:-1===Vo.indexOf(o)&&(i=0===s?"":" ",r=l.nodeValue.replace(Fo,i).replace(zo," ").replace(Bo,"").replace(Io,"").replace(Uo," "),l.nodeValue=r));else if(f&&f.nodeType){a&&(a=!1,-1===qo.indexOf(o)&&-1===Vo.indexOf(o)?""===(r=l.nodeValue.replace(Fo,"").replace(Io,"").replace(Uo," "))?t.removeChild(l):l.nodeValue=r:-1===Vo.indexOf(o)&&(r=l.nodeValue.replace(zo," ").replace(Fo,"").replace(Io,"").replace(Uo," "),l.nodeValue=r));var c=f.nodeName;c&&(o=c.toLowerCase()),t.appendChild(f)}}}},Go=wt();Go.use(function(e){return e=e||{},t.storeName="choo-devtools",t;function t(t,n,r){var i=new ke;void 0!==Me&&he(t,n,e),n.on("DOMContentLoaded",function(){void 0!==Me&&(Me.choo={},Me.choo.state=t,Me.choo.emit=function(e,t){n.emit(e,t)},Me.choo.on=function(e,t){n.on(e,t)},D(t,n,r,i),ie(t,n,r,i),pe(t,n,r,i),Me.choo.copy=P,r.router&&r.router.router&&(Me.choo.routes=Object.keys(Ae(r.router.router))),Pe(),F())})}}({filter:function(e){return"player:data"!==e}})),Go.use(function(e,t){e.keyboards=[{name:"colemak",keys:"1234567890-=qwfpgjluy;[]arstdhneio'zxcvbkm,./"},{name:"qwerty",keys:"1234567890-=qwertyuiop[]asdfghjkl;'zxcvbnm,./"}],e.keyboard=e.keyboards[0],t.on("keyboard",function(n){e.keyboard=n,t.emit("render")}),document.body.addEventListener("keydown",function(n){var r=e.keyboard.keys.indexOf(n.key);if(-1!==r){var i=e.notes[r];null!=i&&t.emit("player:note",i)}})}),Go.use(function(e,t){e.instruments=Pt,t.on("instrument",function(n){e.instrumentId=n,e.instrument=null,t.emit("render"),Mn.instrument(e.player.audioContext,n,{destination:e.player.merger}).then(function(t){e.instrument=t})})}),Go.use(function(e,t){function n(){e.notes=[1,2,3,4,5,6].reduce(function(t,n){return[].concat(wi(t),wi(ci.Scale.notes(e.scale.note,e.scale.type).map(function(e){return e+n})))},[])}e.scale={note:"C",type:"major"},n(),t.on("scale:note",function(r){e.scale.note=r,n(),t.emit("render")}),t.on("scale:type",function(r){e.scale.type=r,n(),t.emit("render")})}),Go.use(function(e,t){var n=new window.AudioContext,r=n.createChannelMerger(1),i=n.createAnalyser(),o=new Float32Array(2048);window.requestAnimationFrame(function e(){window.requestAnimationFrame(e),i.getFloatTimeDomainData(o),t.emit("player:data",o)}),e.player={audioContext:n,merger:r,analyser:i,data:o},r.connect(i),i.connect(n.destination),t.on("player:note",function(t){null!=e.instrument&&(e.player.lastNote=t,e.instrument.play(t))})}),Go.use(function(e,t){var n=e.player.data;e.waveform={data:n,range:[0,n.length],amplitude:[-.1,.1],color:[0,0,1,1],thickness:"2px"},t.on("player:data",function(t){var n=e.cache(Ro,"waveform"),r=n.waveform;if(e.player.lastNote){var i=ci.Note.freq(e.player.lastNote),o=e.player.audioContext.sampleRate/i,a=t.length/o,s=Math.round(Math.floor(a)*o);e.waveform.range=[t.length-s,t.length]}r.update(e.waveform),r.render(),n.render(e.waveform)})}),Go.use(function(e,t){var n;e.pitch={frequency:null,matches:[],possible:(n=[],[1,2,3,4,5,6].forEach(function(e){ci.Note.names().forEach(function(t){var r=""+t+e;n.push({name:r,frequency:ci.Note.freq(r)})})}),n)};var r=0;t.on("player:data",function(n){if(0==r++){var i=bi(n);null!=i&&(e.pitch.frequency=i,e.pitch.matches=function(e,t){var n=e.findIndex(function(e){return t<e.frequency});return n<5-Math.floor(2.5)?e.slice(0,5):n>e.length-Math.ceil(2.5)?e.slice(e.length-5,e.length):e.slice(n-3,n+2)}(e.pitch.possible,i),t.emit("render"))}else 3===r&&(r=0)})}),Go.use(function(e,t){var n,r={audio:!0};e.microphone=!1,t.on("microphone:on",function(){e.microphone=!0,navigator.mediaDevices.getUserMedia(r).then(function(t){(n=e.player.audioContext.createMediaStreamSource(t)).connect(e.player.merger)})}),t.on("microphone:off",function(){n&&n.disconnect(e.player.merger),n=null})}),Go.route("*",function(e,t){return function(){var e=document.createElement("div");return Wo(e,["\n      ",arguments[0],"\n      ",arguments[1],"\n      ",arguments[2],"\n      ",arguments[3],"\n      ",arguments[4],"\n      ",arguments[5],"\n      ",arguments[6],"\n    "]),e}(function(e,t){var n=e.keyboards;return function(){var e=document.createElement("div"),t=document.createElement("select");return t.setAttribute("id","keyboard"),t.onchange=arguments[0],Wo(t,["\n        ",arguments[1],"\n      "]),Wo(e,["\n      keyboard:\n      ",t,"\n    "]),e}(function(e){var r=e.target.value,i=n.find(function(e){return e.name===r});t("keyboard",i)},n.map(function(t){return function(){var e=document.createElement("option");return e.setAttribute("value",arguments[0]),e.setAttribute("id",arguments[1]),arguments[2]&&e.setAttribute("selected","selected"),Wo(e,["\n            ",arguments[3],"\n          "]),e}(t.name,t.name,t===e.keyboard,t.name)}))}(e,t),function(e,t){return function(){var e=document.createElement("div"),t=document.createElement("select");t.setAttribute("id","scaleNote"),t.onchange=arguments[0],Wo(t,["\n        ",arguments[1],"\n      "]);var n=document.createElement("select");return n.setAttribute("id","scaleType"),n.onchange=arguments[2],Wo(n,["\n        ",arguments[3],"\n      "]),Wo(e,["\n      scale:\n      ",t,"\n      ",n,"\n    "]),e}(function(e){t("scale:note",e.target.value)},ci.Note.names().map(function(t){return function(){var e=document.createElement("option");return e.setAttribute("value",arguments[0]),e.setAttribute("id",arguments[1]),arguments[2]&&e.setAttribute("selected","selected"),Wo(e,["\n            ",arguments[3],"\n          "]),e}(t,t,e.scale.note===t,t)}),function(e){t("scale:type",e.target.value)},ci.Scale.names().map(function(t){return function(){var e=document.createElement("option");return e.setAttribute("value",arguments[0]),e.setAttribute("id",arguments[1]),arguments[2]&&e.setAttribute("selected","selected"),Wo(e,["\n            ",arguments[3],"\n          "]),e}(t,t,e.scale.type===t,t)}))}(e,t),function(e,t){return function(){var e=document.createElement("div"),t=document.createElement("select");return t.setAttribute("id","instrument"),t.onchange=arguments[0],Wo(t,["\n        ",arguments[1],"\n      "]),Wo(e,["\n      instrument:\n      ",t,"\n    "]),e}(function(e){t("instrument",e.target.value)},e.instruments.map(function(t){return function(){var e=document.createElement("option");return e.setAttribute("value",arguments[0]),e.setAttribute("id",arguments[1]),arguments[2]&&e.setAttribute("selected","selected"),Wo(e,["\n            ",arguments[3],"\n          "]),e}(t,t,t===e.instrumentId,t)}))}(e,t),function(e,t){return function(){var e=document.createElement("div"),t=document.createElement("div");Wo(t,["\n        notes:\n        ",arguments[0],"\n      "]);var n=document.createElement("div");return Wo(n,["\n        last note: ",arguments[1],"\n      "]),Wo(e,["\n      ",t,"\n      ",n,"\n    "]),e}(e.notes.map(function(e){return function(){var e=document.createElement("button");return e.onclick=arguments[0],Wo(e,["\n              ",arguments[1],"\n            "]),e}(function(e){return function(n){return t("player:note",e)}}(e),e)}),e.player.lastNote)}(e,t),function(e,t){return function(){var e=document.createElement("div"),t=document.createElement("input");return t.setAttribute("type","checkbox"),arguments[0]&&t.setAttribute("checked","checked"),t.onchange=arguments[1],Wo(e,["\n      microphone:\n      ",t,"\n    "]),e}(e.microphone,function(e){e.target.checked?t("microphone:on"):t("microphone:off")})}(e,t),function(e,t){return function(){var e=document.createElement("div"),t=document.createElement("div");Wo(t,["\n        frequency: ",arguments[0],"\n      "]);var n=document.createElement("div"),r=document.createElement("ul");return Wo(r,["\n            ",arguments[1],"\n          "]),Wo(n,["\n        matches:\n          ",r,"\n      "]),Wo(e,["\n      pitch finder:\n      ",t,"\n      ",n,"\n    "]),e}(e.pitch.frequency,e.pitch.matches.map(function(e){return function(){var e=document.createElement("li");return Wo(e,["\n                name: ",arguments[0],"\n                frequency: ",arguments[1],"\n              "]),e}(e.name,e.frequency)}))}(e),function(e,t){return e.cache(Ro,"waveform").render(e.waveform)}(e))});var Ho=Go.start();document.body.appendChild(Ho),Go.emitter.on("DOMContentLoaded",function(){Go.emit("instrument","acoustic_grand_piano")})}();
//# sourceMappingURL=bundle.js.map